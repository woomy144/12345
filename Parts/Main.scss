var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var app=/******/function(modules){// webpackBootstrap
/******/// The module cache
/******/var installedModules={};/******/// The require function
/******/function __webpack_require__(moduleId){/******/// Check if module is in cache
/******/if(installedModules[moduleId])/******/return installedModules[moduleId].exports;/******/// Create a new module (and put it into the cache)
/******/var module=installedModules[moduleId]={/******/exports:{},/******/id:moduleId,/******/loaded:false/******/};/******/// Execute the module function
/******/modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);/******/// Flag the module as loaded
/******/module.loaded=true;/******/// Return the exports of the module
/******/return module.exports;/******/}/******/// expose the modules object (__webpack_modules__)
/******/__webpack_require__.m=modules;/******/// expose the module cache
/******/__webpack_require__.c=installedModules;/******/// __webpack_public_path__
/******/__webpack_require__.p="";/******/// Load entry module and return exports
/******/return __webpack_require__(0);/******/}(/************************************************************************//******/[/* 0 *//***/function(module,exports,__webpack_require__){"use strict";var global=__webpack_require__(1);var util=__webpack_require__(2);var wrapper=document.getElementById('startMenuWrapper');wrapper.style.visibility='visible';// =======================================
var phaserBulletSpriteInfo={url:'img/phaser_bullet-fe0ac84244.png',width:16,height:16,offsetX:0,offsetY:0,frames:[0]};var phaserSpriteInfo={url:'img/phaser-97ce9902f5.png',width:94,height:140,offsetX:0,offsetY:0,frames:[0]};var invaderDroneSpriteInfo={url:'img/invader_drone-4f0bba1c52.png',width:42,height:42,offsetX:0,offsetY:0,frames:[0]};var invaderSpriteInfo={url:'img/invader-01241e46fa.png',width:152,height:130,offsetX:0,offsetY:0,frames:[0]};// ==================================================================
var forceFieldXCanonSpriteInfo={url:'img/force_fieldx_canon-1f27799f01.png',width:50,height:51,offsetX:0,offsetY:0,frames:[0]};var forceFieldXLaserSpriteInfo={url:'img/force_fieldx_laser-91e4df0194.png',width:90,height:46,offsetX:0,offsetY:0,frames:[0]};// Normal Force FieldX.
var forceFieldXSpriteInfo={url:'img/force_fieldx_transform-e8046301f1.png',width:130,height:195,offsetX:0,offsetY:0,frames:[0]};// For upgrade menu, etc.
var forceFieldXMockupSpriteInfo={url:'img/force_fieldx_mockup-928f6c1fa7.png',width:100,height:100,offsetX:0,offsetY:0,frames:[0]};// Buffed Force FieldX..
var buffedForceFieldXSpriteInfo={url:'img/force_fieldx_transform-e8046301f1.png',width:130,height:195,offsetX:0,offsetY:0,frames:[7]};// Normal Force FieldX transformation to buffed Force FieldX.
var transformToBuffedForceFieldXSpriteInfo={url:'img/force_fieldx_transform-e8046301f1.png',width:130,height:195,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7]};// Buffed Force FieldX transformation to normal Force FieldX.
var transformToForceFieldXSpriteInfo={url:'img/force_fieldx_transform-e8046301f1.png',width:130,height:195,offsetX:0,offsetY:0,frames:[7,6,5,4,3,2,1,0]};// ==================================================================
var jupiterBulletSpriteInfo={url:'img/jupiter_bullet-a3dc55f3dd.png',width:35,height:35,offsetX:0,offsetY:0,frames:[0]};// Normal Jupiter.
var jupiterSpriteInfo={url:'img/jupiter_transform-475efa98e5.png',width:140,height:155,offsetX:0,offsetY:0,frames:[0]};// Buffed Jupiter.
var buffedJupiterSpriteInfo={url:'img/jupiter_transform-475efa98e5.png',width:140,height:155,offsetX:0,offsetY:0,frames:[10]};// Normal Jupiter transformation to buffed Jupiter.
var transformToBuffedJupiterSpriteInfo={url:'img/jupiter_transform-475efa98e5.png',width:140,height:155,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10]};// Buffed Jupiter transformation to normal Jupiter.
var transformToJupiterSpriteInfo={url:'img/jupiter_transform-475efa98e5.png',width:140,height:155,offsetX:0,offsetY:0,frames:[10,9,8,7,6,5,4,3,2,1,0]};// ============================================================
var quinjetBulletSpriteInfo={url:'img/quinjet_bullet-2b4bec4753.png',width:26,height:26,offsetX:0,offsetY:0,frames:[0]};var quinjetSpriteInfo={url:'img/quinjet_v2-8e4d617a2b.png',width:138,height:150,offsetX:0,offsetY:0,frames:[0]};var lightsaberBlueTankSpriteInfo={url:'img/lightsaber-52b433b264.png',width:108,height:87,offsetX:0,offsetY:0,frames:[0]};var lightsaberRedTankSpriteInfo={url:'img/lightsaber_red-05f04c02e0.png',width:108,height:87,offsetX:0,offsetY:0,frames:[0]};var lightsaberGreenTankSpriteInfo={url:'img/lightsaber_green-85584a61e2.png',width:108,height:87,offsetX:0,offsetY:0,frames:[0]};var lightsaberYellowTankSpriteInfo={url:'img/lightsaber_yellow-31c77bfed8.png',width:108,height:87,offsetX:0,offsetY:0,frames:[0]};var laserBeamBlueSpriteInfo={url:'img/laser_beam_blue.png',width:70,height:360,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,4,3,2,1]};var laserBeamRedSpriteInfo={url:'img/laser_beam_red.png',width:70,height:360,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,4,3,2,1]};var laserBeamGreenSpriteInfo={url:'img/laser_beam_green.png',width:70,height:360,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,4,3,2,1]};var laserBeamYellowSpriteInfo={url:'img/laser_beam_yellow.png',width:70,height:360,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,4,3,2,1]};var spikeSphereSpriteInfo={url:'img/spike_sphere-93bd71ffa3.png',width:80,height:61,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12]};var spikeSphereMockupSpriteInfo={url:'img/spike_sphere_mockup-160ed315f0.png',width:80,height:80,offsetX:0,offsetY:0,frames:[0]};var andromedaDroneSpriteInfo={url:'img/andromeda_drone-0bd679e026.png',width:64,height:66,offsetX:0,offsetY:0,frames:[0]};var andromedaBulletSpriteInfo={url:'img/andromeda_bullet-565810fbb2.png',width:51,height:48,offsetX:0,offsetY:0,frames:[0]};var andromedaSpriteInfo={url:'img/andromeda-aa03348423.png',width:233,height:259,offsetX:0,offsetY:0,frames:[0]};var towerDroneBulletSpriteInfo={url:'img/tower_drone_bullet-0dae01d3c0.png',width:28,height:27,offsetX:0,offsetY:0,frames:[0]};var towerDroneSpriteInfo={url:'img/tower_drone-1a0badc337.png',width:61,height:49,offsetX:0,offsetY:0,frames:[0]};var towerDroneSpawnerSpriteInfo={url:'img/tower_drone_spawner-a396b85c8e.png',width:90,height:103,offsetX:0,offsetY:0,frames:[0]};var towerMissileSpriteInfo={url:'img/tower_missile-3d44eddb6f.png',width:51,height:70,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12]};var underlordDroneSpriteInfo={url:'img/underlord_drone-edd7591c1b.png',width:56,height:56,offsetX:0,offsetY:0,frames:[0]};var shieldSpriteInfo={url:'img/shield-e62f75fe77.png',width:128,height:128,offsetX:0,offsetY:0,frames:[0]};var deflectorSpriteInfo={url:'img/deflector_effect-18c6682dc2.png',width:128,height:128,offsetX:0,offsetY:0,frames:[0]};var eagleSpriteInfo={url:'img/eagle-921027f8c4.png',width:90,height:90,offsetX:0,offsetY:0,frames:[0]};var valkyrieSpriteInfo={url:'img/valkyrie-7ae1a279cd.png',width:184,height:179,offsetX:0,offsetY:0,frames:[0]};// ===============================
// Valkyrie.
// ===============================
var valkyrieBulletSpriteInfo={url:'img/valkyrie_bullet-0172bac4c8.png',width:48,height:51,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7]};var valkyrieLaserSpriteInfo={url:'img/valkyrie_laser-45389df6d6.png',width:78,height:80,offsetX:0,offsetY:0,frames:[0]};// ===============================
// Mouse Ring.
var mouseRingSpriteInfo={url:'img/mouse_ring-9cf306472e.png',width:141,height:141,offsetX:0,offsetY:0,frames:[0]};var mouseRingWargSpriteInfo={url:'img/mouse_ring_warg-200580b840.png',width:141,height:141,offsetX:0,offsetY:0,frames:[0]};// Phantom Zone Gun Bullet.
var phantomBulletSpriteInfo={url:'img/phantom_bullet_v2-752fb9174a.png',width:191,height:190,offsetX:0,offsetY:0,frames:[0]};// Earthshaker.
var shakingEarthSpriteInfo={url:'img/shaking_earth_v3-bae9409b7f.png',width:280,height:276,offsetX:0,offsetY:0,frames:[0,1,2,3,4]};// RC Bomb.
var rcBombSpriteInfo={url:'img/rc_bomb-322250703b.png',width:90,height:90,offsetX:0,offsetY:0,frames:[0,1]};// Time Bomb.
var timeBombSpriteInfo={url:'img/time_bomb_v3-eada332c57.png',width:90,height:69,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10]};// Warper.
var warperSpriteInfo={url:'img/warper_v2-ac3ace1e44.png',width:120,height:83,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5]};// ==================================================================
// Bunker Initial Stage.
var bunkerInitialStageSpriteInfo={// Using a separate image as the upgrade menu display is distorted when
// "bunker_transform.png" file is used.
url:'img/bunker_initial_stage-5807ecd85a.png',width:100,height:220,offsetX:0,offsetY:0,frames:[0]/*
	    url: 'img/bunker_transform-ec9fdb0e89.png', 
	    width: 100,
	    height: 220,
	    offsetX: 0,
	    offsetY: 0, 
	    frames: [0]
	    */};// Bunker Last Stage.
var bunkerLastStageSpriteInfo={// Using a separate image as the upgrade menu display is distorted when
// "bunker_transform.png" file is used.    
url:'img/bunker_last_stage_v2-bf9fcbe6d8.png',width:220,height:220,offsetX:0,offsetY:0,frames:[0]/*
	    url: 'img/bunker_transform-ec9fdb0e89.png', 
	    width: 100,
	    height: 220,
	    offsetX: 0,
	    offsetY: 0, 
	    frames: [12]
	    */};// Bunker Transformation.
var bunkerTransformToLastStageSpriteInfo={url:'img/bunker_transform-ec9fdb0e89.png',width:100,height:220,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12]};// Bunker Transformation.
var bunkerTransformToInitialStageSpriteInfo={url:'img/bunker_transform-ec9fdb0e89.png',width:100,height:220,offsetX:0,offsetY:0,frames:[12,11,10,9,8,7,6,5,4,3,2,1,0]};// =================================================
// ==================================================================
// Drone Bunker Initial Stage.
var droneBunkerInitialStageSpriteInfo={url:'img/drone_bunker_transform-215573dc38.png',width:120,height:117,offsetX:0,offsetY:0,frames:[0]};// Drone Bunker Last Stage.
var droneBunkerLastStageSpriteInfo={url:'img/drone_bunker_transform-215573dc38.png',width:120,height:117,offsetX:0,offsetY:0,frames:[8]};// Drone Bunker Transformation.
var droneBunkerTransformToLastStageSpriteInfo={url:'img/drone_bunker_transform-215573dc38.png',width:120,height:117,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8]};// Drone Bunker Transformation.
var droneBunkerTransformToInitialStageSpriteInfo={url:'img/drone_bunker_transform-215573dc38.png',width:120,height:117,offsetX:0,offsetY:0,frames:[8,7,6,5,4,3,2,1,0]};var droneBunkerDroneSpriteInfo={url:'img/drone_bunker_drone_v4-341eb2db70.png',width:60,height:61,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5]};// =================================================
// ==================================================================
// Trap Bunker Initial Stage.
var trapBunkerInitialStageSpriteInfo={url:'img/trap_bunker_transform-10f44b3177.png',width:160,height:160,offsetX:0,offsetY:0,frames:[0]};// Trap Bunker Last Stage.
var trapBunkerLastStageSpriteInfo={url:'img/trap_bunker_transform-10f44b3177.png',width:160,height:160,offsetX:0,offsetY:0,frames:[4]};// Trap Bunker Transformation.
var trapBunkerTransformToLastStageSpriteInfo={url:'img/trap_bunker_transform-10f44b3177.png',width:160,height:160,offsetX:0,offsetY:0,frames:[0,1,2,3,4]};// Trap Bunker Transformation.
var trapBunkerTransformToInitialStageSpriteInfo={url:'img/trap_bunker_transform-10f44b3177.png',width:160,height:160,offsetX:0,offsetY:0,frames:[4,3,2,1,0]};// =================================================
// Cyclone.
var cycloneSpriteInfo={url:'img/cyclone_v2-055f5a3251.png',width:582,height:581,offsetX:0,offsetY:0,frames:[0]};// Firestone Bullet.
var firestoneBulletSpriteInfo={url:'img/firestone_v2-5908113422.png',width:70,height:79,offsetX:0,offsetY:0,frames:[0]};// Imprisoner Bullet.
var imprisonerBulletSpriteInfo={url:'img/imprisoner_bullet_v2-277de10450.png',width:90,height:90,offsetX:0,offsetY:0,frames:[0]};var hellgateBulletSpriteInfo={url:'img/hellgate_fire_v2-f2dd282960.png',width:413,height:412,offsetX:0,offsetY:0,frames:[0,1,2,3]};var nukerSpriteInfo={url:'img/nuker-607d8cf0df.png',width:206,height:253,offsetX:0,offsetY:0,frames:[0]};// Nuker Bullet.
var nukerBulletSpriteInfo={url:'img/nuker_bullet-4fda7d8a9d.png',width:62,height:105,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]};var nukerBulletShadowSpriteInfo={url:'img/nuker_bullet_shadow-48d1c3b326.png',width:62,height:105,offsetX:45,offsetY:60,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]};var nukerExplosionInfo={url:'img/nuker_explosion_v2-e4930e3473.png',width:529,height:502,offsetX:-60,offsetY:50,frames:[0,1,2,3,4,5,6]};// =================================
// Wasp.
// =================================
var waspSpriteInfo={url:'img/insect_bee-5b4f6f3235.png',width:130,height:89,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10]};var waspShadowSpriteInfo={url:'img/insect_bee_shadow-4c00eac0a5.png',width:130,height:89,offsetX:45,offsetY:60,frames:[0,1,2,3,4,5,6,7,8,9,10]};// =================================
// Zerg Base, Zerg Bug.
// =================================
var zergBaseSpriteInfo={url:'img/zerg_base.png',width:128,height:128,offsetX:0,offsetY:0,frames:[0,1]};var zergBugSpriteInfo={url:'img/zerg_bug.png',width:120,height:83,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10]};var zergBugShadowSpriteInfo={url:'img/zerg_bug_shadow.png',width:130,height:89,offsetX:45,offsetY:60,frames:[0,1,2,3,4,5,6,7,8,9,10]};// =================================
// Freeze Gun Bullet.
var freezeGunBulletSpriteInfo={url:'img/freeze_bullet-f0f8eb5dd7.png',width:62,height:69,offsetX:0,offsetY:0,frames:[0]};// Frozen by Freeze Gun.
var frozenSpriteInfo={url:'img/frozen_v2-4ac6571da3.png',width:160,height:160,offsetX:0,offsetY:0,frames:[0]};// Portal.
// let portalSpriteInfo = {
//     url: 'img/portal.png', 
//     width: 400,
//     height: 400,
//     offsetX: 0,
//     offsetY: 0, 
//     frames: [0,1,2,3,4,5,6,7,8,9,8,7,6,5,4,3,2,1]
// };
// Electro Ring.
var electroRingSpriteInfo={url:'img/electro_ring_v2-db66a357a2.png',width:350,height:350,offsetX:0,offsetY:0,frames:[0,1,2,3,2,1]};// ===================================
// T-14 Armata.
// ===================================
var armataTankMockupSpriteInfo={url:'img/armata_tank_mockup_v2-e3c04e83e1.png',width:116,height:116,offsetX:0,offsetY:0,frames:[0]};var armataTankSpriteInfo={url:'img/armata_tank_v3-cfecf5544c.png',width:80,height:126,offsetX:0,offsetY:0,frames:[0,1,2]};var armataTurretSpriteInfo={url:'img/armata_tank_turret_v2-ae295a1cc6.png',width:60,height:108,offsetX:0,offsetY:0,frames:[0]};var armataBulletSpriteInfo={url:'img/armata_tank_bullet_v2-393b0e278a.png',width:25,height:56,offsetX:0,offsetY:0,frames:[0]};var tankMuzzleFlashSpriteInfo={url:'img/tank_muzzle_flash-262bdbb705.png',width:60,height:60,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]};// ===================================
// Paris Gun.
// ===================================
var parisGunTankMockupSpriteInfo={url:'img/paris_gun_tank_mockup-74b2bde5d1.png',width:150,height:150,offsetX:0,offsetY:0,frames:[0]};var parisGunTankSpriteInfo={url:'img/paris_gun_tank-96264af7a0.png',width:205,height:280,offsetX:0,offsetY:0,frames:[0]};var parisGunBigTurretSpriteInfo={url:'img/paris_gun_big_turret-b024414208.png',width:109,height:260,offsetX:0,offsetY:0,frames:[0]};var parisGunSmallTurretSpriteInfo={url:'img/paris_gun_small_turret-bf57991f4a.png',width:50,height:88,offsetX:0,offsetY:0,frames:[0]};var parisGunBulletSpriteInfo={url:'img/paris_gun_bullet-54f171b8eb.png',width:40,height:141,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5]};var parisGunWheelBeltSpriteInfo={url:'img/paris_gun_wheel_belt-bc6a376349.png',width:42,height:310,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5]};// ===================================
// T-60 Scout Tank.
// ===================================
var t60scoutTankMockupSpriteInfo={url:'img/t60_scout_tank_mockup-eb83156f2d.png',width:116,height:116,offsetX:0,offsetY:0,frames:[0]};var t60scoutTankSpriteInfo={url:'img/t60_scout_tank-65c5debba7.png',width:70,height:108,offsetX:0,offsetY:0,frames:[0,1,2]};// ===================================
// ST-II (ST Two) tank.
// ===================================
var stTwoTankMockupSpriteInfo={url:'img/sttwo_tank_mockup-e3353d6ae0.png',width:116,height:116,offsetX:0,offsetY:0,frames:[0]};var stTwoTankSpriteInfo={url:'img/sttwo_tank-0aab1416e1.png',width:110,height:142,offsetX:0,offsetY:0,frames:[0,1,2]};var stTwoTurretSpriteInfo={url:'img/sttwo_tank_turret-316bd32ae5.png',width:68,height:122,offsetX:0,offsetY:0,frames:[0]};var stTwoBulletSpriteInfo={url:'img/sttwo_tank_bullet-3afbada9e2.png',width:28,height:63,offsetX:0,offsetY:0,frames:[0]};// =====================================
var megaTankSpriteInfo={url:'img/mega_tank-c42b62a919.png',width:210,height:210,offsetX:0,offsetY:0,frames:[0]};var megaTankBulletSpriteInfo={url:'img/mega_tank_bullet-eadf405d37.png',width:36,height:36,offsetX:0,offsetY:0,frames:[0]};// ===================================
// Rail Gun.
// ===================================
var railGunBulletSpriteInfo={url:'img/rail_gun_bullet-6ead116610.png',width:48,height:116,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]};var railGunSpriteInfo={url:'img/rail_gun-894ddce0b0.png',width:150,height:96,offsetX:0,offsetY:0,frames:[0]};var railGunThrusterSpriteInfo={url:'img/rail_gun_thruster-cb85ae9e57.png',width:45,height:53,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]};// ===================================
var blackholeSpriteInfo={url:'img/blackhole_v5-f6f2e88cb3.png',width:350,height:342,offsetX:0,offsetY:0,frames:[0,1,2,3]};var blackholeTankSpriteInfo={url:'img/blackhole_tank-5bc01bcec1.png',width:121,height:120,offsetX:0,offsetY:0,frames:[0]};var whiteholeSpriteInfo={url:'img/whitehole_v3-f7da4d1035.png',width:498,height:469,offsetX:20,offsetY:8,frames:[0,1,2,3]};var whiteholeTankSpriteInfo={url:'img/whitehole_tank-37b1d508e7.png',width:121,height:120,offsetX:0,offsetY:0,frames:[0]};var heartSpriteInfo={url:'img/heart_v2-ff8daa6cb8.png',width:65,height:64,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7]};var gemSpriteInfos=[{url:'img/gem_green_star_v2-c0767328d8.png',width:182,height:185,offsetX:0,offsetY:0,frames:[0]},{url:'img/gem_red_star_v2-b0f589ec0f.png',width:165,height:161,offsetX:0,offsetY:0,frames:[0]}];var spaceshipXBulletSpriteInfo={url:'img/spaceshipx_bullet-b892106ad8.png',width:93,height:50,offsetX:0,offsetY:0,frames:[0]};var spaceshipXTankSpriteInfo={url:'img/spaceshipx_tank_v3-5c3b8becfe.png',width:200,height:198,offsetX:0,offsetY:0,frames:[0,1,2,3,4,3,2,1]};// ====================================================
var laserShipArcBulletSpriteInfo={url:'img/lasership_arc_bullet-f57ffd5cf0.png',width:120,height:146,offsetX:0,offsetY:0,frames:[0]};var laserShipLongBulletSpriteInfo={url:'img/lasership_long_bullet-fdf6a8f19f.png',width:216,height:28,offsetX:0,offsetY:0,frames:[0]};var laserShipSpriteInfo={url:'img/lasership-caedcd9a04.png',width:140,height:139,offsetX:0,offsetY:0,frames:[0]};// ====================================================
var ghostRiderSpriteInfo={url:'img/ghost_rider_v2-8d3d8af3fd.png',width:128,height:128,offsetX:0,offsetY:0,frames:[0]};var megaSawSpriteInfo={url:'img/mega_saw-54446ab870.png',width:145,height:145,offsetX:0,offsetY:0,frames:[0]};var alienDroneSpriteInfo={url:'img/alien_drone_v3-249ce8d2e0.png',width:50,height:56,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]};var alienShipSpriteInfo={url:'img/alien_ship_v2-8211aa4389.png',width:119,height:118,offsetX:0,offsetY:0,frames:[0]};var asteroidTankSpriteInfo={url:'img/asteroid_tank_v3-a0c89889d3.png',width:93,height:109,offsetX:0,offsetY:0,frames:[0]};var asteroidSpriteInfo={url:'img/asteroid_v2-5aa26862c4.png',width:147,height:196,offsetX:0,offsetY:0,frames:[0]};var forceFieldBulletSpriteInfo={url:'img/force_field_v3-1e474a92ed.png',width:380,height:379,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6]};var forceFieldTankSpriteInfo={url:'img/force_field_tank_v5-864267f5bb.png',width:110,height:110,offsetX:0,offsetY:0,frames:[0]};var babyForceFieldTankSpriteInfo={url:'img/force_field_tank_v5-864267f5bb.png',width:130,height:130,offsetX:0,offsetY:0,frames:[0]};var shockwaveEffectSpriteInfo={url:'img/shockwave_effect_v3-c55aa4d872.png',width:512,height:512,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10]};var shockwaveTankSpriteInfo={url:'img/shockwave_tank_v3-c3143c8dca.png',width:94,height:94,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11]};// let tankExplosionInfos = [
//         {
//             url: 'img/tank_explosion_v4-254a517531.png', 
//             width:382, 
//             height: 402,
//             offsetX: 0,
//             offsetY: 0, 
//             frames: [0,1,2,3,4,5,6,7]
//         },
//     ];
// let pentagonExplosionInfos = [
// 		{
//             url: 'img/pentagon_explosion_v3-44f56ec0c6.png', 
//             width:470, 
//             height: 473,
//             offsetX: 0,
//             offsetY: 0, 
//             frames: [0,1,2,3,4,5,6,7,8]                    
//         },        
//     ];
// let teleportSpriteInfos = [
// 		// Teleport out (disappear).
//         {
//             url: 'img/teleportation_v4-c79253f2dc.png', 
//             width: 256, 
//             height: 255, 
//             offsetX: 0,
//             offsetY: 0, 
//             frames: [9,8,7,6,5,4,3,2,1,0]
//         }, 
// 		// Teleport in (appear).
// 		{
//             url: 'img/teleportation_v4-c79253f2dc.png', 
//             width: 256, 
//             height: 255,
//             offsetX: 0,
//             offsetY: 0, 
//             frames: [0,1,2,3,4,5,6,7,8,9,]
//         },
//     ];   
var fireballSpriteInfos=[{url:'img/fireball_v3-a2c25b01cd.png',width:100,height:357,offsetX:0,offsetY:-160,frames:[0,1,2,3,4,5,6]}];var missileSpriteInfos=[{url:'img/heat_seeker_missile_v2-50bd5c0344.png',width:48,height:73,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11]}];var howitzerBulletSpriteInfo={url:'img/howitzer_bullet_v2-5dce6aba4b.png',width:51,height:75,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]};var laserGunBulletSpriteInfo={url:'img/lasergun_bullet-3ad636a662.png',width:42,height:46,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7]};var blueCanonSpriteInfo={url:'img/blue_canon_v3-6d43c4435e.png',width:120,height:111,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7]};var cometSpriteInfo={url:'img/comet-74606ad24c.png',width:40,height:159,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]};var spaceBallSpriteInfo={url:'img/space_ball_v3-08afa86e24.png',width:93,height:100,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8]};var thrusterSpriteInfos=[{url:'img/heat_seeker_missile_thruster_v3-f172fbf21b.png',width:93,height:118,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5]},{url:'img/howitzer_bullet_thruster_v2-956801be6f.png',width:47,height:52,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},{url:'img/asteroid_flame_v3-c5510cc20d.png',width:100,height:340,offsetX:0,offsetY:0,frames:[0,1,2,3,4,5,6]},{url:'img/ghost_rider_flame_v3-d6779085d7.png',width:70,height:271,offsetX:0,offsetY:0,frames:[0,1,2,3,4]},{url:'img/ghost_rider_flame_turbo_v2-07b57e46c8.png',width:70,height:254,offsetX:0,offsetY:0,frames:[0,1,2,3,4]}];// ======================================================================  
var modifyOverlyLongName=function modifyOverlyLongName(name,fontSize,maxLength){var nameLength=measureText(name,fontSize);// Need to check the length of name in pixels, otherwise,
// Arabic names tend to mess up the display.
// Examples:
// ?????????
// ????????????????????????????????    
if(nameLength>=maxLength){return'a spoopy ??';}else{return name;}};// ======================================================================
var displayBunkerTransformation=function displayBunkerTransformation(instance,scale,ratio,x,y,ctx,rotation,initialStageSpriteInfo,transformToLastStageSpriteInfo,transformToInitialStageSpriteInfo,lastStageSpriteInfo){if(!instance.initialStageSprite){var animationInfo=initialStageSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;instance.initialStageSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
1,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}if(!instance.transformToLastStageSprite){var _animationInfo=transformToLastStageSpriteInfo;var _destWidth=scale*ratio*_animationInfo.width;var _destHeight=scale*ratio*_animationInfo.height;instance.transformToLastStageSprite=new Sprite(_animationInfo.url,[0,0],// Position
[_animationInfo.width,_animationInfo.height],// Source size 
[_destWidth,_destHeight],// Destination size
16,// Animation speed
_animationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}if(!instance.transformToInitialStageSprite){var _animationInfo2=transformToInitialStageSpriteInfo;var _destWidth2=scale*ratio*_animationInfo2.width;var _destHeight2=scale*ratio*_animationInfo2.height;instance.transformToInitialStageSprite=new Sprite(_animationInfo2.url,[0,0],// Position
[_animationInfo2.width,_animationInfo2.height],// Source size 
[_destWidth2,_destHeight2],// Destination size
16,// Animation speed
_animationInfo2.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}if(!instance.lastStageSprite){var _animationInfo3=lastStageSpriteInfo;var _destWidth3=scale*ratio*_animationInfo3.width;var _destHeight3=scale*ratio*_animationInfo3.height;instance.lastStageSprite=new Sprite(_animationInfo3.url,[0,0],// Position
[_animationInfo3.width,_animationInfo3.height],// Source size 
[_destWidth3,_destHeight3],// Destination size
1,// Animation speed
_animationInfo3.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var now=getNow();var dt=instance.lastTransformTime?(now-instance.lastTransformTime)/1000.0:0;var alpha=instance.render.status.getFade();var adjustedRotation=rotation-90*(Math.PI/180.0);if(instance.transformStage===0){var _destWidth4=scale*ratio*initialStageSpriteInfo.width*0.65;var _destHeight4=scale*ratio*initialStageSpriteInfo.height*0.65;//instance.initialStageSprite.update(dt, x, y, 0, 0, adjustedRotation, alpha);
instance.initialStageSprite.update2(dt,x,y,0,0,_destWidth4,_destHeight4,adjustedRotation,alpha);instance.initialStageSprite.render(ctx);}else if(instance.transformStage===1){var _destWidth5=scale*ratio*transformToLastStageSpriteInfo.width*0.65;var _destHeight5=scale*ratio*transformToLastStageSpriteInfo.height*0.65;instance.transformToLastStageSprite.update2(dt,x,y,0,0,_destWidth5,_destHeight5,adjustedRotation,alpha);instance.transformToLastStageSprite.render(ctx);}else if(instance.transformStage===2){var _destWidth6=scale*ratio*transformToInitialStageSpriteInfo.width*0.65;var _destHeight6=scale*ratio*transformToInitialStageSpriteInfo.height*0.65;instance.transformToInitialStageSprite.update2(dt,x,y,0,0,_destWidth6,_destHeight6,adjustedRotation,alpha);instance.transformToInitialStageSprite.render(ctx);}else if(instance.transformStage===3){var _destWidth7=scale*ratio*lastStageSpriteInfo.width*0.65;var _destHeight7=scale*ratio*lastStageSpriteInfo.height*0.65;instance.lastStageSprite.update2(dt,x,y,0,0,_destWidth7,_destHeight7,adjustedRotation,alpha);instance.lastStageSprite.render(ctx);}instance.lastTransformTime=now;if(instance.transformStage===0||instance.transformStage===3){instance.lastTransformTime=0;instance.transformToLastStageSprite=null;instance.transformToInitialStageSprite=null;}};// ================================================
// ================================================
// Drone Bunker Transformation.
var displayDroneBunkerTransformation=function displayDroneBunkerTransformation(instance,scale,ratio,x,y,ctx,rotation,initialStageSpriteInfo,transformToLastStageSpriteInfo,transformToInitialStageSpriteInfo,lastStageSpriteInfo){if(!instance.droneBunkerInitialStageSprite){var animationInfo=initialStageSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;instance.droneBunkerInitialStageSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
1,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}if(!instance.droneBunkerTransformToLastStageSprite){var _animationInfo4=transformToLastStageSpriteInfo;var _destWidth8=scale*ratio*_animationInfo4.width;var _destHeight8=scale*ratio*_animationInfo4.height;instance.droneBunkerTransformToLastStageSprite=new Sprite(_animationInfo4.url,[0,0],// Position
[_animationInfo4.width,_animationInfo4.height],// Source size 
[_destWidth8,_destHeight8],// Destination size
12,// Animation speed
_animationInfo4.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}if(!instance.droneBunkerTransformToInitialStageSprite){var _animationInfo5=transformToInitialStageSpriteInfo;var _destWidth9=scale*ratio*_animationInfo5.width;var _destHeight9=scale*ratio*_animationInfo5.height;instance.droneBunkerTransformToInitialStageSprite=new Sprite(_animationInfo5.url,[0,0],// Position
[_animationInfo5.width,_animationInfo5.height],// Source size 
[_destWidth9,_destHeight9],// Destination size
12,// Animation speed
_animationInfo5.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}if(!instance.droneBunkerLastStageSprite){var _animationInfo6=lastStageSpriteInfo;var _destWidth10=scale*ratio*_animationInfo6.width;var _destHeight10=scale*ratio*_animationInfo6.height;instance.droneBunkerLastStageSprite=new Sprite(_animationInfo6.url,[0,0],// Position
[_animationInfo6.width,_animationInfo6.height],// Source size 
[_destWidth10,_destHeight10],// Destination size
1,// Animation speed
_animationInfo6.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var now=getNow();var dt=instance.droneBunkerLastTransformTime?(now-instance.droneBunkerLastTransformTime)/1000.0:0;var alpha=instance.render.status.getFade();var adjustedRotation=rotation;//- 90 * (Math.PI / 180.0);
if(instance.transformStage===0){var _destWidth11=scale*ratio*droneBunkerInitialStageSpriteInfo.width*0.7;var _destHeight11=scale*ratio*droneBunkerInitialStageSpriteInfo.height*0.7;instance.droneBunkerInitialStageSprite.update2(dt,x,y,0,0,_destWidth11,_destHeight11,adjustedRotation,alpha);instance.droneBunkerInitialStageSprite.render(ctx);}else if(instance.transformStage===1){var _destWidth12=scale*ratio*droneBunkerTransformToLastStageSpriteInfo.width*0.7;var _destHeight12=scale*ratio*droneBunkerTransformToLastStageSpriteInfo.height*0.7;instance.droneBunkerTransformToLastStageSprite.update2(dt,x,y,0,0,_destWidth12,_destHeight12,adjustedRotation,alpha);instance.droneBunkerTransformToLastStageSprite.render(ctx);}else if(instance.transformStage===2){var _destWidth13=scale*ratio*droneBunkerTransformToInitialStageSpriteInfo.width*0.7;var _destHeight13=scale*ratio*droneBunkerTransformToInitialStageSpriteInfo.height*0.7;instance.droneBunkerTransformToInitialStageSprite.update2(dt,x,y,0,0,_destWidth13,_destHeight13,adjustedRotation,alpha);instance.droneBunkerTransformToInitialStageSprite.render(ctx);}else if(instance.transformStage===3){var _destWidth14=scale*ratio*droneBunkerLastStageSpriteInfo.width*0.7;var _destHeight14=scale*ratio*droneBunkerLastStageSpriteInfo.height*0.7;instance.droneBunkerLastStageSprite.update2(dt,x,y,0,0,_destWidth14,_destHeight14,adjustedRotation,alpha);instance.droneBunkerLastStageSprite.render(ctx);}instance.droneBunkerLastTransformTime=now;if(instance.transformStage===0||instance.transformStage===3){instance.droneBunkerLastTransformTime=0;instance.droneBunkerTransformToLastStageSprite=null;instance.droneBunkerTransformToInitialStageSprite=null;}};// =======================================================
// ================================================
var displayTrapBunkerTransformation=function displayTrapBunkerTransformation(instance,scale,ratio,x,y,ctx,rotation,initialStageSpriteInfo,transformToLastStageSpriteInfo,transformToInitialStageSpriteInfo,lastStageSpriteInfo){if(!instance.trapBunkerInitialStageSprite){var animationInfo=initialStageSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;instance.trapBunkerInitialStageSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
1,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}if(!instance.trapBunkerTransformToLastStageSprite){var _animationInfo7=transformToLastStageSpriteInfo;var _destWidth15=scale*ratio*_animationInfo7.width;var _destHeight15=scale*ratio*_animationInfo7.height;instance.trapBunkerTransformToLastStageSprite=new Sprite(_animationInfo7.url,[0,0],// Position
[_animationInfo7.width,_animationInfo7.height],// Source size 
[_destWidth15,_destHeight15],// Destination size
6,// Animation speed
_animationInfo7.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}if(!instance.trapBunkerTransformToInitialStageSprite){var _animationInfo8=transformToInitialStageSpriteInfo;var _destWidth16=scale*ratio*_animationInfo8.width;var _destHeight16=scale*ratio*_animationInfo8.height;instance.trapBunkerTransformToInitialStageSprite=new Sprite(_animationInfo8.url,[0,0],// Position
[_animationInfo8.width,_animationInfo8.height],// Source size 
[_destWidth16,_destHeight16],// Destination size
6,// Animation speed
_animationInfo8.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}if(!instance.trapBunkerLastStageSprite){var _animationInfo9=lastStageSpriteInfo;var _destWidth17=scale*ratio*_animationInfo9.width;var _destHeight17=scale*ratio*_animationInfo9.height;instance.trapBunkerLastStageSprite=new Sprite(_animationInfo9.url,[0,0],// Position
[_animationInfo9.width,_animationInfo9.height],// Source size 
[_destWidth17,_destHeight17],// Destination size
1,// Animation speed
_animationInfo9.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var now=getNow();var dt=instance.trapBunkerLastTransformTime?(now-instance.trapBunkerLastTransformTime)/1000.0:0;var alpha=instance.render.status.getFade();var adjustedRotation=rotation;//- 90 * (Math.PI / 180.0);
if(instance.transformStage===0){var _destWidth18=scale*ratio*trapBunkerInitialStageSpriteInfo.width*0.85;var _destHeight18=scale*ratio*trapBunkerInitialStageSpriteInfo.height*0.85;instance.trapBunkerInitialStageSprite.update2(dt,x,y,0,0,_destWidth18,_destHeight18,adjustedRotation,alpha);instance.trapBunkerInitialStageSprite.render(ctx);}else if(instance.transformStage===1){var _destWidth19=scale*ratio*trapBunkerTransformToLastStageSpriteInfo.width*0.85;var _destHeight19=scale*ratio*trapBunkerTransformToLastStageSpriteInfo.height*0.85;instance.trapBunkerTransformToLastStageSprite.update2(dt,x,y,0,0,_destWidth19,_destHeight19,adjustedRotation,alpha);instance.trapBunkerTransformToLastStageSprite.render(ctx);}else if(instance.transformStage===2){var _destWidth20=scale*ratio*trapBunkerTransformToInitialStageSpriteInfo.width*0.85;var _destHeight20=scale*ratio*trapBunkerTransformToInitialStageSpriteInfo.height*0.85;instance.trapBunkerTransformToInitialStageSprite.update2(dt,x,y,0,0,_destWidth20,_destHeight20,adjustedRotation,alpha);instance.trapBunkerTransformToInitialStageSprite.render(ctx);}else if(instance.transformStage===3){var _destWidth21=scale*ratio*trapBunkerLastStageSpriteInfo.width*0.85;var _destHeight21=scale*ratio*trapBunkerLastStageSpriteInfo.height*0.85;instance.trapBunkerLastStageSprite.update2(dt,x,y,0,0,_destWidth21,_destHeight21,adjustedRotation,alpha);instance.trapBunkerLastStageSprite.render(ctx);}instance.trapBunkerLastTransformTime=now;if(instance.transformStage===0||instance.transformStage===3){instance.trapBunkerLastTransformTime=0;instance.trapBunkerTransformToLastStageSprite=null;instance.trapBunkerTransformToInitialStageSprite=null;}};// ==========================================================
// Jupiter, Force FieldX, etc class change (transformation).
// ==========================================================
var displayClassChangeTransformation=function displayClassChangeTransformation(instance,scale,ratio,x,y,ctx,rotation,transformToInitialStageSpriteInfo,lastStageSpriteInfo){if(!instance.transformToInitialStageSprite){var animationInfo=transformToInitialStageSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;instance.transformToInitialStageSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
10,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once
}if(!instance.lastStageSprite){var _animationInfo10=lastStageSpriteInfo;var _destWidth22=scale*ratio*_animationInfo10.width;var _destHeight22=scale*ratio*_animationInfo10.height;instance.lastStageSprite=new Sprite(_animationInfo10.url,[0,0],// Position
[_animationInfo10.width,_animationInfo10.height],// Source size 
[_destWidth22,_destHeight22],// Destination size
1,// Animation speed
_animationInfo10.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once
}var now=getNow();var dt=instance.lastTransformTime?(now-instance.lastTransformTime)/1000.0:0;var alpha=instance.render.status.getFade();var adjustedRotation=rotation-90*(Math.PI/180);if(instance.transformStage===2){var _destWidth23=scale*ratio*transformToInitialStageSpriteInfo.width*0.8;var _destHeight23=scale*ratio*transformToInitialStageSpriteInfo.height*0.8;instance.transformToInitialStageSprite.update2(dt,x,y,0,0,_destWidth23,_destHeight23,adjustedRotation,alpha);instance.transformToInitialStageSprite.render(ctx);}else if(instance.transformStage===3){var _destWidth24=scale*ratio*lastStageSpriteInfo.width*0.8;var _destHeight24=scale*ratio*lastStageSpriteInfo.height*0.8;instance.lastStageSprite.update2(dt,x,y,0,0,_destWidth24,_destHeight24,adjustedRotation,alpha);instance.lastStageSprite.render(ctx);}instance.lastTransformTime=now;if(instance.transformStage===3){instance.lastTransformTime=0;instance.lastStageSprite=null;instance.transformToInitialStageSprite=null;}};// =======================================================
// =============================================================
var displayShakingEarth=function displayShakingEarth(instance,scale,ratio,x,y,ctx){{var animationInfo=shakingEarthSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;if(!instance.shakingEarthSprite){instance.shakingEarthSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
12,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var now=getNow();var dt=instance.lastShakingEarthTime?(now-instance.lastShakingEarthTime)/1000.0:0;var alpha=instance.render.status.getFade();instance.shakingEarthSprite.update2(dt,x,y,0,0,destWidth,destHeight,0,alpha);instance.shakingEarthSprite.render(ctx);instance.lastShakingEarthTime=now;}};// =============================================================
var displayBlackholing=function displayBlackholing(instance,scale,ratio,x,y,ctx){var animationInfo=blackholeSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;if(!instance.blackholeSprite){instance.blackholeSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
12,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var now=getNow();var dt=instance.lastBlackholeTime?(now-instance.lastBlackholeTime)/1000.0:0;var destXOffset=scale*ratio*animationInfo.offsetX;var destYOffset=scale*ratio*animationInfo.offsetY;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.blackholeSprite.update2(dt,x,y,destXOffset,destYOffset,destWidth,destHeight,0,1);instance.blackholeSprite.render(ctx);instance.lastBlackholeTime=now;};// =============================================================
var displayWhiteholing=function displayWhiteholing(instance,scale,ratio,x,y,ctx){var animationInfo=whiteholeSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;if(!instance.whiteholeSprite){instance.whiteholeSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
10,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var now=getNow();var dt=instance.lastWhiteholeTime?(now-instance.lastWhiteholeTime)/1000.0:0;var destXOffset=scale*ratio*animationInfo.offsetX;var destYOffset=scale*ratio*animationInfo.offsetY;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.whiteholeSprite.update2(dt,x,y,destXOffset,destYOffset,destWidth,destHeight,0,1);instance.whiteholeSprite.render(ctx);instance.lastWhiteholeTime=now;};// =============================================================
var displayForceFielding=function displayForceFielding(instance,scale,ratio,x,y,ctx){var animationInfo=forceFieldBulletSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;if(instance.tankType===31){destWidth=scale*ratio*animationInfo.width*0.6;destHeight=scale*ratio*animationInfo.height*0.6;}if(!instance.forceFieldSprite){instance.forceFieldSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
16,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var now=Date.now();var dt=instance.lastForceFieldTime?(now-instance.lastForceFieldTime)/1000.0:0;var alpha=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight, rotation, alpha    
instance.forceFieldSprite.update2(dt,x,y,0,0,destWidth,destHeight,0,alpha);instance.forceFieldSprite.render(ctx);instance.lastForceFieldTime=now;};// =============================================================
var displayShockwaving=function displayShockwaving(instance,scale,ratio,x,y,ctx){var animationInfo=shockwaveEffectSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;if(!instance.shockwaveSprite){instance.shockwaveSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
16,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}var now=getNow();var dt=instance.shockwaveAnimTime?(now-instance.shockwaveAnimTime)/1000.0:0;var destXOffset=scale*ratio*animationInfo.offsetX;var destYOffset=scale*ratio*animationInfo.offsetY;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.shockwaveSprite.update2(dt,x,y,destXOffset,destYOffset,destWidth,destHeight,0,1);instance.shockwaveSprite.render(ctx);instance.shockwaveAnimTime=now;if(instance.shockwaveSprite.done){instance.shockwaveAnimTime=undefined;instance.shockwaveSprite=undefined;}};// =============================================================
// Get color
var config={graphical:{screenshotMode:false,borderChunk:6,barChunk:5,mininumBorderChunk:3,deathBlurAmount:3,darkBorders:false,fancyAnimations:true,colors:'normal',pointy:true,fontSizeBoost:1,neon:false},gui:{expectedMaxSkillLevel:9},lag:{unresponsive:false,memory:60}};var color={};//  util.pullJSON('color').then(data => color = data);
util.pullJSON('color').then(function(data){color=data;});// Color functions
var mixColors=function(){/** https://gist.github.com/jedfoster/7939513 **/function d2h(d){return d.toString(16);}// convert a decimal value to hex
function h2d(h){return parseInt(h,16);}// convert a hex value to decimal 
return function(color_2,color_1){var weight=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0.5;if(weight===1)return color_1;if(weight===0)return color_2;var col="#";for(var i=1;i<=6;i+=2){// loop through each of the 3 hex pairs—red, green, and blue, skip the '#'
var v1=h2d(color_1.substr(i,2)),// extract the current pairs
v2=h2d(color_2.substr(i,2)),// combine the current pairs from each source color, according to the specified weight
val=d2h(Math.floor(v2+(v1-v2)*weight));while(val.length<2){val='0'+val;}// prepend a '0' if val results in a single digit        
col+=val;// concatenate val to our new color string
}return col;// PROFIT!
};}();function getColor(colorNumber){// Custom color.
if(typeof colorNumber==='string'){return colorNumber;}switch(colorNumber){case 0:return color.teal;case 1:return color.lgreen;case 2:return color.orange;case 3:return color.yellow;case 4:return color.lavender;case 5:return color.pink;case 6:return color.vlgrey;case 7:return color.lgrey;case 8:return color.guiwhite;case 9:return color.black;case 10:return color.blue;case 11:return color.green;case 12:return color.red;case 13:return color.gold;case 14:return color.purple;case 15:return color.magenta;case 16:return color.grey;case 17:return color.dgrey;case 18:return color.white;case 19:return color.guiblack;default:return'#FF0000';}}// Chat color. Role color.
function getRoleColor(colorNumber){if(colorNumber===0){return'#3ac760';}else if(colorNumber===15){return'#CC669C';}// =================================
// Bug Finder chat color.
// =================================
else if(colorNumber===101){return'#40c1db';}// Honorary chat color.
else if(colorNumber===102){return'#e3b766';}// =================================
return getColor(colorNumber);}function getColorDark(givenColor){var dark=config.graphical.neon?color.white:color.black;if(config.graphical.darkBorders)return dark;var darkColor=mixColors(givenColor,dark,color.border);return darkColor;}// Ignore zone color for "ffa" game mode.
function getZoneColor(cell,real){if(global.gameMode==='tdm'||global.gameMode==='boss'){switch(cell){case'bas1':return color.blue;case'bas2':return color.green;case'bas3':return color.red;case'bas4'://return color.pink;
return color.magenta;}}return real?color.white:color.lgrey;}function setColor(context,givenColor){if(config.graphical.neon){context.fillStyle=getColorDark(givenColor);context.strokeStyle=givenColor;}else{context.fillStyle=givenColor;context.strokeStyle=getColorDark(givenColor);}}// Get mockups <3
var mockups=[];util.pullJSON('mockups').then(function(data){return mockups=data;});// Mockup functions
function getEntityImageFromMockup(index){var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:mockups[index].color;var mockup=mockups[index];return{time:0,index:index,x:mockup.x,y:mockup.y,vx:0,vy:0,size:mockup.size,realSize:mockup.realSize,color:color,render:{status:{getFade:function getFade(){return 1;},getColor:function getColor(){return'#FFFFFF';},getBlend:function getBlend(){return 0;},health:{get:function get(){return 1;}},shield:{get:function get(){return 1;}}}},facing:mockup.facing,shape:mockup.shape,name:mockup.name,score:0,tiggle:0,layer:mockup.layer,guns:{length:mockup.guns.length,getPositions:function getPositions(){var a=[];// MODIFIED: Commented out.
//mockup.guns.forEach(() => a.push(0));
// ===================================
// MODIFIED: Custom gun barrels.
// ===================================
mockup.guns.forEach(function(gun){// Show only normal gun barrels in upgrade
// menu and leaderboard (and death screen?).
// Doesn't seem to work for upgrade menu.                    
if(gun.gunType===0){a.push(0);}});// ===================================
return a;},update:function update(){}},turrets:mockup.turrets.map(function(t){// if (Math.random() > 0.93){
//     console.log('t.turretType=' + t.turretType);
// }            
var o=getEntityImageFromMockup(t.index);o.realSize=o.realSize/o.size*mockup.size*t.sizeFactor;o.size=mockup.size*t.sizeFactor;o.angle=t.angle;o.offset=t.offset;o.direction=t.direction;o.facing=t.direction+t.angle;return o;})// // Experiment: Turret type.
// // ===============================================
// .filter((t) => {
//     t.turretType === 0;
// })
// // ===============================================
};}// Define clickable regions
global.clickables=function(){var Region=function(){// Protected classes
function Clickable(){var region={x:0,y:0,w:0,h:0};var active=false;return{set:function set(x,y,w,h){region.x=x;region.y=y;region.w=w;region.h=h;active=true;},check:function check(target){var dx=Math.round(target.x-region.x);var dy=Math.round(target.y-region.y);return active&&dx>=0&&dy>=0&&dx<=region.w&&dy<=region.h;},hide:function hide(){active=false;}};}// Return the constructor
return function(size){// Define the region
var data=[];for(var i=0;i<size;i++){data.push(Clickable());}// Return the region methods
return{place:function place(index){for(var _len=arguments.length,a=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){a[_key-1]=arguments[_key];}/* MODIFIED: Commented out.
	                    if (index >= data.length) {
	                        console.log(index);
	                        console.log(data);
	                        throw new Error('Trying to reference a clickable outside a region!');
	                    }
	                    data[index].set(...a);
	                    */// ============================
if(index<data.length){var _data$index;(_data$index=data[index]).set.apply(_data$index,a);}else{console.log('[Warn]Trying to reference a clickable outside a region!');}// ============================
},hide:function hide(){data.forEach(function(r){return r.hide();});},check:function check(x){return data.findIndex(function(r){return r.check(x);});}};};}();return{stat:Region(10),//upgrade: Region(8),
// Upgrade menu.
//upgrade: Region(12),
// ========================
// More upgrade menus.
// ========================
upgrade:Region(24),hover:Region(1),skipUpgrades:Region(1)};}();global.statHover=false;global.upgradeHover=false;// Leader Tracker
// ===========================
var leader={id:-1,x:-1,y:-1};// ===========================
// Prepare stuff
var player={//Set up the player
id:-1,// Sandbox.
sandboxId:-1,x:global.screenWidth/2,y:global.screenHeight/2,vx:0,vy:0,renderx:global.screenWidth/2,rendery:global.screenHeight/2,renderv:1,slip:0,view:1,time:0,screenWidth:global.screenWidth,screenHeight:global.screenHeight,target:{x:global.screenWidth/2,y:global.screenHeight/2},underAttackType:0};var entities=[],users=[],minimap=[],upgradeSpin=0,messages=[],// MODIFIED: Chat system.
// =============================
chatMessages=[],// =============================    
messageFade=0,newMessage=0,metrics={latency:0,lag:0,rendertime:0,updatetime:0,lastlag:0,lastrender:0,rendergap:0,lastuplink:0},lastPing=0,renderTimes=0,updateTimes=0,target={x:player.x,y:player.y},roomSetup=[['norm']],roomSpeed=0;var _gui={getStatNames:function getStatNames(num){switch(num){case 1:return['Body Damage','Max Health','Bullet Speed','Bullet Health','Bullet Penetration','Bullet Damage','Engine Acceleration','Movement Speed','Shield Regeneration','Shield Capacity'];case 2:return['Body Damage','Max Health','Drone Speed','Drone Health','Drone Penetration','Drone Damage','Respawn Rate','Movement Speed','Shield Regeneration','Shield Capacity'];case 3:return['Body Damage','Max Health','Drone Speed','Drone Health','Drone Penetration','Drone Damage','Max Drone Count','Movement Speed','Shield Regeneration','Shield Capacity'];case 4:return['Body Damage','Max Health','Swarm Speed','Swarm Health','Swarm Penetration','Swarm Damage','Reload','Movement Speed','Shield Regeneration','Shield Capacity'];case 5:return['Body Damage','Max Health','Placement Speed','Trap Health','Trap Penetration','Trap Damage','Reload','Movement Speed','Shield Regeneration','Shield Capacity'];case 6:return['Body Damage','Max Health','Weapon Speed','Weapon Health','Weapon Penetration','Weapon Damage','Reload','Movement Speed','Shield Regeneration','Shield Capacity'];default:return['Body Damage','Max Health','Bullet Speed','Bullet Health','Bullet Penetration','Bullet Damage','Reload','Movement Speed','Shield Regeneration','Shield Capacity'];}},skills:[{amount:0,color:'purple',cap:1,softcap:1},{amount:0,color:'pink',cap:1,softcap:1},{amount:0,color:'blue',cap:1,softcap:1},{amount:0,color:'lgreen',cap:1,softcap:1},{amount:0,color:'red',cap:1,softcap:1},{amount:0,color:'yellow',cap:1,softcap:1},{amount:0,color:'green',cap:1,softcap:1},{amount:0,color:'teal',cap:1,softcap:1},{amount:0,color:'gold',cap:1,softcap:1},{amount:0,color:'orange',cap:1,softcap:1}],points:0,upgrades:[],playerid:-1,__s:function(){var truscore=0;var levelscore=0;var deduction=0;var level=0;var score=Smoothbar(0,10);return{setScore:function setScore(s){if(s){score.set(s);if(deduction>score.get()){level=0;deduction=0;}}else{score=Smoothbar(0,10);level=0;}},update:function update(){levelscore=Math.ceil(1.8*Math.pow(level+1,1.8)-2*level+1);if(score.get()-deduction>=levelscore){deduction+=levelscore;level+=1;}},getProgress:function getProgress(){return levelscore?Math.min(1,Math.max(0,(score.get()-deduction)/levelscore)):0;},getScore:function getScore(){return score.get();},getLevel:function getLevel(){return level;}};}(),type:0,fps:0,color:0,accel:0,topspeed:1};global.clearUpgrades=function(){_gui.upgrades=[];};// Build the leaderboard object
var _leaderboard=function(){var entries={};// Define a handler for a particular entry
function Entry(){var name=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var bar=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var color=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var roleColorIndex=arguments.length>3&&arguments[3]!==undefined?arguments[3]:undefined;var sandboxId=arguments.length>4&&arguments[4]!==undefined?arguments[4]:-1;// The data
var index=0,truscore=0,// ==============================================
// Authenticated player name.            
playerName=name,// Authenticated player role color index.            
playerRoleColorIndex=roleColorIndex,// ==============================================
playerSandboxId=sandboxId,score=Smoothbar(0,10);// These are the io functions
return{update:function update(i,s){index=i;score.set(s);},// MODIFIED: Update authenticated player name.
// =======================================
updateName:function updateName(n){playerName=n;},// =======================================
// MODIFIED: Update authenticated player role color index.
// =======================================
updateRoleColorIndex:function updateRoleColorIndex(n){playerRoleColorIndex=n;},// =======================================
publish:function publish(){// Return the data package
var ref=mockups[index];return{image:getEntityImageFromMockup(index,color),position:ref.position,barcolor:getColor(bar),//label: (name === '') ? ref.name : name + ' - ' + ref.name,
// Authenticated player name.
// ================================================
label:playerName===''?ref.name:playerName+' - '+ref.name,// ================================================
// Player role color index.
// ================================================
roleColorIndex:playerRoleColorIndex,// ================================================
// Sandbox.
sandboxId:playerSandboxId,score:score.get()};}};}// Return the leaderboard methods
return{get:function get(){var out=[],maxscore=1;for(var e in entries){if(!entries.hasOwnProperty(e))continue;var data=entries[e].publish();out.push(data);if(data.score>maxscore){maxscore=data.score;}}out.sort(function(a,b){return b.score-a.score;});return{data:out,max:maxscore};},remove:function remove(index){if(entries['_'+index]===undefined){console.log('Warning: Asked to removed an unknown leaderboard entry.');return-1;}delete entries['_'+index];},add:function add(data){// Player role color index. Sandbox.
//let newentry = Entry(data.name, data.barcolor, data.color, data.roleColorIndex, data.sandboxId);
var newentry=Entry(data.name,data.barcolor,data.color,data.roleColorIndex,data.sandboxId?data.sandboxId:-1);newentry.update(data.index,data.score);entries['_'+data.id]=newentry;},// Authenticated player name.
update:function update(data){if(entries['_'+data.id]===undefined){console.log('Warning: Asked to update an unknown leaderboard entry.');return-1;}entries['_'+data.id].update(data.index,data.score);// Authenticated player name.
// ============================================
//console.log('data.name=' + data.name);
entries['_'+data.id].updateName(data.name);// ============================================
// Player role color index.
// ============================================            
entries['_'+data.id].updateRoleColorIndex(data.roleColorIndex);// ============================================
},purge:function purge(){entries={};}};}();// The ratio finder
var getRatio=function getRatio(){return Math.max(global.screenWidth/player.renderv,global.screenHeight/player.renderv/9*16);};global.target=target;// Leader Tracker
// ==========================
global.leader=leader;// ==========================
global.player=player;// =====================================
// Chat system players list.
// =====================================
global.playersList=[];global.playersListIndex=0;global.selectedPlayerId=0;// =====================================
global.canUpgrade=false;global.canSkill=false;global.message='';global.time=0;// Window setup <3
global.mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);var serverName='Unknown Server';window.onload=function(){// Server name stuff
// switch (window.location.hostname) 
// {
//     case 'localhost':
//     case 'localhost:3000':        
//         serverName = 'localhost';
//         break;
//     case 'arrasio.me:3000':
//     case 'arrasio.me':
//     case 'arras.cc':
//         serverName = 'FFA Maze (Singapore)';
//         break;
//     case 'arras.fun':
//     case 'arras.cc:4000':
//         serverName = 'TDM Maze (Singapore)';
//         break;
//     case 'arras.cc:5000':
//         serverName = 'TDM Normal(Singapore)';
//         break;
//     case 'diep.fun':     
//     case 'arras.cc:7000':
//         serverName = 'Humans vs Zombies (Singapore)';
//         break;
//     case 'arras.pro':
//         serverName = 'FFA Maze (Dallas, US)';
//         break;
//     case 'arras.vip':
//     	serverName = 'FFA Maze (Germany)';
//     case 'arras.vip:4000':
//     	serverName = 'TDM Maze (Germany)';
//     	break;
// }
// document.getElementById('serverName').innerHTML = '<h2>' + serverName + '</h2>';
// Save forms
util.retrieveFromLocalStorage('playerNameInput');// util.retrieveFromLocalStorage('playerKeyInput');
// util.retrieveFromLocalStorage('optScreenshotMode');
// util.retrieveFromLocalStorage('optPredictive');
// util.retrieveFromLocalStorage('optFancy');
// util.retrieveFromLocalStorage('optNoPointy');
util.retrieveFromLocalStorage('optColors');util.retrieveFromLocalStorage('optBorders');// Set default theme
if(document.getElementById('optColors').value===''){document.getElementById('optColors').value='normal';}if(document.getElementById('optBorders').value===''){document.getElementById('optBorders').value='normal';}// MODIFIED: Force "classic colors and dark borders" theme.
// ====================================================
document.getElementById('optColors').value='classic';document.getElementById('optBorders').value='dark';// ====================================================
// Game start stuff
document.getElementById('startButton').onclick=function(){startGame();};document.onkeydown=function(e){var key=e.which||e.keyCode;// MODIFIED: Typo? "died" instead of "dead"?        
if(key===global.KEY_ENTER&&(global.died||!global.gameStart)){startGame();}};/* Original.
	    document.onkeydown = e => {
	        var key = e.which || e.keyCode;
	        if (key === global.KEY_ENTER && (global.dead || !global.gameStart)) {
	            startGame();
	        }
	    };
	    */// Resizing stuff
window.addEventListener('resize',function(){player.screenWidth=c.width=global.screenWidth=window.innerWidth;player.screenHeight=c.height=global.screenHeight=window.innerHeight;});};// Prepare canvas stuff
var Canvas=__webpack_require__(3);window.canvas=new Canvas();var c=window.canvas.cv;var ctx=c.getContext('2d');var c2=document.createElement('canvas');var ctx2=c2.getContext('2d');ctx2.imageSmoothingEnabled=false;// Animation things
function isInView(x,y,r){var mid=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var ratio=getRatio();r+=config.graphical.borderChunk;if(mid){ratio*=2;return x>-global.screenWidth/ratio-r&&x<global.screenWidth/ratio+r&&y>-global.screenHeight/ratio-r&&y<global.screenHeight/ratio+r;}return x>-r&&x<global.screenWidth/ratio+r&&y>-r&&y<global.screenHeight/ratio+r;}function Smoothbar(value,speed){var sharpness=arguments.length>2&&arguments[2]!==undefined?arguments[2]:3;var time=Date.now();var display=value;var oldvalue=value;return{set:function set(val){if(value!==val){oldvalue=display;value=val;time=Date.now();}},get:function get(){var timediff=(Date.now()-time)/1000;display=timediff<speed?oldvalue+(value-oldvalue)*Math.pow(timediff/speed,1/sharpness):value;return display;}};}// Some stuff we need before we can set up the socket
var sync=[];var clockDiff=0;var serverStart=0;var lag=function(){var lags=[];return{get:function get(){if(!lags.length)return 0;var sum=lags.reduce(function(a,b){return a+b;});return sum/lags.length;},add:function add(l){lags.push(l);if(lags.length>config.lag.memory){lags.splice(0,1);}}};}();var getNow=function getNow(){return Date.now()-clockDiff-serverStart;};var player={vx:0,vy:0,lastvx:0,lastvy:0,renderx:player.x,rendery:player.y,lastx:player.x,lasty:player.y,target:window.canvas.target,name:'',lastUpdate:0,time:0};// Jumping the gun on motion
var moveCompensation=function(){var xx=0,yy=0,vx=0,vy=0;return{reset:function reset(){xx=0;yy=0;},get:function get(){if(config.lag.unresponsive){return{x:0,y:0};}return{x:xx,y:yy};},iterate:function iterate(g){if(global.died||global.gameStart)return 0;// Add motion
var damp=_gui.accel/_gui.topSpeed,len=Math.sqrt(g.x*g.x+g.y*g.y);vx+=_gui.accel*g.x/len;vy+=_gui.accel*g.y/len;// Dampen motion
var motion=Math.sqrt(vx*vx+vy*vy);if(motion>0&&damp){var finalvelocity=motion/(damp/roomSpeed+1);vx=finalvelocity*vx/motion;vy=finalvelocity*vy/motion;}xx+=vx;yy+=vy;}};}();// Prepare the websocket for definition
var socketInit=function(){// Inital setup stuff
window.WebSocket=window.WebSocket||window.MozWebSocket;var protocol=__webpack_require__(4);// This is what we use to figure out what the hell the server is telling us to look at
var convert=function(){// Make a data crawler
var get=function(){var index=0,crawlData=[];return{next:function next(){if(index>=crawlData.length){console.log(crawlData);throw new Error('Trying to crawl past the end of the provided data!');}else{return crawlData[index++];}},set:function set(data){crawlData=data;index=0;}};}();// Return our handlers 
return{begin:function begin(data){return get.set(data);},// Make a data convertor
data:function(){// Make a converter
var process=function(){// Some status manager constructors
var GunContainer=function(){function physics(g){g.isUpdated=true;if(g.motion||g.position){// Simulate recoil
g.motion-=0.2*g.position;g.position+=g.motion;if(g.position<0){// Bouncing off the back
g.position=0;g.motion=-g.motion;}if(g.motion>0){g.motion*=0.5;}}}return function(n){var a=[];for(var i=0;i<n;i++){a.push({motion:0,position:0,isUpdated:true});}return{getPositions:function getPositions(){return a.map(function(g){return g.position;});},update:function update(){return a.forEach(physics);},fire:function fire(i,power){if(a[i].isUpdated)a[i].motion+=Math.sqrt(power)/20;a[i].isUpdated=false;},length:a.length};};}();function Status(){var state='normal',time=getNow();return{set:function set(val){if(val!==state||state==='injured'){if(state!=='dying')time=getNow();state=val;}},getFade:function getFade(){return state==='dying'||state==='killed'?1-Math.min(1,(getNow()-time)/300):1;// Death explosion experiment.
// ====================================================================================
// Modified so that there is enough time for explosion animation.
//return (state === 'dying' || state === 'killed') ? 1 - Math.min(1, (getNow() - time) / 1000) : 1;
// ====================================================================================
},// Death explosion.
// ====================
getSlowFade:function getSlowFade(){return state==='dying'||state==='killed'?1-Math.min(1,(getNow()-time)/900):1;},getState:function getState(){return state;},// ====================
getColor:function getColor(){return'#FFFFFF';},getBlend:function getBlend(){var o=state==='normal'||state==='dying'?0:1-Math.min(1,(getNow()-time)/80);if(getNow()-time>500&&state==='injured'){state='normal';}return o;}};}// Death explosion experiment.
// ===================================
/*
	                    function Health() 
	                    {
	                        let amount = 1;
	                            
	                        return {
	                            set: val => {
	                                amount = val;
	                            },                                                        
	                        };
	                    }*/// ===================================
// Return our function
return function(){var z=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var isNew=z.facing==null;// For whatever reason arguments.length is uglified poorly...
// Figure out what kind of data we're looking at
var type=get.next();// Handle it appropiately
if(type&0x01){// issa turret
z.facing=get.next();z.layer=get.next();}else{// issa something real
z.interval=metrics.rendergap;z.id=get.next();// Determine if this is an new entity or if we already know about it
var iii=entities.findIndex(function(x){return x.id===z.id;});if(iii!==-1){// remove it if needed (this way we'll only be left with the dead/unused entities)
z=entities.splice(iii,1)[0];}// Change the use of the variable
isNew=iii===-1;// If it's not new, save the memory data
if(!isNew){z.render.draws=true;// yay!!
z.render.lastx=z.x;z.render.lasty=z.y;z.render.lastvx=z.vx;z.render.lastvy=z.vy;z.render.lastf=z.facing;z.render.lastRender=player.time;}// Either way, keep pulling information
z.index=get.next();z.x=get.next();z.y=get.next();z.vx=get.next();z.vy=get.next();z.size=get.next();z.facing=get.next();z.vfacing=get.next();z.twiggle=get.next();z.layer=get.next();z.color=get.next();// Custom color.
// console.log('z.color: ' + z.color);
// MODIFIED: Invisibility. Cloaking.
// =======================================
z.opacity=get.next();// =======================================
// MODIFIED: Teleportation.
// =======================================
z.teleporting=get.next();z.teleportDir=get.next();// =======================================
// Frozen by Freeze Gun.
//z.frozen = get.next();
//z.underAttack = get.next();
z.underAttackType=get.next();// Modified: Shaking earth. Earthshaker.
//z.shakingEarth = get.next();
//z.blackholing = get.next();
// ====================================
// Predator zoom experiment.
// ====================================
z.canZoom=get.next();// ====================================
// Special skill.
z.usingPower=get.next();// MODIFIED: Tank transformation.                            
z.transformStage=get.next();// MODIFIED: Firing.
z.firing=get.next();z.shooting=get.next();// MODIFIED: Moving speed.
z.movingSpeed=get.next();z.victimX=get.next();z.victimY=get.next();z.victimId=get.next();// Modified: User account role color index.
z.roleColorIndex=get.next();// MODIFIED: Tank type.                            
z.tankType=get.next();// MODIFIED: Sub type.                            
z.subType=get.next();// Maze wall.
z.sizeVert=get.next();z.rotation=get.next();z.useImage=get.next();//z.useCustomColor = get.next();
z.team=get.next();// =======================================
// Update health, flagging as injured if needed
if(isNew){z.health=get.next()/255;z.shield=get.next()/255;}else{var hh=z.health,ss=z.shield;z.health=get.next()/255;z.shield=get.next()/255;// Update stuff                                                                
if(z.health<hh||z.shield<ss){z.render.status.set('injured');}else if(z.render.status.getFade()!==1){// If it turns out that we thought it was dead and it wasn't
z.render.status.set('normal');}}z.drawsHealth=!!(type&0x02);// force to boolean
// Nameplates
if(type&0x04){// has a nameplate
z.name=get.next();z.score=get.next();}z.nameplate=type&0x04;// If it's new, give it rendering information
if(isNew){z.render={draws:false,//expandsWithDeath: z.drawsHealth,
// MODIFIED: Drawing death
expandsWithDeath:false,lastRender:player.time,x:z.x,y:z.y,lastx:z.x-metrics.rendergap*config.roomSpeed*(1000/30)*z.vx,lasty:z.y-metrics.rendergap*config.roomSpeed*(1000/30)*z.vy,lastvx:z.vx,lastvy:z.vy,lastf:z.facing,f:z.facing,h:z.health,s:z.shield,interval:metrics.rendergap,slip:0,status:Status(),health:Smoothbar(z.health,0.5,5),shield:Smoothbar(z.shield,0.5,5)};}// Update the rendering healthbars
z.render.health.set(z.health);z.render.shield.set(z.shield);// Figure out if the class changed (and if so, refresh the guns and turrets)
if(!isNew&&z.oldIndex!==z.index)isNew=true;z.oldIndex=z.index;}// If it needs to have a gun container made, make one
var gunnumb=get.next();if(isNew){z.guns=GunContainer(gunnumb);}else if(gunnumb!==z.guns.length){throw new Error('Mismatch between data gun number and remembered gun number!');}// Decide if guns need to be fired one by one
for(var i=0;i<gunnumb;i++){var time=get.next(),power=get.next();if(time>player.lastUpdate-metrics.rendergap){// shoot it
z.guns.fire(i,power);}}// Update turrets
var turnumb=get.next();if(turnumb){var b=1;}if(isNew){z.turrets=[];for(var _i=0;_i<turnumb;_i++){z.turrets.push(process());}}else{if(z.turrets.length!==turnumb){throw new Error('Mismatch between data turret number and remembered turret number!');}z.turrets.forEach(function(tur){tur=process(tur);});}// Return our monsterous creation
return z;};}();// And this is the function we return that crawls some given data and reports it
return function(){// Set up the output thingy+
var output=[];// Get the number of entities and work through them
for(var i=0,len=get.next();i<len;i++){output.push(process());}// Handle the dead/leftover entities
entities.forEach(function(e){// Kill them
e.render.status.set(e.health===1?'dying':'killed');// And only push them if they're not entirely dead and still visible
/* Original.
	                        if (e.render.status.getFade() !== 0 && 
	                            isInView(e.render.x - player.renderx, e.render.y - player.rendery, e.size, true)) 
	                        {
	                            output.push(e);
	                        } 
	                        else 
	                        {
	                            if (e.render.textobjs != null) e.render.textobjs.forEach(o => o.remove());
	                        }*/// ===============================================
// Predator zoom experiment.
// ===============================================
// if (e.canZoom === 1){
//     if (e.render.status.getSlowFade() !== 0) {
//         output.push(e);
//     }
//     else {
//         if (e.render.textobjs != null) e.render.textobjs.forEach(o => o.remove());
//     }
// }
// else {
//     if (e.render.status.getSlowFade() !== 0 &&
//         isInView(e.render.x - player.renderx,
//             e.render.y - player.rendery, e.size, true)) {
//         output.push(e);
//     }
//     else {
//         if (e.render.textobjs != null) e.render.textobjs.forEach(o => o.remove());
//     }
// }
if(e.render.status.getSlowFade()!==0&&isInView(e.render.x-player.renderx,e.render.y-player.rendery,e.size,true)){output.push(e);}else{if(e.render.textobjs!=null)e.render.textobjs.forEach(function(o){return o.remove();});}// ===============================================
});// Save the new entities list
entities=output;entities.sort(function(a,b){var sort=a.layer-b.layer;if(!sort)sort=b.id-a.id;if(!sort)throw new Error('tha fuq is up now');return sort;});};}(),// Define our gui convertor
gui:function gui(){var index=get.next(),// Translate the encoded index
indices={topspeed:index&0x0100,accel:index&0x0080,skills:index&0x0040,statsdata:index&0x0020,upgrades:index&0x0010,points:index&0x0008,score:index&0x0004,label:index&0x0002,fps:index&0x0001};// Operate only on the values provided
if(indices.fps){_gui.fps=get.next();}if(indices.label){_gui.type=get.next();_gui.color=get.next();_gui.playerid=get.next();}if(indices.score){_gui.__s.setScore(get.next());}if(indices.points){_gui.points=get.next();}if(indices.upgrades){_gui.upgrades=[];for(var i=0,len=get.next();i<len;i++){_gui.upgrades.push(get.next());}}if(indices.statsdata){for(var _i2=9;_i2>=0;_i2--){_gui.skills[_i2].name=get.next();_gui.skills[_i2].cap=get.next();_gui.skills[_i2].softcap=get.next();}}if(indices.skills){var skk=parseInt(get.next(),36).toString(16);skk='0000000000'.substr(skk.length)+skk;_gui.skills[0].amount=parseInt(skk.slice(0,1),16);_gui.skills[1].amount=parseInt(skk.slice(1,2),16);_gui.skills[2].amount=parseInt(skk.slice(2,3),16);_gui.skills[3].amount=parseInt(skk.slice(3,4),16);_gui.skills[4].amount=parseInt(skk.slice(4,5),16);_gui.skills[5].amount=parseInt(skk.slice(5,6),16);_gui.skills[6].amount=parseInt(skk.slice(6,7),16);_gui.skills[7].amount=parseInt(skk.slice(7,8),16);_gui.skills[8].amount=parseInt(skk.slice(8,9),16);_gui.skills[9].amount=parseInt(skk.slice(9,10),16);}if(indices.accel){_gui.accel=get.next();}if(indices.topspeed){_gui.topspeed=get.next();}},// ======================================================
// Make a minimap convertor
// ======================================================
minimap:function(){var loop=function(){// A test function
function challenge(value,challenger){return value[0]===challenger[0]&&value[1]===challenger[1]&&value[2]===challenger[2]&&// ============================================================
// Rectangular maze walls.
// ============================================================
value[3]===challenger[3]&&value[4]===challenger[4]&&value[5]===challenger[5];// ============================================================
}// The loop function definition
return function(){// Pull the update order
var type=get.next(),x=get.next()*global.gameWidth/255,y=get.next()*global.gameHeight/255,color=get.next(),// ============================================================
// Rectangular maze walls.
// ============================================================
size=get.next(),sizeVert=get.next(),rotation=get.next(),entType=get.next();// ============================================================
// Fufill the order
switch(type){case-1:{// removal
//let index = minimap.findIndex(e => challenge(e, [x, y, color]));
// ============================================================
// Rectangular maze walls.
// ============================================================
var index=minimap.findIndex(function(e){return challenge(e,[x,y,color,size,sizeVert,rotation,entType]);});// ============================================================
if(index===-1){console.log('Warning: Remove request for a minimap node we were not aware of.');}else{minimap.splice(index,1);}}break;case 1:{//insertion
//minimap.push([x, y, color]);
// ============================================================
// Rectangular maze walls.
// ============================================================
minimap.push([x,y,color,size,sizeVert,rotation,entType]);// ============================================================
}break;default:console.log('Unknown minimap update request.');}};}();// The update function
return function(){for(var i=0,len=get.next();i<len;i++){loop();}};}(),// ======================================================
// Define our leaderboard convertor
leaderboard:function leaderboard(){var whoopswedesynced=false;// First crawl the remove orders
var first=get.next();if(first===-1){// o shit its a full refresh, nuke it and start over
_leaderboard.purge();}else{// Remove things normally
for(var i=0,len=first;i<len;i++){_leaderboard.remove(get.next());}}// Then do the next things
for(var _i3=0,_len2=get.next();_i3<_len2;_i3++){var next=get.next();if(next<0){// It's an add index!
var toadd={id:-next,score:get.next(),index:get.next(),name:get.next(),color:get.next(),barcolor:get.next(),// Player leaderboard name in role color.
roleColorIndex:get.next(),// Sandbox.
sandboxId:get.next()};// Sandbox.
// if (global.player.sandboxId >= 0){
//     toadd.sandboxId = get.next();
// }
_leaderboard.add(toadd);}else{// It's an update index!
var toUpdate={id:next,score:get.next(),index:get.next(),// Authenticated player name.
// ==============================
name:get.next(),// ==============================
// Player leaderboard name in role color.
roleColorIndex:get.next(),// Sandbox.
sandboxId:get.next()};// Sandbox.
// if (global.player.sandboxId >= 0){
//     toUpdate.sandboxId = get.next();
// }
// Authenticated player name.
var w=_leaderboard.update(toUpdate);if(w===-1)whoopswedesynced=true;}}return whoopswedesynced;}};}();// The initialization function (this is returned)
return function(port){var oDropdown=$("#servers").msDropdown().data("dd");//console.log('selected server:' + oDropdown.value);
var selectedServer=oDropdown.value;// arras.cc:3000  => arras.cc
// localhost:3000 => localhost
serverName=selectedServer.split(':')[0];// selectedServer = 'localhost:3000';
// https://developer.mozilla.org/en-US/docs/Web/API/Location
// if (window.location.hostname.includes('localhost')){
//     selectedServer = window.location.host;        
//     console.log('localhost!');
// }        
//let socket = new WebSocket('ws://' + window.location.hostname + ':' + port);
//let socket = new WebSocket('ws://' + selectedServer + ':' + port);
var socket=new WebSocket('wss://'+selectedServer);// Set up our socket
socket.binaryType='arraybuffer';socket.open=false;// Handle commands
socket.cmd=function(){var flag=false;var commands=[false,// up
false,// down
false,// left
false,// right
false,// lmb
false,// mmb
false,// rmb 
false];return{set:function set(index,value){if(commands[index]!==value){commands[index]=value;flag=true;}},talk:function talk(){flag=false;var o=0;for(var i=0;i<8;i++){if(commands[i])o+=Math.pow(2,i);}var ratio=getRatio();socket.talk('C',Math.round(window.canvas.target.x/ratio),Math.round(window.canvas.target.y/ratio),o);},check:function check(){return flag;},getMotion:function getMotion(){return{x:commands[3]-commands[2],y:commands[1]-commands[0]};}};}();// Learn how to talk
socket.talk=function(){for(var _len3=arguments.length,message=Array(_len3),_key2=0;_key2<_len3;_key2++){message[_key2]=arguments[_key2];}// Make sure the socket is open before we do anything
if(!socket.open)return 1;socket.send(protocol.encode(message));};// Websocket functions for when stuff happens
// This is for when the socket first opens
socket.onopen=function socketOpen(){socket.open=true;//global.message = 'That token is invalid, expired, or already in use on this server. Please try another one!';
//global.message = 'Invalid Password';
socket.talk('k',global.playerKey);//socket.talk('k', '');
//console.log('Token submitted to the server for validation.');
// define a pinging function
socket.ping=function(payload){socket.talk('p',payload);};socket.commandCycle=setInterval(function(){if(socket.cmd.check())socket.cmd.talk();});};// Handle incoming messages
socket.onmessage=function socketMessage(message){// Make sure it looks legit.
var m=protocol.decode(message.data);if(m===-1){throw new Error('Malformed packet.');}// Decide how to interpret it
switch(m.splice(0,1)[0]){case'w':{// welcome to the game
if(m[0]){// Ask to spawn                    
console.log('The server has welcomed us to the game room. Sending spawn request.');socket.talk('s',global.playerName,1);global.message='';}}break;// =========================================
// Receive game mode.
// =========================================
case'G':{var gameMode=m[0];var sandboxId=m[1];console.log('Game Mode: '+gameMode);console.log('Sandbox Id: '+sandboxId);global.gameMode=gameMode;if(global.player){player.sandboxId=sandboxId;global.player.sandboxId=sandboxId;}}break;// =========================================
// Receive sandbox id.
// =========================================
// case 'J':
//     {
//         if (global.player) {
//             console.log('Sandbox id received: ' + m[0]);
//             player.sandboxId = m[0];
//             global.player.sandboxId = m[0];
//         }                        
//     }
//     break;                                
// =========================================
// Receive player id.
// =========================================
case'I':{if(global.player){console.log('Player id received: '+m[0]);player.id=m[0];global.player.id=m[0];}}break;// =========================================
// Receive player name.
// =========================================
case'N':{if(global.player){console.log('Player name received: '+m[0]);global.playerName=player.name=m[0];}}break;// =========================================
// Receive players list.
// =========================================
case'L':{// ======================================================================
// The array contains alternate id, name, and role color number.
// For example:
// m[0] => Player Id
// m[1] => Player Name
// m[2] => Role Color
// m[3] => Player Id
// m[4] => Player Name
// m[5] => Role Color
// ======================================================================
global.playersList=m;}break;// =========================================
case'R':{// room setup
global.gameWidth=m[0];global.gameHeight=m[1];roomSetup=JSON.parse(m[2]);serverStart=JSON.parse(m[3]);config.roomSpeed=m[4];console.log('Room data recieved. Commencing syncing process.');// Start the syncing process
socket.talk('S',getNow());}break;case'c':{// force camera move
player.renderx=player.x=m[0];player.rendery=player.y=m[1];player.renderv=player.view=m[2];console.log('Camera moved!');}break;case'S':{// clock syncing
var clientTime=m[0],serverTime=m[1],laten=(getNow()-clientTime)/2,delta=getNow()-laten-serverTime;// Add the datapoint to the syncing data
sync.push({delta:delta,latency:laten});// Do it again a couple times
if(sync.length<10){// Wait a bit just to space things out
setTimeout(function(){socket.talk('S',getNow());},10);global.message="Syncing clocks, please do not tab away. "+sync.length+"/10...";}else{// Calculate the clock error
sync.sort(function(e,f){return e.latency-f.latency;});var median=sync[Math.floor(sync.length/2)].latency;var sd=0,sum=0,valid=0;sync.forEach(function(e){sd+=Math.pow(e.latency-median,2);});sd=Math.sqrt(sd/sync.length);sync.forEach(function(e){if(Math.abs(e.latency-median)<sd){sum+=e.delta;valid++;}});clockDiff=Math.round(sum/valid);// Start the game
console.log(sync);console.log('Syncing complete, calculated clock difference '+clockDiff+'ms. Beginning game.');global.gameStart=true;global.message='';}}break;case'm':{// message
messages.push({text:m[0],status:2,alpha:0,time:Date.now(),// ======================================
// Modified: Body send message color.
// ======================================
colorIndex:m[1]// ======================================
});}break;// MODIFIED: Chat system.
case'h':{// Chat message
chatMessages.push({status:2,alpha:0,time:Date.now(),playerName:m[0],text:m[1],colorIndex:m[2]});}break;// =============================
case'u':{// uplink
// Pull the camera info
var camtime=m[0],camx=m[1],camy=m[2],camfov=m[3],camvx=m[4],camvy=m[5],// ===========================
// Leader Tracker.
// ===========================
leaderId=m[6],leaderX=m[7],leaderY=m[8],// ===========================
// ===========================
// Earthshaker.
// ===========================
//earthShaken = m[9],
// ===========================
// ===========================
// Flash Bomb.
// ===========================
//flashBombed = m[10],
underAttackType=m[9],// ===========================
// We'll have to do protocol decoding on the remaining data
//theshit = m.slice(9);
//theshit = m.slice(11);
theshit=m.slice(10);// =============================
// Leader Tracker.
// =============================
global.leader.id=leaderId;global.leader.x=leaderX;global.leader.y=leaderY;// =============================
// For Flashbomb and Earthshaker.
player.underAttackType=underAttackType;//console.log('leaderX='+leaderX + ', leaderY=' + leaderY);
// Process the data
if(camtime>player.lastUpdate){// Don't accept out-of-date information. 
// Time shenanigans
lag.add(getNow()-camtime);player.time=camtime+lag.get();metrics.rendergap=camtime-player.lastUpdate;if(metrics.rendergap<=0){console.log('yo some bullshit is up wtf');}player.lastUpdate=camtime;// Convert the gui and entities
convert.begin(theshit);convert.gui();convert.data();// Save old physics values
player.lastx=player.x;player.lasty=player.y;player.lastvx=player.vx;player.lastvy=player.vy;// Get new physics values
player.x=camx;player.y=camy;// ================================================
// Death camera experiment.
// ================================================
// Original.
player.vx=global.died?0:camvx;player.vy=global.died?0:camvy;//player.vx = camvx;
//player.vy = camvy;
// ================================================
// Figure out where we're rendering if we don't yet know
if(isNaN(player.renderx)){player.renderx=player.x;}if(isNaN(player.rendery)){player.rendery=player.y;}moveCompensation.reset();// Fov stuff
player.view=camfov;if(isNaN(player.renderv)||player.renderv===0){player.renderv=2000;}// Metrics
metrics.lastlag=metrics.lag;metrics.lastuplink=getNow();}else{console.log("Old data! Last given time: "+player.time+"; offered packet timestamp: "+camtime+".");}// Send the downlink and the target
socket.talk('d',Math.max(player.lastUpdate,camtime));socket.cmd.talk();updateTimes++;// metrics                                        
}break;case'b':{// broadcasted minimap
convert.begin(m);convert.minimap();// Sandbox.
// Display leaderboard if it is not sandbox mode.
//if (global.player.sandboxId < 0)
{if(convert.leaderboard()){// Request an update because of desync
socket.talk('z');}}}break;case'p':{// ping
metrics.latency=global.time-m[0];}break;case'F':{// to pay respects
global.finalScore=Smoothbar(0,4);global.finalScore.set(m[0]);global.finalLifetime=Smoothbar(0,5);global.finalLifetime.set(m[1]);global.finalKills=[Smoothbar(0,3),Smoothbar(0,4.5),Smoothbar(0,2.5)];global.finalKills[0].set(m[2]);global.finalKills[1].set(m[3]);global.finalKills[2].set(m[4]);global.finalKillers=[];for(var i=0;i<m[5];i++){global.finalKillers.push(m[6+i]);}global.died=true;window.onbeforeunload=function(){return false;};}break;case'K':{// kicked
global.message=m[0];window.onbeforeunload=function(){return false;};}break;default:throw new Error('Unknown message index.');}};// Handle closing 
socket.onclose=function socketClose(){socket.open=false;global.disconnected=true;clearInterval(socket.commandCycle);window.onbeforeunload=function(){return false;};console.log('Socket closed.');};// Notify about errors
socket.onerror=function socketError(error){console.log('WebSocket error: '+error);//console.log(Object.keys(error));
global.message='Socket error. Maybe another server will work.';};// Gift it to the rest of the world
return socket;};}();// This starts the game and sets up the websocket
function startGame(){// Get options
//util.submitToLocalStorage('optScreenshotMode');
config.graphical.screenshotMode=false;//document.getElementById('optScreenshotMode').checked;
//util.submitToLocalStorage('optFancy');
config.graphical.pointy=false;//!document.getElementById('optNoPointy').checked;
//util.submitToLocalStorage('optNoPointy');
config.graphical.fancyAnimations=true;//!document.getElementById('optFancy').checked;
//util.submitToLocalStorage('optPredictive');
config.lag.unresponsive=true;//document.getElementById('optPredictive').checked;
util.submitToLocalStorage('optBorders');switch(document.getElementById('optBorders').value){case'normal':config.graphical.darkBorders=config.graphical.neon=false;break;case'dark':config.graphical.darkBorders=true;config.graphical.neon=false;break;case'glass':config.graphical.darkBorders=false;config.graphical.neon=true;break;case'neon':config.graphical.darkBorders=config.graphical.neon=true;break;}util.submitToLocalStorage('optColors');var a=document.getElementById('optColors').value;color=color[a===''?'normal':a];// Other more important stuff
var playerNameInput=document.getElementById('playerNameInput');var playerKeyInput=document.getElementById('playerKeyInput');// Name and keys
util.submitToLocalStorage('playerNameInput');util.submitToLocalStorage('playerKeyInput');global.playerName=player.name=playerNameInput.value;global.playerKey=playerKeyInput.value.replace(/(<([^>]+)>)/ig,'').substring(0,8);// Change the screen
global.screenWidth=window.innerWidth;global.screenHeight=window.innerHeight;document.getElementById('startMenuWrapper').style.maxHeight='0px';document.getElementById('gameAreaWrapper').style.opacity=1;// Set up the socket
if(!global.socket){//global.socket = socketInit(3000);
global.socket=socketInit();}if(!global.animLoopHandle){animloop();}window.canvas.socket=global.socket;minimap=[];setInterval(function(){return moveCompensation.iterate(global.socket.cmd.getMotion());},1000/30);document.getElementById('gameCanvas').focus();window.onbeforeunload=function(){return true;};}// Background clearing
function clearScreen(clearColor,alpha){ctx.fillStyle=clearColor;ctx.globalAlpha=alpha;ctx.fillRect(0,0,global.screenWidth,global.screenHeight);ctx.globalAlpha=1;}// =====================================
// In-game chat.
// =====================================
/*
	const measureInGameChatText = (() => {
	    let div = document.createElement('div');    
	    document.body.appendChild(div);
	    return (text, fontSize, twod = false) => {
	        fontSize += config.graphical.fontSizeBoost;
	        var w, h;
	        div.style.font = 'bold ' + fontSize + 'px Ubuntu';
	        div.style.padding = '0';
	        div.style.margin = '0';
	        div.style.position = 'absolute';
	        div.style.visibility = 'hidden';        
	        div.innerHTML = text;
	        w = div.clientWidth;
	        h = div.clientHeight;
	        return (twod) ? {
	            width: w,
	            height: h
	        } : w;
	    };
	})();*/// =====================================
// Text functions
var measureText=function(){var div=document.createElement('div');document.body.appendChild(div);return function(text,fontSize){var twod=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;fontSize+=config.graphical.fontSizeBoost;var w,h;div.style.font='bold '+fontSize+'px Ubuntu';//div.style.font = 'bold ' + fontSize + 'px Verdana';
div.style.padding='0';div.style.margin='0';div.style.position='absolute';div.style.visibility='hidden';div.innerHTML=text;w=div.clientWidth;h=div.clientHeight;return twod?{width:w,height:h}:w;};}();var TextObj=function(){// A thing
var floppy=function floppy(){var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var flagged=true;// Methods
return{update:function update(newValue){var eh=false;if(value==null){eh=true;}else{if((typeof newValue==="undefined"?"undefined":_typeof(newValue))!=(typeof value==="undefined"?"undefined":_typeof(value))){eh=true;}// Decide what to do based on what type it is
switch(typeof newValue==="undefined"?"undefined":_typeof(newValue)){case'number':case'string':{if(newValue!==value){eh=true;}}break;case'object':{if(Array.isArray(newValue)){if(newValue.length!==value.length){eh=true;}else{for(var i=0,len=newValue.length;i<len;i++){if(newValue[i]!==value[i])eh=true;}}break;}}// jshint ignore:line
default:console.log(newValue);throw new Error('Unsupported type for a floppyvar!');}}// Update if neeeded
if(eh){flagged=true;value=newValue;}},publish:function publish(){return value;},check:function check(){if(flagged){flagged=false;return true;}return false;}};};// An index
var index=0;return function(){var textcanvas=document.createElement('canvas');var canvasId='textCanvasNo'+index++;textcanvas.setAttribute('id',canvasId);var tctx=textcanvas.getContext('2d');tctx.imageSmoothingEnabled=false;// Init stuff
var floppies=[floppy(''),floppy(0),floppy(0),floppy(1),floppy('#FF0000'),floppy('left')];var vals=floppies.map(function(f){return f.publish();});var xx=0;var yy=0;return{draw:function draw(text,x,y,size,fill){var align=arguments.length>5&&arguments[5]!==undefined?arguments[5]:'left';var center=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var fade=arguments.length>7&&arguments[7]!==undefined?arguments[7]:1;size+=config.graphical.fontSizeBoost;// Update stuff
floppies[0].update(text);floppies[1].update(x);floppies[2].update(y);floppies[3].update(size);floppies[4].update(fill);floppies[5].update(align);// Check stuff
if(floppies.some(function(f){return f.check();})){// Get text dimensions and resize/reset the canvas
var offset=Math.max(3,size/5);var dim=measureText(text,size-config.graphical.fontSizeBoost,true);tctx.canvas.height=dim.height+2*offset;tctx.canvas.width=dim.width+2*offset;// Redraw it
switch(align){case'left':case'start':xx=offset;break;case'center':xx=tctx.canvas.width/2;break;case'right':case'end':xx=tctx.canvas.width-offset;break;}yy=tctx.canvas.height/2;// Draw it
tctx.lineWidth=offset;tctx.font='bold '+size+'px Ubuntu';//tctx.font = 'bold ' + size + 'px Verdana';
tctx.textAlign=align;tctx.textBaseline='middle';tctx.strokeStyle=color.black;tctx.fillStyle=fill;tctx.lineCap='round';tctx.lineJoin='round';tctx.strokeText(text,xx,yy);tctx.fillText(text,xx,yy);}// Draw the cached text
ctx.save();ctx.imageSmoothingEnabled=false;ctx.drawImage(tctx.canvas,x-xx,y-yy*(1.05+!center*0.45));ctx.restore();},remove:function remove(){var element=document.getElementById(canvasId);if(element!=null)element.parentNode.removeChild(element);}};};}();// Leader Tracker
// ==========================================================================
function drawGuiCircle(x,y,radius){// void ctx.arc(x, y, radius, startAngle, endAngle [, anticlockwise]);    
ctx.beginPath();ctx.arc(x,y,radius,0,Math.PI*2);ctx.stroke();ctx.fill();}// ==========================================================================
// Gui drawing functions
function drawGuiRect(x,y,length,height){var stroke=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;switch(stroke){case true:ctx.strokeRect(x,y,length,height);break;case false:ctx.fillRect(x,y,length,height);break;}}function drawGuiLine(x1,y1,x2,y2){ctx.beginPath();ctx.lineTo(Math.round(x1)+0.5,Math.round(y1)+0.5);ctx.lineTo(Math.round(x2)+0.5,Math.round(y2)+0.5);ctx.closePath();ctx.stroke();}function drawBar(x1,x2,y,lineThickness,color){ctx.beginPath();ctx.lineTo(x1,y);ctx.lineTo(x2,y);ctx.lineWidth=lineThickness;ctx.strokeStyle=color;ctx.closePath();ctx.stroke();}// ==================================
// Entity drawing (this is a function that makes a function)
var drawEntity=function(){// Sub-drawing functions
function drawRectangle(context,centerX,centerY,width,height){// Start drawing        
//context.beginPath();
context.save();context.beginPath();var rectX=centerX-width;var rectY=centerY-height;context.rect(rectX,rectY,width*2,height*2);//context.restore();
context.closePath();context.stroke();context.fill();context.restore();//context.lineJoin = 'round';
}function drawRectangleWithRotation(context,centerX,centerY,width,height,rot){// Start drawing                
context.save();context.beginPath();// https://stackoverflow.com/questions/17125632/html5-canvas-rotate-object-without-moving-coordinates
// move the rotation point to the center of the rect
context.translate(centerX,centerY);context.rotate(rot);// draw the rect on the transformed context
// Note: after transforming [0,0] is visually [x,y]
//       so the rect needs to be offset accordingly when drawn
context.rect(-width,-height,width*2,height*2);//context.restore();
context.closePath();context.stroke();context.fill();context.restore();}function drawPoly(context,centerX,centerY,radius,sides){var angle=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var fill=arguments.length>6&&arguments[6]!==undefined?arguments[6]:true;angle+=sides%2?0:Math.PI/sides;// Start drawing        
context.beginPath();if(!sides){// Circle
context.arc(centerX,centerY,radius,0,2*Math.PI);}else if(sides<0){// Star
if(config.graphical.pointy)context.lineJoin='miter';var dip=1-6/sides/sides;sides=-sides;context.moveTo(centerX+radius*Math.cos(angle),centerY+radius*Math.sin(angle));for(var i=0;i<sides;i++){var theta=(i+1)/sides*2*Math.PI;var htheta=(i+0.5)/sides*2*Math.PI;var c={x:centerX+radius*dip*Math.cos(htheta+angle),y:centerY+radius*dip*Math.sin(htheta+angle)};var p={x:centerX+radius*Math.cos(theta+angle),y:centerY+radius*Math.sin(theta+angle)};context.quadraticCurveTo(c.x,c.y,p.x,p.y);}}// MODIFIED: Commented out. Original.
// ===========================================
/*
	        else if (sides > 0) 
	        { // Polygon
	            for (let i = 0; i < sides; i++) {
	                let theta = (i / sides) * 2 * Math.PI;
	                let x = centerX + radius * Math.cos(theta + angle);
	                let y = centerY + radius * Math.sin(theta + angle);
	                context.lineTo(x, y);
	            }
	        }*/// ===========================================
// From Fillygroove (Kitty).        
else if(sides>0&&sides<102){// Polygon
for(var _i4=0;_i4<sides;_i4++){var _theta=_i4/sides*2*Math.PI;var x=centerX+radius*Math.cos(_theta+angle);var y=centerY+radius*Math.sin(_theta+angle);context.lineTo(x,y);}}// else if (sides >= 102 && sides < 9999)
// {                    
//     if (sides === 200){
//         context.save();
//         let rectX = centerX - (drawWidth);
//         let rectY = centerY - (drawHeight);
//         context.rect(rectX, rectY, drawWidth * 2, drawHeight * 2);            
//         context.restore();                        
//     }
// }              
// ===========================================
context.closePath();context.stroke();if(fill){context.fill();}context.lineJoin='round';}function drawTrapezoid(context,x,y,length,height,aspect,angle){var h=[];h=aspect>0?[height*aspect,height]:[height,-height*aspect];var r=[Math.atan2(h[0],length),Math.atan2(h[1],length)];var l=[Math.sqrt(length*length+h[0]*h[0]),Math.sqrt(length*length+h[1]*h[1])];context.beginPath();context.lineTo(x+l[0]*Math.cos(angle+r[0]),y+l[0]*Math.sin(angle+r[0]));context.lineTo(x+l[1]*Math.cos(angle+Math.PI-r[1]),y+l[1]*Math.sin(angle+Math.PI-r[1]));context.lineTo(x+l[1]*Math.cos(angle+Math.PI+r[1]),y+l[1]*Math.sin(angle+Math.PI+r[1]));context.lineTo(x+l[0]*Math.cos(angle-r[0]),y+l[0]*Math.sin(angle-r[0]));context.closePath();context.stroke();context.fill();}// The big drawing function
return function(x,y,instance,ratio){var scale=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var rot=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var turretsObeyRot=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var assignedContext=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;var turretInfo=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;var render=arguments.length>9&&arguments[9]!==undefined?arguments[9]:instance.render;var context=assignedContext?assignedContext:ctx;var fade=turretInfo?1:render.status.getFade(),drawSize=scale*ratio*instance.size,m=mockups[instance.index],xx=x,yy=y,source=turretInfo===false?instance:turretInfo;// MODIFIED: Invisibility. Cloaking.
// =======================================
if(instance.opacity<1){fade=instance.opacity;}// =======================================
if(render.expandsWithDeath)drawSize*=1+0.5*(1-fade);// MODIFIED: Invisibility. Cloaking.
// =======================================
//if (config.graphical.fancyAnimations && assignedContext != ctx2 && fade !== 1) 
if(assignedContext!=ctx2&&fade!==1)// =======================================
{context=ctx2;context.canvas.width=context.canvas.height=drawSize*m.position.axis+ratio*20;xx=context.canvas.width/2-drawSize*m.position.axis*m.position.middle.x*Math.cos(rot)/4;yy=context.canvas.height/2-drawSize*m.position.axis*m.position.middle.x*Math.sin(rot)/4;}context.lineCap='round';context.lineJoin='round';// Draw turrets beneath us
if(source.turrets.length===m.turrets.length){for(var i=0;i<m.turrets.length;i++){var t=m.turrets[i];if(t.layer===0){// Custom turret colors.
if(t.turretColor){setColor(context,mixColors(t.turretColor,render.status.getColor(),render.status.getBlend()));}var ang=t.direction+t.angle+rot,len=t.offset*drawSize;drawEntity(xx+len*Math.cos(ang),yy+len*Math.sin(ang),t,ratio,drawSize/ratio/t.size*t.sizeFactor,source.turrets[i].facing+turretsObeyRot*rot,turretsObeyRot,context,source.turrets[i],render);}// Experiment: Turret type.
// else {
//     if (Math.random() > 0.94){
//         console.log('t.layer=' + t.layer);
//     }
// }
}}else{throw new Error("Mismatch turret number with mockup.");}{// Draw guns  
source.guns.update();context.lineWidth=Math.max(config.graphical.mininumBorderChunk,ratio*config.graphical.borderChunk);// setColor(context, mixColors(color.grey, render.status.getColor(), render.status.getBlend()));
if(source.guns.length===m.guns.length){var positions=source.guns.getPositions();// =============================================
// MODIFIED: Draw custom gun barrels.
// =============================================
// for (let i = 0; i < m.guns.length; i++) 
// {
//     let g = m.guns[i],
//         position = positions[i] / ((g.aspect === 1) ? 2 : 1),
//         gx =
//         g.offset * Math.cos(g.direction + g.angle + rot) +
//         (g.length / 2 - position) * Math.cos(g.angle + rot),
//         gy =
//         g.offset * Math.sin(g.direction + g.angle + rot) +
//         (g.length / 2 - position) * Math.sin(g.angle + rot);                        
//     // =====================================    
//     // MODIFIED: Gun types.
//     // =====================================
//     // Ghost Rider Flame.
//     if (g.gunType === 11)
//     {
//         // Firing bullets, etc.
//         if (instance.firing)
//         {
//             // Ghost rider gun barrels.
//             if (!g.ghostRiderBarrelSprite)
//             {
//                 let animationInfo = thrusterSpriteInfos[3];
//                 let destWidth = animationInfo.width * 0.6;
//                 let destHeight = animationInfo.height * 0.6;
//                 g.ghostRiderBarrelSprite = new Sprite(animationInfo.url, 
//                                             [0, 0], // Position
//                                             [animationInfo.width, animationInfo.height], // Source size 
//                                             [destWidth, destHeight], // Destination size
//                                             16, // Animation speed
//                                             animationInfo.frames, // Frames
//                                             null, // Direction (default is horizontal)
//                                             false); // Play once   
//             }
//             if (!g.ghostRiderBarrelTurboSprite)
//             {
//                 let animationInfo = thrusterSpriteInfos[4];
//                 let destWidth = animationInfo.width * 0.8;
//                 let destHeight = animationInfo.height * 0.8;
//                 g.ghostRiderBarrelTurboSprite = new Sprite(animationInfo.url, 
//                                             [0, 0], // Position
//                                             [animationInfo.width, animationInfo.height], // Source size 
//                                             [destWidth, destHeight], // Destination size
//                                             18, // Animation speed
//                                             animationInfo.frames, // Frames
//                                             null, // Direction (default is horizontal)
//                                             false); // Play once   
//             }
//             let now = getNow(); // global.time;
//             let dt = g.lastGhostRiderBarrelTime ? (now - g.lastGhostRiderBarrelTime) / 1000.0 : 0;                
//             // Add necessary degrees to align with the rotation of the gun barrel.
//             let barrelRotation = rot + 90 * (Math.PI / 180);            
//             if (instance.usingPower){
//                 let destWidth = scale * ratio * thrusterSpriteInfos[4].width * 0.8;
//                 let destHeight = scale * ratio * thrusterSpriteInfos[4].height * 0.8;
//                 let destYOffset = scale * ratio * -110;
//                 // dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//                 g.ghostRiderBarrelTurboSprite.update2(dt, 
//                                                                     xx + drawSize * gx,
//                                                                     yy + drawSize * gy, 
//                                                                     0, destYOffset, 
//                                                                     destWidth, destHeight,
//                                                                     g.angle + barrelRotation, 1);
//                 g.ghostRiderBarrelTurboSprite.render(context);
//             } 
//             else {
//                 let destWidth = scale * ratio * thrusterSpriteInfos[3].width * 0.6;
//                 let destHeight = scale * ratio * thrusterSpriteInfos[3].height * 0.6;
//                 let destYOffset = scale * ratio * -90;
//                 // dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//                 g.ghostRiderBarrelSprite.update2(dt, 
//                                                                     xx + drawSize * gx,
//                                                                     yy + drawSize * gy, 
//                                                                     0, destYOffset, 
//                                                                     destWidth, destHeight,
//                                                                     g.angle + barrelRotation, 1);
//                 g.ghostRiderBarrelSprite.render(context);
//             }                            
//             g.lastGhostRiderBarrelTime = now;
//         }                        
//     }
//     // =====================================================
//     // Lightsaber Laser Beam (blue,red, green, or yellow)
//     // =====================================================
//     // else if (g.gunType === 12 || g.gunType === 13 || g.gunType === 300 || g.gunType === 301)
//     // {
//     //     // Firing bullets, etc.
//     //     if (instance.firing)
//     //     {       
//     //         let animationInfo = g.gunType === 12 ? laserBeamBlueSpriteInfo :
//     //                             g.gunType === 13 ? laserBeamRedSpriteInfo :
//     //                             g.gunType === 300 ? laserBeamGreenSpriteInfo :
//     //                             laserBeamYellowSpriteInfo;                                                                                             
//     //         let destWidth = scale * ratio * animationInfo.width;
//     //         let destHeight = scale * ratio * animationInfo.height;
//     //         let spriteId = 'gunBarrelSprite' + g.gunType;
//     //         if (!g[spriteId])
//     //         {
//     //             g[spriteId] = new Sprite(animationInfo.url, 
//     //                                     [0, 0], // Position
//     //                                     [animationInfo.width, animationInfo.height], // Source size 
//     //                                     [destWidth, destHeight], // Destination size
//     //                                     16, // Animation speed
//     //                                     animationInfo.frames, // Frames
//     //                                     null, // Direction (default is horizontal)
//     //                                     false); // Play once   
//     //         }
//     //         var now = getNow(); //global.time;
//     //         var dt = g.lastGunBarrelTime ? (now - g.lastGunBarrelTime) / 1000.0 : 0;                
//     //         // Add necessary degrees to align with the rotation of the gun barrel.
//     //         // Tilt some degrees to align laser beam with bullets.
//     //         let barrelRotation = rot + 90 * (Math.PI / 180);
//     //         // For 11 bullets.
//     //         let destYOffset = -48 * scale * ratio;                            
//     //         g[spriteId].update2(dt, 
//     //             xx + drawSize * gx,
//     //             yy + drawSize * gy, 
//     //             0, destYOffset, 
//     //             destWidth, destHeight,
//     //             g.angle + barrelRotation, 1);
//     //         g[spriteId].render(context);
//     //         g.lastGunBarrelTime = now;
//     //     }                        
//     // }  
//     // =====================================================
//     // Flamethrower flame.
//     // =====================================================
//     else if (g.gunType === 309){
//         // Firing bullets, etc.
//         if (instance.firing){       
//             let animationInfo = flamethrowerFlameSpriteInfo;
//             let destWidth = scale * ratio * animationInfo.width;
//             let destHeight = scale * ratio * animationInfo.height;
//             let spriteId = 'gunBarrelSprite' + g.gunType;
//             if (!g[spriteId])
//             {
//                 g[spriteId] = new Sprite(animationInfo.url, 
//                                         [0, 0], // Position
//                                         [animationInfo.width, animationInfo.height], // Source size 
//                                         [destWidth, destHeight], // Destination size
//                                         12, // Animation speed
//                                         animationInfo.frames, // Frames
//                                         null, // Direction (default is horizontal)
//                                         false); // Play once   
//             }
//             let gunBarrelAnimTime = 'gunBarrelAnimTime' + g.gunType;
//             var now = getNow();
//             var dt = g[gunBarrelAnimTime] ? (now - g[gunBarrelAnimTime]) / 1000.0 : 0;                
//             // Add necessary degrees to align with the rotation of the gun barrel.
//             // Tilt some degrees to align laser beam with bullets.
//             let barrelRotation = rot + 90 * (Math.PI / 180);
//             // For 11 bullets.
//             let destXOffset = -1 * scale * ratio;
//             let destYOffset = -162 * scale * ratio;
//             g[spriteId].update2(dt, 
//                 xx + drawSize * gx,
//                 yy + drawSize * gy, 
//                 destXOffset, destYOffset, 
//                 destWidth, destHeight,
//                 g.angle + barrelRotation, 1);
//             g[spriteId].render(context);
//             g[gunBarrelAnimTime] = now;
//         }                        
//     }  
//      // =========================
//     //  Thruster Gun Barrel.
//     // =========================
//     else if (g.gunType === 15)
//     {                        
//         if (instance.usingPower)
//         {
//             let animationInfo = railGunThrusterSpriteInfo;
//             let destWidth = scale * ratio * drawSize; // animationInfo.width * g.width * drawSize;
//             let destHeight = scale * ratio * drawSize; //animationInfo.height * g.width * drawSize;
//             if (!g.gunBarrelSprite)
//             {
//                 g.gunBarrelSprite = new Sprite(animationInfo.url, 
//                                             [0, 0], // Position
//                                             [animationInfo.width, animationInfo.height], // Source size 
//                                             [destWidth, destHeight], // Destination size
//                                             16, // Animation speed
//                                             animationInfo.frames, // Frames
//                                             null, // Direction (default is horizontal)
//                                             false); // Play once   
//             }
//             let now = getNow();
//             let dt = g.lastGunBarrelTime ? (now - g.lastGunBarrelTime) / 1000.0 : 0;                
//             // Add necessary degrees to align with the rotation of the gun barrel.
//             let barrelRotation = rot - 90 * (Math.PI / 180);
//             let destYOffset = 7 * scale * ratio;
//           // dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight,  rotation, alpha
//           g.gunBarrelSprite.update2(dt, 
//                                                 xx + drawSize * gx,
//                                                 yy + drawSize * gy, 
//                                                 0, destYOffset, 
//                                                 destWidth, destHeight,
//                                                 g.angle + barrelRotation, 1);
//             g.gunBarrelSprite.render(context);                 
//             g.lastGunBarrelTime = now;
//         }                        
//     }
// } 
// =============================================
// MODIFIED: Draw normal barrels.
// =============================================
for(var _i5=0;_i5<m.guns.length;_i5++){var g=m.guns[_i5],position=positions[_i5]/(g.aspect===1?2:1),gx=g.offset*Math.cos(g.direction+g.angle+rot)+(g.length/2-position)*Math.cos(g.angle+rot),gy=g.offset*Math.sin(g.direction+g.angle+rot)+(g.length/2-position)*Math.sin(g.angle+rot);// =====================================    
// MODIFIED: Gun types.
// =====================================
if(g.gunType===0){// console.log('g.gunColor=' + g.gunColor);
// Custom gun colors.
setColor(context,mixColors(g.gunColor,render.status.getColor(),render.status.getBlend()));drawTrapezoid(context,xx+drawSize*gx,yy+drawSize*gy,drawSize*(g.length/2-(g.aspect===1?position*2:0)),drawSize*g.width/2,g.aspect,g.angle+rot);}}// =============================================
}else{throw new Error("Mismatch gun number with mockup.");}}// ========================================
// Draw body
context.globalAlpha=1;// MODIFIED: Tank color.        
// Boss Mode.
// if (instance.subType === 9999){
//     let tankColor = mixColors(getColor(mockups[instance.index].color), 
//                         render.status.getColor(), render.status.getBlend());
//     setColor(context, tankColor);    
// } else {
//     setColor(context, mixColors(getColor(instance.color), render.status.getColor(), render.status.getBlend()));
// }        
//setColor(context, mixColors(getColor(instance.color), render.status.getColor(), render.status.getBlend()));
var tankColor=mixColors(getColor(mockups[instance.index].color),render.status.getColor(),render.status.getBlend());setColor(context,tankColor);// ====================================================
// MODIFIED: Commented out.
// drawPoly(context, xx, yy, drawSize / m.size * m.realSize, m.shape, rot);
// =======================================================================
// layer 5 => tank
// layer 10 => food
if(instance.layer===5){// Normal tank.
//if (instance.tankType <= 0 || instance.tankType === 28)
if(instance.tankType<=0||instance.useImage===0){var mySize=drawSize/m.size*m.realSize;drawPoly(context,xx,yy,mySize,m.shape,rot);}if(instance.tankType===1024&&instance.usingPower===1){displayShakingEarth(instance,scale,ratio,x,y,ctx);}// ==============================
// Cyclone tank.
// ==============================
else if(instance.tankType===5){var animationInfo=cycloneSpriteInfo;var destWidth=scale*ratio*animationInfo.width;var destHeight=scale*ratio*animationInfo.height;if(!instance.cycloneSprite){instance.cycloneSprite=new Sprite(animationInfo.url,[0,0],// Position
[animationInfo.width,animationInfo.height],// Source size 
[destWidth,destHeight],// Destination size
1,// Animation speed
animationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.cycloneSprite.update2(0,x,y,0,0,destWidth,destHeight,rot,instance.render.status.getFade());instance.cycloneSprite.render(ctx);}// ==============================
// Shockwave tank.
// ==============================
else if(instance.tankType===6){if(instance.usingPower===1){displayShockwaving(instance,scale,ratio,x,y,ctx);}var _animationInfo11=shockwaveTankSpriteInfo;var _destWidth25=scale*ratio*_animationInfo11.width*0.75;var _destHeight25=scale*ratio*_animationInfo11.height*0.75;if(!instance.shockwaveTankSprite){instance.shockwaveTankSprite=new Sprite(_animationInfo11.url,[0,0],// Position
[_animationInfo11.width,_animationInfo11.height],// Source size 
[_destWidth25,_destHeight25],// Destination size
8,// Animation speed
_animationInfo11.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _now=Date.now();var _dt=instance.lastShockwaveTankTime?(_now-instance.lastShockwaveTankTime)/1000.0:0;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.shockwaveTankSprite.update2(_dt,x,y,0,0,_destWidth25,_destHeight25,rot,instance.render.status.getFade());instance.shockwaveTankSprite.render(ctx);instance.lastShockwaveTankTime=_now;}// ==============================
// Force Field tank. Forcefield.
// ==============================
else if(instance.tankType===8||instance.tankType===31){var _animationInfo12=forceFieldTankSpriteInfo;var _destWidth26=scale*ratio*_animationInfo12.width*0.7;var _destHeight26=scale*ratio*_animationInfo12.height*0.7;if(instance.tankType===31){_destWidth26=scale*ratio*_animationInfo12.width*0.5;_destHeight26=scale*ratio*_animationInfo12.height*0.5;}if(!instance.forceFieldTankSprite){instance.forceFieldTankSprite=new Sprite(_animationInfo12.url,[0,0],// Position
[_animationInfo12.width,_animationInfo12.height],// Source size 
[_destWidth26,_destHeight26],// Destination size
1,// Animation speed
_animationInfo12.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _now2=getNow();//let dt = instance.lastForceFieldTankTime ? (now - instance.lastForceFieldTankTime) / 1000.0 : 0;                
var alpha=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//instance.forceFieldTankSprite.update(dt, x, y, 0, 0, rot, alpha);
instance.forceFieldTankSprite.update2(0,x,y,0,0,_destWidth26,_destHeight26,rot,alpha);instance.forceFieldTankSprite.render(ctx);instance.lastForceFieldTankTime=_now2;if(instance.usingPower===1){displayForceFielding(instance,scale,ratio,x,y,ctx);}// =====================================================                     
// Display range.
// =====================================================                     
var powerRangeBorderThickness=scale*ratio*30;var powerRange=instance.tankType===8?200:125;var scaledPowerRange=powerRange*scale*ratio;context.save();context.globalAlpha=0.3;context.beginPath();context.arc(x,y,scaledPowerRange,0,2*Math.PI,false);context.lineWidth=powerRangeBorderThickness;context.strokeStyle=color.red;context.stroke();context.restore();// =====================================================                     
}// ==============================
// Asteroid.
// ==============================
else if(instance.tankType===9){var _animationInfo13=asteroidTankSpriteInfo;var _destWidth27=scale*ratio*_animationInfo13.width*0.7;var _destHeight27=scale*ratio*_animationInfo13.height*0.7;if(!instance.asteroidTankSprite){instance.asteroidTankSprite=new Sprite(_animationInfo13.url,[0,0],// Position
[_animationInfo13.width,_animationInfo13.height],// Source size 
[_destWidth27,_destHeight27],// Destination size
1,// Animation speed
_animationInfo13.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.asteroidTankSprite.update2(0,x,y,0,0,_destWidth27,_destHeight27,rot,_alpha);instance.asteroidTankSprite.render(ctx);}// ==============================
// Andromeda.
// ==============================
else if(instance.tankType===34){var _animationInfo14=andromedaSpriteInfo;var _destWidth28=scale*ratio*_animationInfo14.width;var _destHeight28=scale*ratio*_animationInfo14.height;if(!instance.andromedaSprite){instance.andromedaSprite=new Sprite(_animationInfo14.url,[0,0],// Position
[_animationInfo14.width,_animationInfo14.height],// Source size 
[_destWidth28,_destHeight28],// Destination size
1,// Animation speed
_animationInfo14.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha2=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight,  rotation, alpha
instance.andromedaSprite.update2(0,x,y,0,0,_destWidth28,_destHeight28,rot,_alpha2);instance.andromedaSprite.render(ctx);}// ===========================================
// Lightsaber (blue, red, green, or yellow).
// ===========================================
else if(instance.tankType===35||instance.tankType===43||instance.tankType===47||instance.tankType===48){var _animationInfo15=instance.tankType===35?lightsaberBlueTankSpriteInfo:instance.tankType===43?lightsaberRedTankSpriteInfo:instance.tankType===47?lightsaberGreenTankSpriteInfo:lightsaberYellowTankSpriteInfo;var _destWidth29=scale*ratio*_animationInfo15.width*0.8;var _destHeight29=scale*ratio*_animationInfo15.height*0.8;var spriteId='lightsaberSprite'+instance.tankType;if(!instance[spriteId]){instance[spriteId]=new Sprite(_animationInfo15.url,[0,0],// Position
[_animationInfo15.width,_animationInfo15.height],// Source size 
[_destWidth29,_destHeight29],// Destination size
1,// Animation speed
_animationInfo15.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha3=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight,  rotation, alpha
instance[spriteId].update2(0,x,y,0,0,_destWidth29,_destHeight29,rot,_alpha3);instance[spriteId].render(ctx);}// ==============================
// Tower Drone Spawner.
// ==============================
else if(instance.tankType===33){var _animationInfo16=towerDroneSpawnerSpriteInfo;var _destWidth30=scale*ratio*_animationInfo16.width*0.8;var _destHeight30=scale*ratio*_animationInfo16.height*0.8;if(!instance.towerDroneSpawnerSprite){instance.towerDroneSpawnerSprite=new Sprite(_animationInfo16.url,[0,0],// Position
[_animationInfo16.width,_animationInfo16.height],// Source size 
[_destWidth30,_destHeight30],// Destination size
1,// Animation speed
_animationInfo16.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha4=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight,  rotation, alpha
instance.towerDroneSpawnerSprite.update2(0,x,y,0,0,_destWidth30,_destHeight30,rot,_alpha4);instance.towerDroneSpawnerSprite.render(ctx);}// ==============================
// Alien Ship.
// ==============================
else if(instance.tankType===10){var _animationInfo17=alienShipSpriteInfo;var _destWidth31=scale*ratio*_animationInfo17.width*0.75;var _destHeight31=scale*ratio*_animationInfo17.height*0.75;if(!instance.alienShipSprite){instance.alienShipSprite=new Sprite(_animationInfo17.url,[0,0],// Position
[_animationInfo17.width,_animationInfo17.height],// Source size 
[_destWidth31,_destHeight31],// Destination size
1,// Animation speed
_animationInfo17.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//instance.alienShipSprite.update(0, x, y, 0, 0, rot, instance.render.status.getFade());
instance.alienShipSprite.update2(0,x,y,0,0,_destWidth31,_destHeight31,rot,instance.render.status.getFade());instance.alienShipSprite.render(ctx);}// ==============================
// Mega Saw.
// ==============================
else if(instance.tankType===11){var _animationInfo18=megaSawSpriteInfo;var _destWidth32=scale*ratio*_animationInfo18.width*0.7;var _destHeight32=scale*ratio*_animationInfo18.height*0.7;if(!instance.sawSprite){instance.sawSprite=new Sprite(_animationInfo18.url,[0,0],// Position
[_animationInfo18.width,_animationInfo18.height],// Source size 
[_destWidth32,_destHeight32],// Destination size
1,// Animation speed
_animationInfo18.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//instance.sawSprite.update(0, x, y, 0, 0, rot, instance.render.status.getFade());
instance.sawSprite.update2(0,x,y,0,0,_destWidth32,_destHeight32,rot,instance.render.status.getFade());instance.sawSprite.render(ctx);}// ==============================
// Spike Sphere.
// ==============================
else if(instance.tankType===36){var _animationInfo19=spikeSphereSpriteInfo;var _destWidth33=scale*ratio*_animationInfo19.width*0.85;var _destHeight33=scale*ratio*_animationInfo19.height*0.85;if(!instance.spikeSphereSprite){instance.spikeSphereSprite=new Sprite(_animationInfo19.url,[0,0],// Position
[_animationInfo19.width,_animationInfo19.height],// Source size 
[_destWidth33,_destHeight33],// Destination size
16,// Animation speed
_animationInfo19.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _now3=getNow();var _dt2=instance.lastAnimationTime?(_now3-instance.lastAnimationTime)/1000.0:0;var rotationAdj=rot+90*(Math.PI/180);// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//instance.sawSprite.update(0, x, y, 0, 0, rot, instance.render.status.getFade());
instance.spikeSphereSprite.update2(_dt2,x,y,0,0,_destWidth33,_destHeight33,rotationAdj,instance.render.status.getFade());instance.spikeSphereSprite.render(ctx);instance.lastAnimationTime=_now3;}// ==============================
// Quinjet.
// ==============================
else if(instance.tankType===37){var _animationInfo20=quinjetSpriteInfo;var _destWidth34=scale*ratio*_animationInfo20.width*0.85;var _destHeight34=scale*ratio*_animationInfo20.height*0.85;if(!instance.quinJetSprite){instance.quinJetSprite=new Sprite(_animationInfo20.url,[0,0],// Position
[_animationInfo20.width,_animationInfo20.height],// Source size 
[_destWidth34,_destHeight34],// Destination size
1,// Animation speed
_animationInfo20.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _rotationAdj=rot+90*(Math.PI/180);// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                
instance.quinJetSprite.update2(0,x,y,0,0,_destWidth34,_destHeight34,_rotationAdj,instance.render.status.getFade());instance.quinJetSprite.render(ctx);}// ==============================
// Invader.
// ==============================
else if(instance.tankType===49){var _animationInfo21=invaderSpriteInfo;var _destWidth35=scale*ratio*_animationInfo21.width*0.9;var _destHeight35=scale*ratio*_animationInfo21.height*0.9;if(!instance.invaderSprite){instance.invaderSprite=new Sprite(_animationInfo21.url,[0,0],// Position
[_animationInfo21.width,_animationInfo21.height],// Source size
[_destWidth35,_destHeight35],// Destination size
1,// Animation speed
_animationInfo21.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.invaderSprite.update2(0,x,y,0,0,_destWidth35,_destHeight35,rot,instance.render.status.getFade());instance.invaderSprite.render(ctx);}// =======================================
// Jupiter. 
// 38 => Normal Jupiter.
// 39 => Buffed Jupiter.
// =======================================
else if(instance.tankType===38||instance.tankType===39){// Transformation from normal to buffed Jupiter.
if(instance.tankType===38){displayClassChangeTransformation(instance,scale,ratio,x,y,ctx,rot,transformToBuffedJupiterSpriteInfo,jupiterSpriteInfo);}// Transformation from buffed to normal Jupiter.
else if(instance.tankType===39){displayClassChangeTransformation(instance,scale,ratio,x,y,ctx,rot,transformToJupiterSpriteInfo,buffedJupiterSpriteInfo);}}// =======================================
// Force FieldX.
// 40 => Normal Force FieldX.
// 41 => Buffed Force FieldX.
// =======================================
else if(instance.tankType===40||instance.tankType===41){// Transformation from normal to buffed Force FieldX.
if(instance.tankType===40){displayClassChangeTransformation(instance,scale,ratio,x,y,ctx,rot,transformToBuffedForceFieldXSpriteInfo,forceFieldXSpriteInfo);}// Transformation from buffed to normal Force FieldX.
else if(instance.tankType===41){displayClassChangeTransformation(instance,scale,ratio,x,y,ctx,rot,transformToForceFieldXSpriteInfo,buffedForceFieldXSpriteInfo);}if(instance.usingPower===1){displayForceFielding(instance,scale,ratio,x,y,ctx);}// =====================================================                     
// Display range.
// =====================================================                     
var _powerRangeBorderThickness=scale*ratio*30;var _powerRange=200;var _scaledPowerRange=scale*ratio*_powerRange;context.save();context.globalAlpha=0.3;context.beginPath();context.arc(x,y,_scaledPowerRange,0,2*Math.PI,false);context.lineWidth=_powerRangeBorderThickness;context.strokeStyle=color.red;context.stroke();context.restore();// ===================================================== 
}// =======================================
// Phaser.
// =======================================
else if(instance.tankType===42){var _animationInfo22=phaserSpriteInfo;var _destWidth36=scale*ratio*_animationInfo22.width;var _destHeight36=scale*ratio*_animationInfo22.height;if(!instance.phaserSprite){instance.phaserSprite=new Sprite(_animationInfo22.url,[0,0],// Position
[_animationInfo22.width,_animationInfo22.height],// Source size 
[_destWidth36,_destHeight36],// Destination size
1,// Animation speed
_animationInfo22.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _fade=instance.render.status.getFade();var _alpha5=_fade<=instance.opacity?_fade:instance.opacity;var _rotationAdj2=rot-90*(Math.PI/180);// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                                
instance.phaserSprite.update2(0,x,y,0,0,_destWidth36,_destHeight36,_rotationAdj2,_alpha5);instance.phaserSprite.render(ctx);}// ==============================
// Laser Ship.
// ==============================
else if(instance.tankType===12){var _animationInfo23=laserShipSpriteInfo;var _destWidth37=scale*ratio*_animationInfo23.width*0.7;var _destHeight37=scale*ratio*_animationInfo23.height*0.7;if(!instance.laserShipSprite){instance.laserShipSprite=new Sprite(_animationInfo23.url,[0,0],// Position
[_animationInfo23.width,_animationInfo23.height],// Source size 
[_destWidth37,_destHeight37],// Destination size
1,// Animation speed
_animationInfo23.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var tankRotation=rot+43.5*(Math.PI/180);// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.laserShipSprite.update2(0,x,y,0,0,_destWidth37,_destHeight37,tankRotation,instance.render.status.getFade());instance.laserShipSprite.render(ctx);}// ==============================
// SpaceshipX tank.
// ==============================
else if(instance.tankType===13){var _animationInfo24=spaceshipXTankSpriteInfo;var _destWidth38=scale*ratio*_animationInfo24.width*0.65;var _destHeight38=scale*ratio*_animationInfo24.height*0.65;if(!instance.spaceshipXTankSprite){instance.spaceshipXTankSprite=new Sprite(_animationInfo24.url,[0,0],// Position
[_animationInfo24.width,_animationInfo24.height],// Source size 
[_destWidth38,_destHeight38],// Destination size
18,// Animation speed
_animationInfo24.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _now4=getNow();var _dt3=instance.lastSpaceshipXTankTime?(_now4-instance.lastSpaceshipXTankTime)/1000.0:0;var _tankRotation=rot;var _alpha6=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.spaceshipXTankSprite.update2(_dt3,x,y,0,0,_destWidth38,_destHeight38,_tankRotation,_alpha6);instance.spaceshipXTankSprite.render(ctx);instance.lastSpaceshipXTankTime=_now4;}// ==============================
// Valkyrie.
// ==============================
else if(instance.tankType===30){var _animationInfo25=valkyrieSpriteInfo;var _destWidth39=scale*ratio*_animationInfo25.width;var _destHeight39=scale*ratio*_animationInfo25.height;if(!instance.valkyrieSprite){instance.valkyrieSprite=new Sprite(_animationInfo25.url,[0,0],// Position
[_animationInfo25.width,_animationInfo25.height],// Source size 
[_destWidth39,_destHeight39],// Destination size
1,// Animation speed
_animationInfo25.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _rotationAdj3=rot+90*(Math.PI/180);var _alpha7=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.valkyrieSprite.update2(0,x,y,0,0,_destWidth39,_destHeight39,_rotationAdj3,_alpha7);instance.valkyrieSprite.render(ctx);}// ==============================
// Blackhole Tank.
// ==============================
else if(instance.tankType===16){var _animationInfo26=blackholeTankSpriteInfo;var _destWidth40=scale*ratio*_animationInfo26.width*0.5;var _destHeight40=scale*ratio*_animationInfo26.height*0.5;if(!instance.blackholeTankSprite){instance.blackholeTankSprite=new Sprite(_animationInfo26.url,[0,0],// Position
[_animationInfo26.width,_animationInfo26.height],// Source size 
[_destWidth40,_destHeight40],// Destination size
1,// Animation speed
_animationInfo26.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha8=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//instance.blackholeTankSprite.update(0, x, y, 0, 0, rot, alpha);
instance.blackholeTankSprite.update2(0,x,y,0,0,_destWidth40,_destHeight40,rot,_alpha8);instance.blackholeTankSprite.render(ctx);if(instance.usingPower){displayBlackholing(instance,scale,ratio,x,y,ctx);}}// ==============================
// Whitehole Tank.
// ==============================
else if(instance.tankType===25){var _animationInfo27=whiteholeTankSpriteInfo;var _destWidth41=scale*ratio*_animationInfo27.width*0.5;var _destHeight41=scale*ratio*_animationInfo27.height*0.5;if(!instance.whiteholeTankSprite){instance.whiteholeTankSprite=new Sprite(_animationInfo27.url,[0,0],// Position
[_animationInfo27.width,_animationInfo27.height],// Source size 
[_destWidth41,_destHeight41],// Destination size
1,// Animation speed
_animationInfo27.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha9=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//instance.whiteholeTankSprite.update(0, x, y, 0, 0, rot, alpha);
instance.whiteholeTankSprite.update2(0,x,y,0,0,_destWidth41,_destHeight41,rot,_alpha9);instance.whiteholeTankSprite.render(ctx);if(instance.usingPower){displayWhiteholing(instance,scale,ratio,x,y,ctx);}}// ==============================
// T-14 Armata Tank.
// ==============================
else if(instance.tankType===17){var tankAnimationInfo=armataTankSpriteInfo;var _destWidth42=scale*ratio*tankAnimationInfo.width;var _destHeight42=scale*ratio*tankAnimationInfo.height;if(!instance.armataTankSprite){instance.armataTankSprite=new Sprite(tankAnimationInfo.url,[0,0],// Position
[tankAnimationInfo.width,tankAnimationInfo.height],// Source size 
[_destWidth42,_destHeight42],// Destination size
8,// Animation speed
tankAnimationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}//let turretAnimationInfo = armataTurretSpriteInfo;
var turretDestWidth=scale*ratio*armataTurretSpriteInfo.width;var turretDestHeight=scale*ratio*armataTurretSpriteInfo.height;if(!instance.armataTurretSprite){instance.armataTurretSprite=new Sprite(armataTurretSpriteInfo.url,[0,0],// Position
[armataTurretSpriteInfo.width,armataTurretSpriteInfo.height],// Source size 
[turretDestWidth,turretDestHeight],// Destination size
1,// Animation speed
armataTurretSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _now5=getNow();var _dt4=instance.lastArmataTime?(_now5-instance.lastArmataTime)/1000.0:0;var _alpha10=instance.render.status.getFade();var _rotationAdj4=rot-90*(Math.PI/180);var destXOffset=scale*ratio*tankAnimationInfo.offsetX;var destYOffset=scale*ratio*tankAnimationInfo.offsetY;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.armataTankSprite.update2(_dt4*instance.movingSpeed/2.0,x,y,destXOffset,destYOffset,_destWidth42,_destHeight42,_rotationAdj4,_alpha10);instance.armataTankSprite.render(ctx);var turretDestXOffset=scale*ratio*0;var turretDestYOffset=scale*ratio*23;// * 0.7;
instance.armataTurretSprite.update2(0,x,y,turretDestXOffset,turretDestYOffset,turretDestWidth,turretDestHeight,_rotationAdj4,_alpha10);instance.armataTurretSprite.render(ctx);instance.lastArmataTime=_now5;// Shooting (firing) indicator - muzzle flash.
if(instance.shooting){var muzzleFlashAnimationInfo=tankMuzzleFlashSpriteInfo;var muzzleDestWidth=scale*ratio*muzzleFlashAnimationInfo.width*1.2;var muzzleDestHeight=scale*ratio*muzzleFlashAnimationInfo.height*1.2;if(!instance.tankMuzzleFlashSprite){instance.tankMuzzleFlashSprite=new Sprite(muzzleFlashAnimationInfo.url,[0,0],// Position
[muzzleFlashAnimationInfo.width,muzzleFlashAnimationInfo.height],// Source size 
[muzzleDestWidth,muzzleDestHeight],// Destination size
15,// Animation speed
muzzleFlashAnimationInfo.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}var now2=getNow();var dt2=instance.lastTankMuzzleFlashTime?(now2-instance.lastTankMuzzleFlashTime)/1000.0:0;var muzzleDestXOffset=scale*ratio*65*1.2;var muzzleDestYOffset=0;// For continuous firing or auto fire is turned on.
if(!instance.tankMuzzleFlashSprite.done){instance.tankMuzzleFlashSprite.update2(dt2,x,y,muzzleDestXOffset,muzzleDestYOffset,muzzleDestWidth,muzzleDestHeight,rot,_alpha10);instance.tankMuzzleFlashSprite.render(ctx);instance.lastTankMuzzleFlashTime=now2;}}else{// For firing one shot at a time.
instance.lastTankMuzzleFlashTime=0;instance.tankMuzzleFlashSprite=null;}}// ==============================
// ST-II (ST Two) tank.
// ==============================
else if(instance.tankType===44){var _tankAnimationInfo=stTwoTankSpriteInfo;var _destWidth43=scale*ratio*_tankAnimationInfo.width;var _destHeight43=scale*ratio*_tankAnimationInfo.height;if(!instance.stTwoTankSprite){instance.stTwoTankSprite=new Sprite(_tankAnimationInfo.url,[0,0],// Position
[_tankAnimationInfo.width,_tankAnimationInfo.height],// Source size 
[_destWidth43,_destHeight43],// Destination size
8,// Animation speed
_tankAnimationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}//let turretAnimationInfo = armataTurretSpriteInfo;
var _turretDestWidth=scale*ratio*stTwoTurretSpriteInfo.width;var _turretDestHeight=scale*ratio*stTwoTurretSpriteInfo.height;if(!instance.stTwoTurretSprite){instance.stTwoTurretSprite=new Sprite(stTwoTurretSpriteInfo.url,[0,0],// Position
[stTwoTurretSpriteInfo.width,stTwoTurretSpriteInfo.height],// Source size 
[_turretDestWidth,_turretDestHeight],// Destination size
1,// Animation speed
stTwoTurretSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _now6=getNow();var _dt5=instance.lastSTTwoTime?(_now6-instance.lastSTTwoTime)/1000.0:0;var _alpha11=instance.render.status.getFade();var _rotationAdj5=rot-90*(Math.PI/180);var _destXOffset=scale*ratio*_tankAnimationInfo.offsetX;var _destYOffset=scale*ratio*_tankAnimationInfo.offsetY;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.stTwoTankSprite.update2(_dt5*instance.movingSpeed/2.0,x,y,_destXOffset,_destYOffset,_destWidth43,_destHeight43,_rotationAdj5,_alpha11);instance.stTwoTankSprite.render(ctx);var _turretDestXOffset=scale*ratio*0;var _turretDestYOffset=scale*ratio*37;instance.stTwoTurretSprite.update2(0,x,y,_turretDestXOffset,_turretDestYOffset,_turretDestWidth,_turretDestHeight,_rotationAdj5,_alpha11);instance.stTwoTurretSprite.render(ctx);instance.lastSTTwoTime=_now6;// Shooting (firing) indicator - muzzle flash.
if(instance.shooting){var _muzzleFlashAnimationInfo=tankMuzzleFlashSpriteInfo;var _muzzleDestWidth=scale*ratio*_muzzleFlashAnimationInfo.width*1.5;var _muzzleDestHeight=scale*ratio*_muzzleFlashAnimationInfo.height*1.5;if(!instance.tankMuzzleFlashSpriteLeft){instance.tankMuzzleFlashSpriteLeft=new Sprite(_muzzleFlashAnimationInfo.url,[0,0],// Position
[_muzzleFlashAnimationInfo.width,_muzzleFlashAnimationInfo.height],// Source size 
[_muzzleDestWidth,_muzzleDestHeight],// Destination size
15,// Animation speed
_muzzleFlashAnimationInfo.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}if(!instance.tankMuzzleFlashSpriteRight){instance.tankMuzzleFlashSpriteRight=new Sprite(_muzzleFlashAnimationInfo.url,[0,0],// Position
[_muzzleFlashAnimationInfo.width,_muzzleFlashAnimationInfo.height],// Source size 
[_muzzleDestWidth,_muzzleDestHeight],// Destination size
15,// Animation speed
_muzzleFlashAnimationInfo.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}var _now7=getNow();var _dt6=instance.lastTankMuzzleFlashTime?(_now7-instance.lastTankMuzzleFlashTime)/1000.0:0;// For continuous firing or auto fire is turned on.
if(!instance.tankMuzzleFlashSpriteLeft.done){var _muzzleDestXOffset=scale*ratio*96;var _muzzleDestYOffset=scale*ratio*10;instance.tankMuzzleFlashSpriteLeft.update2(_dt6,x,y,_muzzleDestXOffset,_muzzleDestYOffset,_muzzleDestWidth,_muzzleDestHeight,rot,_alpha11);instance.tankMuzzleFlashSpriteLeft.render(ctx);instance.lastTankMuzzleFlashTime=_now7;}if(!instance.tankMuzzleFlashSpriteRight.done){var _muzzleDestXOffset2=scale*ratio*96;var _muzzleDestYOffset2=scale*ratio*-10;instance.tankMuzzleFlashSpriteRight.update2(_dt6,x,y,_muzzleDestXOffset2,_muzzleDestYOffset2,_muzzleDestWidth,_muzzleDestHeight,rot,_alpha11);instance.tankMuzzleFlashSpriteRight.render(ctx);instance.lastTankMuzzleFlashTime=_now7;}}else{// For firing one shot at a time.
instance.lastTankMuzzleFlashTime=0;instance.tankMuzzleFlashSpriteLeft=null;instance.tankMuzzleFlashSpriteRight=null;}}// ==============================
// Mega Tank.
// ==============================
else if(instance.tankType===60){var _tankAnimationInfo2=megaTankSpriteInfo;var _destWidth44=scale*ratio*_tankAnimationInfo2.width;var _destHeight44=scale*ratio*_tankAnimationInfo2.height;if(!instance.megaTankSprite){instance.megaTankSprite=new Sprite(_tankAnimationInfo2.url,[0,0],// Position
[_tankAnimationInfo2.width,_tankAnimationInfo2.height],// Source size
[_destWidth44,_destHeight44],// Destination size
8,// Animation speed
_tankAnimationInfo2.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var _alpha12=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.megaTankSprite.update2(0,x,y,0,0,_destWidth44,_destHeight44,rot,_alpha12);instance.megaTankSprite.render(ctx);}// ==============================
// T-60 Scout.
// ==============================
else if(instance.tankType===45){var _tankAnimationInfo3=t60scoutTankSpriteInfo;var _destWidth45=scale*ratio*_tankAnimationInfo3.width*0.9;var _destHeight45=scale*ratio*_tankAnimationInfo3.height*0.9;if(!instance.t60ScoutTankSprite){instance.t60ScoutTankSprite=new Sprite(_tankAnimationInfo3.url,[0,0],// Position
[_tankAnimationInfo3.width,_tankAnimationInfo3.height],// Source size 
[_destWidth45,_destHeight45],// Destination size
8,// Animation speed
_tankAnimationInfo3.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _turretDestWidth2=scale*ratio*armataTurretSpriteInfo.width*0.8;var _turretDestHeight2=scale*ratio*armataTurretSpriteInfo.height*0.8;if(!instance.t60ScoutTurretSprite){instance.t60ScoutTurretSprite=new Sprite(armataTurretSpriteInfo.url,[0,0],// Position
[armataTurretSpriteInfo.width,armataTurretSpriteInfo.height],// Source size 
[_turretDestWidth2,_turretDestHeight2],// Destination size
1,// Animation speed
armataTurretSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _now8=getNow();var _dt7=instance.lastT60ScoutTime?(_now8-instance.lastT60ScoutTime)/1000.0:0;var _alpha13=instance.render.status.getFade();var _rotationAdj6=rot-90*(Math.PI/180);var _destXOffset2=scale*ratio*_tankAnimationInfo3.offsetX;var _destYOffset2=scale*ratio*_tankAnimationInfo3.offsetY;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.t60ScoutTankSprite.update2(_dt7*instance.movingSpeed/2.0,x,y,_destXOffset2,_destYOffset2,_destWidth45,_destHeight45,_rotationAdj6,_alpha13);instance.t60ScoutTankSprite.render(ctx);var _turretDestXOffset2=scale*ratio*0;var _turretDestYOffset2=scale*ratio*27*0.8;instance.t60ScoutTurretSprite.update2(0,x,y,_turretDestXOffset2,_turretDestYOffset2,_turretDestWidth2,_turretDestHeight2,_rotationAdj6,_alpha13);instance.t60ScoutTurretSprite.render(ctx);instance.lastT60ScoutTime=_now8;// Shooting (firing) indicator - muzzle flash.
if(instance.shooting){var _muzzleFlashAnimationInfo2=tankMuzzleFlashSpriteInfo;var _muzzleDestWidth2=scale*ratio*_muzzleFlashAnimationInfo2.width;var _muzzleDestHeight2=scale*ratio*_muzzleFlashAnimationInfo2.height;if(!instance.tankMuzzleFlashSprite){instance.tankMuzzleFlashSprite=new Sprite(_muzzleFlashAnimationInfo2.url,[0,0],// Position
[_muzzleFlashAnimationInfo2.width,_muzzleFlashAnimationInfo2.height],// Source size 
[_muzzleDestWidth2,_muzzleDestHeight2],// Destination size
20,// Animation speed
_muzzleFlashAnimationInfo2.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}var _now9=getNow();var _dt8=instance.lastTankMuzzleFlashTime?(_now9-instance.lastTankMuzzleFlashTime)/1000.0:0;var _muzzleDestXOffset3=scale*ratio*80*0.8;var _muzzleDestYOffset3=0;// For continuous firing or auto fire is turned on.
if(!instance.tankMuzzleFlashSprite.done){instance.tankMuzzleFlashSprite.update2(_dt8,x,y,_muzzleDestXOffset3,_muzzleDestYOffset3,_muzzleDestWidth2,_muzzleDestHeight2,rot,_alpha13);instance.tankMuzzleFlashSprite.render(ctx);instance.lastTankMuzzleFlashTime=_now9;}}else{// For firing one shot at a time.
instance.lastTankMuzzleFlashTime=0;instance.tankMuzzleFlashSprite=null;}}// ==============================
// Paris Gun.
// ==============================
else if(instance.tankType===62){// Tank base. 
var _tankAnimationInfo4=parisGunTankSpriteInfo;var _destWidth46=scale*ratio*_tankAnimationInfo4.width*0.9;var _destHeight46=scale*ratio*_tankAnimationInfo4.height*0.9;if(!instance.parisGunTankSprite){instance.parisGunTankSprite=new Sprite(_tankAnimationInfo4.url,[0,0],// Position
[_tankAnimationInfo4.width,_tankAnimationInfo4.height],// Source size 
[_destWidth46,_destHeight46],// Destination size
0,// Animation speed
_tankAnimationInfo4.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}// Big turret.
var _turretDestWidth3=scale*ratio*parisGunBigTurretSpriteInfo.width*0.8;var _turretDestHeight3=scale*ratio*parisGunBigTurretSpriteInfo.height*0.8;if(!instance.parisGunBigTurretSprite){instance.parisGunBigTurretSprite=new Sprite(parisGunBigTurretSpriteInfo.url,[0,0],// Position
[parisGunBigTurretSpriteInfo.width,parisGunBigTurretSpriteInfo.height],// Source size 
[_turretDestWidth3,_turretDestHeight3],// Destination size
1,// Animation speed
parisGunBigTurretSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}// ===============================================
// Small turrets.
var smallTurretDestWidth=scale*ratio*parisGunSmallTurretSpriteInfo.width*1;var smallTurretDestHeight=scale*ratio*parisGunSmallTurretSpriteInfo.height*1;if(!instance.parisGunSmallTurret1Sprite){instance.parisGunSmallTurret1Sprite=new Sprite(parisGunSmallTurretSpriteInfo.url,[0,0],// Position
[parisGunSmallTurretSpriteInfo.width,parisGunSmallTurretSpriteInfo.height],// Source size 
[_turretDestWidth3,_turretDestHeight3],// Destination size
0,// Animation speed
parisGunSmallTurretSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}if(!instance.parisGunSmallTurret2Sprite){instance.parisGunSmallTurret2Sprite=new Sprite(parisGunSmallTurretSpriteInfo.url,[0,0],// Position
[parisGunSmallTurretSpriteInfo.width,parisGunSmallTurretSpriteInfo.height],// Source size 
[_turretDestWidth3,_turretDestHeight3],// Destination size
0,// Animation speed
parisGunSmallTurretSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}// ===============================================
// Wheel belt.
var wheelBeltDestWidth=scale*ratio*parisGunWheelBeltSpriteInfo.width*0.9;var wheelBeltDestHeight=scale*ratio*parisGunWheelBeltSpriteInfo.height*0.9;if(!instance.parisGunWheelBelt1Sprite){instance.parisGunWheelBelt1Sprite=new Sprite(parisGunWheelBeltSpriteInfo.url,[0,0],// Position
[parisGunWheelBeltSpriteInfo.width,parisGunWheelBeltSpriteInfo.height],// Source size 
[_turretDestWidth3,_turretDestHeight3],// Destination size
12,// Animation speed
parisGunWheelBeltSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}if(!instance.parisGunWheelBelt2Sprite){instance.parisGunWheelBelt2Sprite=new Sprite(parisGunWheelBeltSpriteInfo.url,[0,0],// Position
[parisGunWheelBeltSpriteInfo.width,parisGunWheelBeltSpriteInfo.height],// Source size 
[_turretDestWidth3,_turretDestHeight3],// Destination size
12,// Animation speed
parisGunWheelBeltSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _now10=getNow();var _dt9=instance.lastParisGunTankTime?(_now10-instance.lastParisGunTankTime)/1000.0:0;var _alpha14=instance.render.status.getFade();var _rotationAdj7=rot-90*(Math.PI/180);// Render wheel belt 1.
var wheelBelt1DestXOffset=scale*ratio*-76;var wheelBelt1DestYOffset=scale*ratio*0;instance.parisGunWheelBelt1Sprite.update2(_dt9*instance.movingSpeed/2.0,x,y,wheelBelt1DestXOffset,wheelBelt1DestYOffset,wheelBeltDestWidth,wheelBeltDestHeight,_rotationAdj7,_alpha14);instance.parisGunWheelBelt1Sprite.render(ctx);// Render wheel belt 2.
var wheelBelt2DestXOffset=scale*ratio*76;var wheelBelt2DestYOffset=scale*ratio*0;instance.parisGunWheelBelt2Sprite.update2(_dt9*instance.movingSpeed/2.0,x,y,wheelBelt2DestXOffset,wheelBelt2DestYOffset,wheelBeltDestWidth,wheelBeltDestHeight,_rotationAdj7,_alpha14);instance.parisGunWheelBelt2Sprite.render(ctx);// Render tank base.
var _destXOffset3=scale*ratio*_tankAnimationInfo4.offsetX;var _destYOffset3=scale*ratio*_tankAnimationInfo4.offsetY;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.parisGunTankSprite.update2(0,x,y,_destXOffset3,_destYOffset3,_destWidth46,_destHeight46,_rotationAdj7,_alpha14);instance.parisGunTankSprite.render(ctx);// Render big turret.
var _turretDestXOffset3=scale*ratio*0;var _turretDestYOffset3=scale*ratio*37*0.8;instance.parisGunBigTurretSprite.update2(0,x,y,_turretDestXOffset3,_turretDestYOffset3,_turretDestWidth3,_turretDestHeight3,_rotationAdj7,_alpha14);instance.parisGunBigTurretSprite.render(ctx);// ========================================
// Render small turrets.
// ========================================
var smallTurret1DestXOffset=scale*ratio*-38;var smallTurret1DestYOffset=scale*ratio*82;instance.parisGunSmallTurret1Sprite.update2(0,x,y,smallTurret1DestXOffset,smallTurret1DestYOffset,smallTurretDestWidth,smallTurretDestHeight,_rotationAdj7,_alpha14);instance.parisGunSmallTurret1Sprite.render(ctx);var smallTurret2DestXOffset=scale*ratio*38;var smallTurret2DestYOffset=scale*ratio*82;instance.parisGunSmallTurret2Sprite.update2(0,x,y,smallTurret2DestXOffset,smallTurret2DestYOffset,smallTurretDestWidth,smallTurretDestHeight,_rotationAdj7,_alpha14);instance.parisGunSmallTurret2Sprite.render(ctx);// ========================================
instance.lastParisGunTankTime=_now10;}// =======================================
// MODIFIED: Nuker (Airplane).
// =======================================
else if(instance.tankType===18){var _animationInfo28=nukerSpriteInfo;var _destWidth47=scale*ratio*_animationInfo28.width*0.75;var _destHeight47=scale*ratio*_animationInfo28.height*0.75;if(!instance.nukerSprite){instance.nukerSprite=new Sprite(_animationInfo28.url,[0,0],// Position
[_animationInfo28.width,_animationInfo28.height],// Source size 
[_destWidth47,_destHeight47],// Destination size
1,// Animation speed
_animationInfo28.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha15=instance.render.status.getFade();var _rotationAdj8=rot;// + 90 * (Math.PI / 180);            
// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.nukerSprite.update2(0,x,y,0,0,_destWidth47,_destHeight47,_rotationAdj8,_alpha15);instance.nukerSprite.render(ctx);}// =======================================
// Rail Gun.
// =======================================
else if(instance.tankType===26){var _animationInfo29=railGunSpriteInfo;var _destWidth48=scale*ratio*_animationInfo29.width*0.8;var _destHeight48=scale*ratio*_animationInfo29.height*0.8;if(!instance.railGunSprite){instance.railGunSprite=new Sprite(_animationInfo29.url,[0,0],// Position
[_animationInfo29.width,_animationInfo29.height],// Source size 
[_destWidth48,_destHeight48],// Destination size
1,// Animation speed
_animationInfo29.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha16=instance.render.status.getFade();var _rotationAdj9=rot;// + 90 * (Math.PI / 180);            
// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                                
instance.railGunSprite.update2(0,x,y,0,0,_destWidth48,_destHeight48,_rotationAdj9,_alpha16);instance.railGunSprite.render(ctx);}// =================================================
// MODIFIED: Imprisoner. Hellgate. Night Stalker.
// =================================================
else if(instance.tankType===19||instance.tankType===80||instance.tankType===28){// ===========================================================================
var _mySize=drawSize/m.size*m.realSize;// ===========================================================================
// context, centerX, centerY, radius, sides, angle = 0, fill = true        
//drawPoly(context, xx, yy, mySize, m.shape, rot);
drawPoly(context,x,y,_mySize,m.shape,rot);// Draw the imprisoner range if it is my tank.
if(instance.id===_gui.playerid){// =================================================================
// target.x and target.y gets smaller if browser window is smaller, and
// gets larger if browser window is larger for the same mouse position.
// The same goes for "ratio".
// =================================================================
//let tankSize = drawSize / m.size * m.realSize;
var _powerRangeBorderThickness2=scale*ratio*30;var _powerRange2=instance.tankType===28?1070:665;_powerRange2=_powerRange2-_powerRangeBorderThickness2/2;var _scaledPowerRange2=scale*ratio*_powerRange2;context.save();context.globalAlpha=0.3;context.beginPath();//context.arc(xx, yy, scaledPowerRange, 0, 2 * Math.PI, false);
context.arc(x,y,_scaledPowerRange2,0,2*Math.PI,false);context.lineWidth=_powerRangeBorderThickness2;context.strokeStyle=color.red;context.stroke();context.restore();// =============================
// Draw a circle around the mouse pointer.
var mouseCenterX=target.x+global.screenWidth/2;var mouseCenterY=target.y+global.screenHeight/2;// Check if the mouse pointer is withint the "power range".
// let scaledTargetX = (target.x / ratio);
// let scaledTargetY = (target.y / ratio);
var scaledTargetX=target.x/ratio*scale;var scaledTargetY=target.y/ratio*scale;var targetDistance=Math.sqrt(Math.pow(scaledTargetX,2)+Math.pow(scaledTargetY,2));if(targetDistance<=_scaledPowerRange2+_powerRangeBorderThickness2+_mySize+8){context.save();// set transparency value
context.globalAlpha=0.2;context.fillStyle=instance.tankType===19?'#F30':'#C00';// Draw semi transparent circles
for(var _i6=0;_i6<5;_i6++){var initialSize=scale*ratio*50;var incrementalSize=scale*ratio*35*_i6;context.beginPath();context.arc(mouseCenterX,mouseCenterY,initialSize+incrementalSize,0,Math.PI*2,true);context.fill();}context.restore();}// ==============================                    
}}// ==================================================================
// Warg. Shapeshifter (doesn't work). Stealer (doesn't work).
// ==================================================================
else if(instance.tankType===401||instance.tankType===404||instance.tankType===405){// ===========================================================================
var _mySize2=drawSize/m.size*m.realSize;// ===========================================================================
if(instance.usingPower===1){ctx.save();ctx.globalCompositeOperation="xor";drawPoly(context,xx,yy,_mySize2,m.shape,rot);ctx.restore();}else{// context, centerX, centerY, radius, sides, angle = 0, fill = true        
drawPoly(context,xx,yy,_mySize2,m.shape,rot);// Draw the selection sprite if it is my tank.
if(instance.id===_gui.playerid){// =================================================================
// target.x and target.y gets smaller if browser window is smaller, and
// gets larger if browser window is larger for the same mouse position.
// The same goes for "ratio".
// =================================================================
// Draw a circle around the mouse pointer.
var _mouseCenterX=target.x+global.screenWidth/2;var _mouseCenterY=target.y+global.screenHeight/2;var animSprite="animSprite"+instance.tankType;var animTime="animTime"+instance.tankType;var _animationInfo30=mouseRingWargSpriteInfo;var _destWidth49=scale*ratio*_animationInfo30.width;var _destHeight49=scale*ratio*_animationInfo30.height;if(!instance[animSprite]){instance.mouseRingRotation=0;instance[animSprite]=new Sprite(_animationInfo30.url,[0,0],// Position
[_animationInfo30.width,_animationInfo30.height],// Source size 
[_destWidth49,_destHeight49],// Destination size
1,// Animation speed
_animationInfo30.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now11=getNow();var _dt10=instance[animTime]?(_now11-instance[animTime])/1000.0:0;instance.mouseRingRotation+=_dt10*20;var _alpha17=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                    
instance[animSprite].update2(0,_mouseCenterX,_mouseCenterY,0,0,_destWidth49,_destHeight49,0,_alpha17);instance[animSprite].render(ctx);instance[animTime]=_now11;}}}// =======================================
// Telekinetic. Homing Missile.
// =======================================
else if(instance.tankType===46||instance.tankType===61){// ===========================================================================
var _mySize3=drawSize/m.size*m.realSize;// ===========================================================================
// context, centerX, centerY, radius, sides, angle = 0, fill = true        
drawPoly(context,xx,yy,_mySize3,m.shape,rot);// Draw the selection sprite if it is my tank.
if(instance.id===_gui.playerid){// =================================================================
// target.x and target.y gets smaller if browser window is smaller, and
// gets larger if browser window is larger for the same mouse position.
// The same goes for "ratio".
// =================================================================
// Draw a circle around the mouse pointer.
var _mouseCenterX2=target.x+global.screenWidth/2;var _mouseCenterY2=target.y+global.screenHeight/2;var _animationInfo31=mouseRingSpriteInfo;var _destWidth50=scale*ratio*_animationInfo31.width;var _destHeight50=scale*ratio*_animationInfo31.height;if(!instance.mouseRingSprite){instance.mouseRingRotation=0;instance.mouseRingSprite=new Sprite(_animationInfo31.url,[0,0],// Position
[_animationInfo31.width,_animationInfo31.height],// Source size 
[_destWidth50,_destHeight50],// Destination size
1,// Animation speed
_animationInfo31.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now12=getNow();var _dt11=instance.lastTelekineticMouseRingTime?(_now12-instance.lastTelekineticMouseRingTime)/1000.0:0;instance.mouseRingRotation+=_dt11*20;var _alpha18=instance.render.status.getFade();var mouseRingRotation=instance.mouseRingRotation%360*(Math.PI/180);if(instance.usingPower===1){// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                    
instance.mouseRingSprite.update2(0,_mouseCenterX2,_mouseCenterY2,0,0,_destWidth50,_destHeight50,mouseRingRotation,_alpha18);instance.mouseRingSprite.render(ctx);}else{// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                    
instance.mouseRingSprite.update2(0,_mouseCenterX2,_mouseCenterY2,0,0,_destWidth50,_destHeight50,0,_alpha18);instance.mouseRingSprite.render(ctx);}instance.lastTelekineticMouseRingTime=_now12;// ==============================                    
}}// =======================================
// MODIFIED: Shielder.
// =======================================
else if(instance.tankType===32){// ===========================================================================
var _mySize4=drawSize/m.size*m.realSize;// ===========================================================================
// context, centerX, centerY, radius, sides, angle = 0, fill = true        
drawPoly(context,xx,yy,_mySize4,m.shape,rot);if(instance.usingPower===1){var _animationInfo32=shieldSpriteInfo;var _destWidth51=scale*ratio*_animationInfo32.width;var _destHeight51=scale*ratio*_animationInfo32.height;if(!instance.shieldSprite){instance.shieldSpriteRotation=0;instance.shieldSprite=new Sprite(_animationInfo32.url,[0,0],// Position
[_animationInfo32.width,_animationInfo32.height],// Source size 
[_destWidth51,_destHeight51],// Destination size
1,// Animation speed
_animationInfo32.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}//let now = Date.now();                    
//let dt = instance.lastAnimationTime ? (now - instance.lastAnimationTime) / 1000.0 : 0;
instance.shieldSpriteRotation+=3;var _alpha19=instance.render.status.getFade();var _rotationAdj10=instance.shieldSpriteRotation*(Math.PI/180)%(Math.PI*2);// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                    
instance.shieldSprite.update2(0,x,y,0,0,_destWidth51,_destHeight51,_rotationAdj10,_alpha19);instance.shieldSprite.render(ctx);//instance.lastAnimationTime = now;
}}// =======================================
// Deflector.
// =======================================
else if(instance.tankType===403){// ===========================================================================
var _mySize5=drawSize/m.size*m.realSize;// ===========================================================================
// context, centerX, centerY, radius, sides, angle = 0, fill = true
drawPoly(context,xx,yy,_mySize5,m.shape,rot);if(instance.usingPower===1){var _animationInfo33=deflectorSpriteInfo;var _destWidth52=scale*ratio*_animationInfo33.width;var _destHeight52=scale*ratio*_animationInfo33.height;if(!instance.deflectorSprite){instance.deflectorSpriteRotation=0;instance.deflectorSprite=new Sprite(_animationInfo33.url,[0,0],// Position
[_animationInfo33.width,_animationInfo33.height],// Source size
[_destWidth52,_destHeight52],// Destination size
1,// Animation speed
_animationInfo33.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once
}instance.deflectorSpriteRotation+=3;var _alpha20=instance.render.status.getFade();var _rotationAdj11=instance.deflectorSpriteRotation*(Math.PI/180)%(Math.PI*2);// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.deflectorSprite.update2(0,x,y,0,0,_destWidth52,_destHeight52,_rotationAdj11,_alpha20);instance.deflectorSprite.render(ctx);}}// =======================================
// MODIFIED: Bunker.
// =======================================
else if(instance.tankType===20){displayBunkerTransformation(instance,scale,ratio,x,y,ctx,rot,bunkerInitialStageSpriteInfo,bunkerTransformToLastStageSpriteInfo,bunkerTransformToInitialStageSpriteInfo,bunkerLastStageSpriteInfo);}// =======================================
// MODIFIED: Drone Bunker.
// =======================================
else if(instance.tankType===23){displayDroneBunkerTransformation(instance,scale,ratio,x,y,ctx,rot,droneBunkerInitialStageSpriteInfo,droneBunkerTransformToLastStageSpriteInfo,droneBunkerTransformToInitialStageSpriteInfo,droneBunkerLastStageSpriteInfo);}// =======================================
// MODIFIED: Trap Bunker.
// =======================================
else if(instance.tankType===24){displayTrapBunkerTransformation(instance,scale,ratio,x,y,ctx,rot,trapBunkerInitialStageSpriteInfo,trapBunkerTransformToLastStageSpriteInfo,trapBunkerTransformToInitialStageSpriteInfo,trapBunkerLastStageSpriteInfo);}// =======================================
// MODIFIED: Wasp.
// =======================================
else if(instance.tankType===21){if(!instance.waspSprite){var _animationInfo34=waspSpriteInfo;var _destWidth53=scale*ratio*_animationInfo34.width;var _destHeight53=scale*ratio*_animationInfo34.height;instance.waspSprite=new Sprite(_animationInfo34.url,[0,0],// Position
[_animationInfo34.width,_animationInfo34.height],// Source size 
[_destWidth53,_destHeight53],// Destination size
22,// Animation speed
_animationInfo34.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}if(!instance.waspShadowSprite){var _animationInfo35=waspShadowSpriteInfo;var _destWidth54=scale*ratio*_animationInfo35.width;var _destHeight54=scale*ratio*_animationInfo35.height;instance.waspShadowSprite=new Sprite(_animationInfo35.url,[0,0],// Position
[_animationInfo35.width,_animationInfo35.height],// Source size 
[_destWidth54,_destHeight54],// Destination size
24,// Animation speed
_animationInfo35.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now13=getNow();var _dt12=instance.lastWaspTime?(_now13-instance.lastWaspTime)/1000.0:0;var rotation=rot+90*(Math.PI/180);var _alpha21=instance.render.status.getFade();var shadowDestXOffset=scale*ratio*waspShadowSpriteInfo.offsetX;var shadowDestYOffset=scale*ratio*waspShadowSpriteInfo.offsetY;var waspDestWidth=scale*ratio*waspSpriteInfo.width;var waspDestHeight=scale*ratio*waspSpriteInfo.height;var shadowDestWidth=scale*ratio*waspShadowSpriteInfo.width;var shadowDestHeight=scale*ratio*waspShadowSpriteInfo.height;if(instance.movingSpeed>0.1){// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                        
//instance.waspShadowSprite.update(dt * instance.movingSpeed / 2.4, x, y, shadowDestXOffset, shadowDestYOffset, rotation, alpha);
instance.waspShadowSprite.update2(_dt12*instance.movingSpeed/2.4,x,y,shadowDestXOffset,shadowDestYOffset,shadowDestWidth,shadowDestHeight,rotation,_alpha21);instance.waspSprite.update2(_dt12*instance.movingSpeed/2,x,y,0,0,waspDestWidth,waspDestHeight,rotation,_alpha21);}else{// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                        
//instance.waspShadowSprite.update(dt, x, y, shadowDestXOffset, shadowDestYOffset, rotation, alpha);
instance.waspShadowSprite.update2(_dt12,x,y,shadowDestXOffset,shadowDestYOffset,shadowDestWidth,shadowDestHeight,rotation,_alpha21);instance.waspSprite.update2(_dt12,x,y,0,0,waspDestWidth,waspDestHeight,rotation,_alpha21);}instance.waspShadowSprite.render(ctx,true,ctx.width,ctx.height);instance.waspSprite.render(ctx);instance.lastWaspTime=_now13;}// =======================================
// Robomoth.
// =======================================
else if(instance.tankType===29){var _animationInfo36=zergBugSpriteInfo;var _destWidth55=scale*ratio*_animationInfo36.width;var _destHeight55=scale*ratio*_animationInfo36.height;if(!instance.zergBugSprite){instance.zergBugSprite=new Sprite(_animationInfo36.url,[0,0],// Position
[_animationInfo36.width,_animationInfo36.height],// Source size 
[_destWidth55,_destHeight55],// Destination size
18,// Animation speed
_animationInfo36.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now14=getNow();var _dt13=instance.lastZergBugTime?(_now14-instance.lastZergBugTime)/1000.0:0;var _rotation=rot-90*(Math.PI/180);var _alpha22=instance.render.status.getFade();if(instance.movingSpeed>0.1){// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.zergBugSprite.update2(_dt13*instance.movingSpeed/2,x,y,0,0,_destWidth55,_destHeight55,_rotation,_alpha22);}else{// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.zergBugSprite.update2(_dt13,x,y,0,0,_destWidth55,_destHeight55,_rotation,_alpha22);}instance.zergBugSprite.render(ctx);instance.lastZergBugTime=_now14;}// =======================================
// MODIFIED: Warper.
// =======================================
else if(instance.tankType===22){var _animationInfo37=warperSpriteInfo;var _destWidth56=scale*ratio*_animationInfo37.width;var _destHeight56=scale*ratio*_animationInfo37.height;if(!instance.warperSprite){instance.warperSprite=new Sprite(_animationInfo37.url,[0,0],// Position
[_animationInfo37.width,_animationInfo37.height],// Source size 
[_destWidth56,_destHeight56],// Destination size
12,// Animation speed
_animationInfo37.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now15=getNow();var _dt14=instance.lastWarperTime?(_now15-instance.lastWarperTime)/1000.0:0;var _rotation2=rot;// + 90 * (Math.PI / 180);
var _alpha23=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                     
instance.warperSprite.update2(_dt14,x,y,0,0,_destWidth56,_destHeight56,_rotation2,_alpha23);instance.warperSprite.render(ctx);instance.lastWarperTime=_now15;}else{// ===========================================================================                
var _mySize6=drawSize/m.size*m.realSize;// ===========================================================================
drawPoly(context,xx,yy,_mySize6,m.shape,rot);}// =====================================================            
// Death explosion moved here.
// if (instance.render.status.getFade() < 0.8 &&
//     instance.teleporting === 0)
//     //&& instance.usingPower === 0)
// {
//     if (!instance.explosionSprite)
//     {            
//         let animationInfo = tankExplosionInfos[0]; 
//         let destWidth = scale * ratio * animationInfo.width;
// 		let destHeight = scale * ratio * animationInfo.height;
//         instance.explosionSprite = new Sprite(animationInfo.url, 
//                                     [0, 0], // Position
//                                     [animationInfo.width, animationInfo.height], // Source size 
//                                     [destWidth, destHeight], // Destination size
//                                     18, // Animation speed
//                                     animationInfo.frames, // Frames
//                                     null, // Direction (default is horizontal)
//                                     true); // Play once   
//     }
//     let now = Date.now();
//     let dt = instance.lastExplosionTime ? (now - instance.lastExplosionTime) / 1000.0 : 0;
//     // dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//     instance.explosionSprite.update(dt, x, y, 0, 0, 0, 1);
//     instance.explosionSprite.render(ctx);
//     instance.lastExplosionTime = now;
// }
// else {
//     // Don't remove.
//     if (instance.teleporting)
//     {
//         displayTeleportation(instance, scale, ratio, x, y, ctx);
//     }
//     // else if (instance.frozen)
//     // {
//     //     displayFrozen(instance, scale, ratio, x, y, ctx);
//     // }
// }
// ======================================
}else if(instance.layer===3){// ====================================================================
// scale = 1.1, ratio = 0.7654?
// m.size = 1, m.realSize = 1, m.sizeVert = 1, m.realSizeVert = 1
// ====================================================================
//let drawWidth = ratio * instance.size / m.size * m.realSize;
//let drawHeight = ratio * instance.sizeVert / m.sizeVert * m.realSizeVert;
// To understand why a specific value (10 in this case) is used,
// look at the method "this.updateAABB" in server.js where x1,y1,x2,y2
// are calculated (AABB is inflated by 10). Here, only 8 is used.
var drawWidth=ratio*instance.size-8*ratio;var drawHeight=ratio*instance.sizeVert-8*ratio;// if (Math.random() > 0.94){
//     console.log('instance.rotation=' + instance.rotation);
// }
//drawRectangle(context, xx, yy, drawWidth, drawHeight);
if(instance.rotation&&instance.rotation>0){drawRectangleWithRotation(context,xx,yy,drawWidth,drawHeight,instance.rotation);}else{drawRectangle(context,xx,yy,drawWidth,drawHeight);}}// =======================================================================
// Food.
// =======================================================================
else if(instance.layer===10){// Gem.
if(instance.subType===1){if(!instance.gemSprite1){var _animationInfo38=gemSpriteInfos[instance.subType-1];var _destWidth57=scale*ratio*_animationInfo38.width*1.1;var _destHeight57=scale*ratio*_animationInfo38.height*1.1;instance.gemSprite1=new Sprite(_animationInfo38.url,[0,0],// Position
[_animationInfo38.width,_animationInfo38.height],// Source size 
[_destWidth57,_destHeight57],// Destination size
1,// Animation speed
_animationInfo38.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}//let now = getNow();
//let dt = instance.lastGemTime ? (now - instance.lastGemTime) / 1000.0 : 0;                
// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.gemSprite1.update(0,x,y,0,0,rot,instance.render.status.getFade());instance.gemSprite1.render(ctx);//instance.lastGemTime = now;
}else if(instance.subType===2){if(!instance.gemSprite2){var _animationInfo39=gemSpriteInfos[instance.subType-1];var _destWidth58=scale*ratio*_animationInfo39.width*0.9;var _destHeight58=scale*ratio*_animationInfo39.height*0.9;instance.gemSprite2=new Sprite(_animationInfo39.url,[0,0],// Position
[_animationInfo39.width,_animationInfo39.height],// Source size 
[_destWidth58,_destHeight58],// Destination size
1,// Animation speed
_animationInfo39.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}//let now = getNow();
//let dt = instance.lastGemTime ? (now - instance.lastGemTime) / 1000.0 : 0;                
// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.gemSprite2.update(0,x,y,0,0,rot,instance.render.status.getFade());instance.gemSprite2.render(ctx);//instance.lastGemTime = now;
}else if(instance.subType===11){var _animationInfo40=heartSpriteInfo;var _destWidth59=scale*ratio*_animationInfo40.width;var _destHeight59=scale*ratio*_animationInfo40.height;if(!instance.heartSprite){instance.heartSprite=new Sprite(_animationInfo40.url,[0,0],// Position
[_animationInfo40.width,_animationInfo40.height],// Source size 
[_destWidth59,_destHeight59],// Destination size
8,// Animation speed
_animationInfo40.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _now16=getNow();var _dt15=instance.lastHeartAnimTime?(_now16-instance.lastHeartAnimTime)/1000.0:0;var _alpha24=instance.render.status.getFade();instance.heartSprite.update2(_dt15,x,y,0,0,_destWidth59,_destHeight59,rot,_alpha24);instance.heartSprite.render(ctx);instance.lastHeartAnimTime=_now16;}else{// ===========================================================================
var _mySize7=drawSize/m.size*m.realSize;// ===========================================================================
drawPoly(context,xx,yy,_mySize7,m.shape,rot);}// if (
// 	//(instance.render.status.getState() === 'killed') &&
//     // Don't show explosion when user refreshes browser or
//     // when other tanks are going to be offscreen.     
//     (instance.render.status.getFade() < 0.6)
// )                            
// {
//     if (!instance.pentagonExplosionSprite)
//     {
//         let animationInfo = pentagonExplosionInfos[0];
//         let destWidth = scale * ratio * animationInfo.width;
// 		let destHeight = scale * ratio * animationInfo.height;
//         instance.pentagonExplosionSprite = new Sprite(animationInfo.url, 
//                                     [0, 0], // Position
//                                     [animationInfo.width, animationInfo.height], // Source size 
//                                     [destWidth, destHeight], // Destination size
//                                     20, // Animation speed
//                                     animationInfo.frames, // Frames
//                                     null, // Direction (default is horizontal)
//                                     true); // Play once
//         instance.alreadyExploded = false;
//     }
//     if (instance.alreadyExploded === false)
//     {
//     	let now = Date.now();
//         let dt = instance.lastPentagonExplosionTime ? (now - instance.lastPentagonExplosionTime) / 1000.0 : 0;
//         // dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//         instance.pentagonExplosionSprite.update(dt, x, y, 0, 0, 0, 1);
//         instance.pentagonExplosionSprite.render(ctx);
//         instance.lastPentagonExplosionTime = now; 
//         if (instance.pentagonExplosionSprite.done)
//         {
//         	instance.alreadyExploded = true;
//         }
//     }                
// } 
// else 
// {
//     // ===========================================================================
//     const mySize = (drawSize / m.size * m.realSize);
//     // ===========================================================================
//     drawPoly(context, xx, yy, mySize, m.shape, rot);          	
// }                           
}// =======================================
// MODIFIED: Heat seeker missile.
// =======================================
else if(instance.layer===901){if(!instance.heatSeekerMissileSprite){var _animationInfo41=missileSpriteInfos[0];var _destWidth60=scale*ratio*_animationInfo41.width;var _destHeight60=scale*ratio*_animationInfo41.height;instance.heatSeekerMissileSprite=new Sprite(_animationInfo41.url,[0,0],// Position
[_animationInfo41.width,_animationInfo41.height],// Source size 
[_destWidth60,_destHeight60],// Destination size
20,// Animation speed
_animationInfo41.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}if(!instance.heatSeekerMissileThrusterSprite){var _animationInfo42=thrusterSpriteInfos[0];var _destWidth61=scale*ratio*_animationInfo42.width;var _destHeight61=scale*ratio*_animationInfo42.height;instance.heatSeekerMissileThrusterSprite=new Sprite(_animationInfo42.url,[0,0],// Position
[_animationInfo42.width,_animationInfo42.height],// Source size 
[_destWidth61,_destHeight61],// Destination size
12,// Animation speed
_animationInfo42.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var _now17=Date.now();var _dt16=instance.lastHeatSeekerMissileTime?(_now17-instance.lastHeatSeekerMissileTime)/1000.0:0;// Add necessary degrees to align with the rotation of the bullet.
var thrusterRotation=rot+90*(Math.PI/180);//let missileRotation = rot;
var _alpha25=instance.render.status.getFade();var thrusterDestYOffset=scale*ratio*28;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.heatSeekerMissileThrusterSprite.update(_dt16,x,y,-1,thrusterDestYOffset,thrusterRotation,_alpha25);instance.heatSeekerMissileThrusterSprite.render(ctx);instance.heatSeekerMissileSprite.update(_dt16,x,y,0,0,thrusterRotation,_alpha25);instance.heatSeekerMissileSprite.render(ctx);instance.lastHeatSeekerMissileTime=_now17;}// =======================================
// Tower missile.
// =======================================
else if(instance.layer===943){var _animationInfo43=towerMissileSpriteInfo;var _destWidth62=scale*ratio*_animationInfo43.width;var _destHeight62=scale*ratio*_animationInfo43.height;if(!instance.towerMissileSprite){instance.towerMissileSprite=new Sprite(_animationInfo43.url,[0,0],// Position
[_animationInfo43.width,_animationInfo43.height],// Source size 
[_destWidth62,_destHeight62],// Destination size
20,// Animation speed
_animationInfo43.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now18=Date.now();var _dt17=instance.lastAnimationTime?(_now18-instance.lastAnimationTime)/1000.0:0;// Add necessary degrees to align with the rotation of the bullet.
var _rotationAdj12=rot+90*(Math.PI/180);var _alpha26=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight,  rotation, alpha            
instance.towerMissileSprite.update2(_dt17,x,y,0,0,_destWidth62,_destHeight62,_rotationAdj12,_alpha26);instance.towerMissileSprite.render(ctx);instance.lastAnimationTime=_now18;}// ================================================
// Fireball.
// =======================================
else if(instance.layer===902){var _animationInfo44=fireballSpriteInfos[0];var _destWidth63=scale*ratio*_animationInfo44.width;var _destHeight63=scale*ratio*_animationInfo44.height;if(!instance.fireballSprite){instance.fireballSprite=new Sprite(_animationInfo44.url,[0,0],// Position
[_animationInfo44.width,_animationInfo44.height],// Source size 
[_destWidth63,_destHeight63],// Destination size
18,// Animation speed
_animationInfo44.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var _now19=Date.now();var _dt18=instance.lastFireballTime?(_now19-instance.lastFireballTime)/1000.0:0;// Subtract 90 degrees to align with the rotation of the bullet.
var _rotation3=rot-90*(Math.PI/180);var _alpha27=instance.render.status.getFade();var _destXOffset4=scale*ratio*_animationInfo44.offsetX;var _destYOffset4=scale*ratio*_animationInfo44.offsetY;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.fireballSprite.update2(_dt18,x,y,_destXOffset4,_destYOffset4,_destWidth63,_destHeight63,_rotation3,_alpha27);instance.fireballSprite.render(ctx);instance.lastFireballTime=_now19;}// =======================================
// MODIFIED: Howitzer bullet.
// =======================================
else if(instance.layer===903){if(!instance.howitzerBulletSprite){var _animationInfo45=howitzerBulletSpriteInfo;var _destWidth64=scale*ratio*_animationInfo45.width;var _destHeight64=scale*ratio*_animationInfo45.height;instance.howitzerBulletSprite=new Sprite(_animationInfo45.url,[0,0],// Position
[_animationInfo45.width,_animationInfo45.height],// Source size 
[_destWidth64,_destHeight64],// Destination size
24,// Animation speed
_animationInfo45.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}if(!instance.howitzerBulletThrusterSprite){var _animationInfo46=thrusterSpriteInfos[1];var _destWidth65=scale*ratio*_animationInfo46.width;var _destHeight65=scale*ratio*_animationInfo46.height;instance.howitzerBulletThrusterSprite=new Sprite(_animationInfo46.url,[0,0],// Position
[_animationInfo46.width,_animationInfo46.height],// Source size 
[_destWidth65,_destHeight65],// Destination size
20,// Animation speed
_animationInfo46.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var _now20=Date.now();var _dt19=instance.lastHowitzerBulletTime?(_now20-instance.lastHowitzerBulletTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
var _rotation4=rot+90*(Math.PI/180);var _alpha28=instance.render.status.getFade();var _thrusterDestYOffset=scale*ratio*50;var thrusterDestWidth=scale*ratio*thrusterSpriteInfos[1].width;var thrusterDestHeight=scale*ratio*thrusterSpriteInfos[1].height;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.howitzerBulletThrusterSprite.update2(_dt19,x,y,0,_thrusterDestYOffset,thrusterDestWidth,thrusterDestHeight,_rotation4,_alpha28);instance.howitzerBulletThrusterSprite.render(ctx);var bulletDestWidth=scale*ratio*howitzerBulletSpriteInfo.width;var bulletDestHeight=scale*ratio*howitzerBulletSpriteInfo.height;instance.howitzerBulletSprite.update2(_dt19,x,y,0,0,bulletDestWidth,bulletDestHeight,_rotation4,_alpha28);instance.howitzerBulletSprite.render(ctx);instance.lastHowitzerBulletTime=_now20;}// =======================================
// MODIFIED: Laser Gun Bullet.
// =======================================
else if(instance.layer===904){var _animationInfo47=laserGunBulletSpriteInfo;var _destWidth66=scale*ratio*_animationInfo47.width;var _destHeight66=scale*ratio*_animationInfo47.height;if(!instance.laserGunBulletSprite){instance.laserGunBulletSprite=new Sprite(_animationInfo47.url,[0,0],// Position
[_animationInfo47.width,_animationInfo47.height],// Source size 
[_destWidth66,_destHeight66],// Destination size
16,// Animation speed
_animationInfo47.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now21=getNow();var _dt20=instance.lastLaserGunBulletTime?(_now21-instance.lastLaserGunBulletTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
var _rotation5=rot+90*(Math.PI/180);var _alpha29=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.laserGunBulletSprite.update2(_dt20,x,y,0,0,_destWidth66,_destHeight66,_rotation5,_alpha29);instance.laserGunBulletSprite.render(ctx);instance.lastLaserGunBulletTime=_now21;}// =======================================
// MODIFIED: Blue canon.
// =======================================
else if(instance.layer===906){var _animationInfo48=blueCanonSpriteInfo;var _destWidth67=scale*ratio*_animationInfo48.width;var _destHeight67=scale*ratio*_animationInfo48.height;if(!instance.blueCanonSprite){instance.blueCanonSprite=new Sprite(_animationInfo48.url,[0,0],// Position
[_animationInfo48.width,_animationInfo48.height],// Source size 
[_destWidth67,_destHeight67],// Destination size
20,// Animation speed
_animationInfo48.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now22=getNow();var _dt21=instance.lastBlueCanonTime?(_now22-instance.lastBlueCanonTime)/1000.0:0;var _alpha30=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.blueCanonSprite.update2(_dt21,x,y,0,0,_destWidth67,_destHeight67,rot,_alpha30);instance.blueCanonSprite.render(ctx);instance.lastBlueCanonTime=_now22;}// =======================================
// MODIFIED: Electro Gun.
// =======================================
else if(instance.layer===907){if(!instance.electroBulletSprite){var _animationInfo49=blueCanonSpriteInfo;var _destWidth68=_animationInfo49.width;var _destHeight68=_animationInfo49.height;instance.electroBulletSprite=new Sprite(_animationInfo49.url,[0,0],// Position
[_animationInfo49.width,_animationInfo49.height],// Source size 
[_destWidth68,_destHeight68],// Destination size
16,// Animation speed
_animationInfo49.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now23=Date.now();var _dt22=instance.electroBulletTime?(_now23-instance.electroBulletTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
var _rotation6=rot+90*(Math.PI/180);var _alpha31=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.electroBulletSprite.update(_dt22,x,y,0,0,_rotation6,_alpha31);instance.electroBulletSprite.render(ctx);instance.electroBulletTime=_now23;}// =======================================
// MODIFIED: Comet bullet.
// =======================================
else if(instance.layer===908){var _animationInfo50=cometSpriteInfo;var _destWidth69=scale*ratio*_animationInfo50.width;var _destHeight69=scale*ratio*_animationInfo50.height;if(!instance.cometSprite){instance.cometSprite=new Sprite(_animationInfo50.url,[0,0],// Position
[_animationInfo50.width,_animationInfo50.height],// Source size 
[_destWidth69,_destHeight69],// Destination size
12,// Animation speed
_animationInfo50.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now24=Date.now();var _dt23=instance.cometTime?(_now24-instance.cometTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
var _rotation7=rot+90*(Math.PI/180);var _alpha32=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.cometSprite.update2(_dt23,x,y,0,0,_destWidth69,_destHeight69,_rotation7,_alpha32);instance.cometSprite.render(ctx);instance.cometTime=_now24;}// =======================================
// MODIFIED: Space ball bullet.
// =======================================
else if(instance.layer===909){var _animationInfo51=spaceBallSpriteInfo;var _destWidth70=scale*ratio*_animationInfo51.width*0.9;var _destHeight70=scale*ratio*_animationInfo51.height*0.9;if(!instance.spaceBallSprite){instance.spaceBallSprite=new Sprite(_animationInfo51.url,[0,0],// Position
[_animationInfo51.width,_animationInfo51.height],// Source size 
[_destWidth70,_destHeight70],// Destination size
12,// Animation speed
_animationInfo51.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now25=Date.now();var _dt24=instance.spaceBallTime?(_now25-instance.spaceBallTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
var _rotation8=rot+180*(Math.PI/180);var _alpha33=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.spaceBallSprite.update2(_dt24,x,y,0,0,_destWidth70,_destHeight70,_rotation8,_alpha33);instance.spaceBallSprite.render(ctx);instance.spaceBallTime=_now25;}// =======================================
// MODIFIED: Asteroid.
// =======================================
else if(instance.layer===911){var _animationInfo52=asteroidSpriteInfo;var _destWidth71=scale*ratio*_animationInfo52.width;var _destHeight71=scale*ratio*_animationInfo52.height;if(!instance.asteroidSprite){instance.asteroidSprite=new Sprite(_animationInfo52.url,[0,0],// Position
[_animationInfo52.width,_animationInfo52.height],// Source size 
[_destWidth71,_destHeight71],// Destination size
1,// Animation speed
_animationInfo52.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var flameAnimationInfo=thrusterSpriteInfos[2];var flameDestWidth=scale*ratio*flameAnimationInfo.width;var flameDestHeight=scale*ratio*flameAnimationInfo.height;if(!instance.asteroidFlameSprite){instance.asteroidFlameSprite=new Sprite(flameAnimationInfo.url,[0,0],// Position
[flameAnimationInfo.width,flameAnimationInfo.height],// Source size 
[flameDestWidth,flameDestHeight],// Destination size
12,// Animation speed
flameAnimationInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var _now26=getNow();var _dt25=instance.lastAsteroidTime?(_now26-instance.lastAsteroidTime)/1000.0:0;// Add 90 degrees to align with the rotation of the asteroid.
var _rotation9=rot-90*(Math.PI/180);var _alpha34=instance.render.status.getFade();var flameDestYOffset=scale*ratio*-145;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.asteroidSprite.update2(_dt25,x,y,0,0,_destWidth71,_destHeight71,0,_alpha34);instance.asteroidSprite.render(ctx);instance.asteroidFlameSprite.update2(_dt25,x,y,0,flameDestYOffset,flameDestWidth,flameDestHeight,_rotation9,_alpha34);instance.asteroidFlameSprite.render(ctx);instance.lastAsteroidTime=_now26;}// =======================================
// MODIFIED: Laser Ship Long Bullet.
// =======================================
else if(instance.layer===913){var _destWidth72=scale*ratio*laserShipLongBulletSpriteInfo.width;var _destHeight72=scale*ratio*laserShipLongBulletSpriteInfo.height;if(!instance.laserShipLongBulletSprite){instance.laserShipLongBulletSprite=new Sprite(laserShipLongBulletSpriteInfo.url,[0,0],// Position
[laserShipLongBulletSpriteInfo.width,laserShipLongBulletSpriteInfo.height],// Source size 
[_destWidth72,_destHeight72],// Destination size
1,// Animation speed
laserShipLongBulletSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}// Add 90 degrees to align with the rotation of the bullet.            
var _alpha35=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.laserShipLongBulletSprite.update2(0,x,y,0,0,_destWidth72,_destHeight72,rot,_alpha35);instance.laserShipLongBulletSprite.render(ctx);}// =======================================
// MODIFIED: Laser Ship Arc Bullet.
// =======================================
else if(instance.layer===914){var _animationInfo53=laserShipArcBulletSpriteInfo;var _destWidth73=scale*ratio*_animationInfo53.width*0.8;var _destHeight73=scale*ratio*_animationInfo53.height*0.8;if(!instance.laserShipArcBulletSprite){instance.laserShipArcBulletSprite=new Sprite(_animationInfo53.url,[0,0],// Position
[_animationInfo53.width,_animationInfo53.height],// Source size 
[_destWidth73,_destHeight73],// Destination size
1,// Animation speed
_animationInfo53.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now27=getNow();var _dt26=instance.lastLaserShipArcBulletTime?(_now27-instance.lastLaserShipArcBulletTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
var _rotation10=rot;// + 180 * (Math.PI / 180);
var _alpha36=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.laserShipArcBulletSprite.update2(_dt26,x,y,0,0,_destWidth73,_destHeight73,_rotation10,_alpha36);instance.laserShipArcBulletSprite.render(ctx);instance.lastLaserShipArcBulletTime=_now27;}// =======================================
// MODIFIED: SpaceshipX Bullet.
// =======================================
else if(instance.layer===915){var _animationInfo54=spaceshipXBulletSpriteInfo;var _destWidth74=scale*ratio*_animationInfo54.width*0.65;var _destHeight74=scale*ratio*_animationInfo54.height*0.65;if(!instance.spaceshipXBulletSprite){instance.spaceshipXBulletSprite=new Sprite(_animationInfo54.url,[0,0],// Position
[_animationInfo54.width,_animationInfo54.height],// Source size 
[_destWidth74,_destHeight74],// Destination size
1,// Animation speed
_animationInfo54.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}// Add 90 degrees to align with the rotation of the bullet.
var _rotation11=rot;// + 180 * (Math.PI / 180);
var _alpha37=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.spaceshipXBulletSprite.update2(0,x,y,0,0,_destWidth74,_destHeight74,_rotation11,_alpha37);instance.spaceshipXBulletSprite.render(ctx);}// =======================================
// Valkyrie Bullet.
// =======================================
else if(instance.layer===916){var _animationInfo55=valkyrieBulletSpriteInfo;var _destWidth75=scale*ratio*_animationInfo55.width;var _destHeight75=scale*ratio*_animationInfo55.height;if(!instance.valkyrieBulletSprite){instance.valkyrieBulletSprite=new Sprite(_animationInfo55.url,[0,0],// Position
[_animationInfo55.width,_animationInfo55.height],// Source size 
[_destWidth75,_destHeight75],// Destination size
20,// Animation speed
_animationInfo55.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var now=getNow();var dt=instance.lastValkyrieBulletTime?(now-instance.lastValkyrieBulletTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
var _rotation12=rot+90*(Math.PI/180);var _alpha38=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.valkyrieBulletSprite.update2(dt,x,y,0,0,_destWidth75,_destHeight75,_rotation12,_alpha38);instance.valkyrieBulletSprite.render(ctx);instance.lastValkyrieBulletTime=now;}// =======================================
// MODIFIED: Valkyrie Laser.
// =======================================
else if(instance.layer===917){var _animationInfo56=valkyrieLaserSpriteInfo;var _destWidth76=scale*ratio*_animationInfo56.width;var _destHeight76=scale*ratio*_animationInfo56.height;if(!instance.valkyrieLaserSprite){instance.valkyrieLaserSprite=new Sprite(_animationInfo56.url,[0,0],// Position
[_animationInfo56.width,_animationInfo56.height],// Source size 
[_destWidth76,_destHeight76],// Destination size
1,// Animation speed
_animationInfo56.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}// Add 90 degrees to align with the rotation of the bullet.
var _rotation13=rot+90*(Math.PI/180);var _alpha39=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.valkyrieLaserSprite.update2(0,x,y,0,0,_destWidth76,_destHeight76,_rotation13,_alpha39);instance.valkyrieLaserSprite.render(ctx);}// =======================================
// MODIFIED: T-14 Armata Bullet.
// =======================================
else if(instance.layer===918){var _animationInfo57=armataBulletSpriteInfo;var _destWidth77=scale*ratio*_animationInfo57.width*0.8;var _destHeight77=scale*ratio*_animationInfo57.height*0.8;if(!instance.armataBulletSprite){instance.armataBulletSprite=new Sprite(_animationInfo57.url,[0,0],// Position
[_animationInfo57.width,_animationInfo57.height],// Source size 
[_destWidth77,_destHeight77],// Destination size
1,// Animation speed
_animationInfo57.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now28=getNow();var _dt27=instance.lastArmataBulletTime?(_now28-instance.lastArmataBulletTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
var _rotation14=rot+90*(Math.PI/180);var _alpha40=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.armataBulletSprite.update2(0,x,y,0,0,_destWidth77,_destHeight77,_rotation14,_alpha40);instance.armataBulletSprite.render(ctx);instance.lastArmataBulletTime=_now28;}// =======================================
// MODIFIED: ST-II (ST Two) Bullet.
// =======================================
else if(instance.layer===951){var _animationInfo58=stTwoBulletSpriteInfo;var _destWidth78=scale*ratio*_animationInfo58.width;var _destHeight78=scale*ratio*_animationInfo58.height;var _spriteId=instance.layer;if(!instance[_spriteId]){instance[_spriteId]=new Sprite(_animationInfo58.url,[0,0],// Position
[_animationInfo58.width,_animationInfo58.height],// Source size 
[_destWidth78,_destHeight78],// Destination size
1,// Animation speed
_animationInfo58.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}//let lastAnimTimeProp = 'lastAnimTime' + instance.layer;
//let now = getNow();
//let dt = instance[lastAnimTimeProp] ? (now - instance[lastAnimTimeProp]) / 1000.0 : 0;
// Add 90 degrees to align with the rotation of the bullet.
var _rotation15=rot+90*(Math.PI/180);var _alpha41=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance[_spriteId].update2(0,x,y,0,0,_destWidth78,_destHeight78,_rotation15,_alpha41);instance[_spriteId].render(ctx);//instance[lastAnimTimeProp] = now;
}// =======================================
// Mega Tank bullet.
// =======================================
else if(instance.layer===957){var _animationInfo59=megaTankBulletSpriteInfo;var _destWidth79=scale*ratio*_animationInfo59.width*0.6;var _destHeight79=scale*ratio*_animationInfo59.height*0.6;var _spriteId2='sprite_'+instance.layer;if(!instance[_spriteId2]){instance[_spriteId2]=new Sprite(_animationInfo59.url,[0,0],// Position
[_animationInfo59.width,_animationInfo59.height],// Source size
[_destWidth79,_destHeight79],// Destination size
1,// Animation speed
_animationInfo59.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var _alpha42=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance[_spriteId2].update2(0,x,y,0,0,_destWidth79,_destHeight79,rot,_alpha42);instance[_spriteId2].render(ctx);}// =======================================
// Paris Gun bullet.
// =======================================
else if(instance.layer===959){var _animationInfo60=parisGunBulletSpriteInfo;var _destWidth80=scale*ratio*_animationInfo60.width*0.75;var _destHeight80=scale*ratio*_animationInfo60.height*0.75;var _spriteId3='sprite_'+instance.layer;if(!instance[_spriteId3]){instance[_spriteId3]=new Sprite(_animationInfo60.url,[0,0],// Position
[_animationInfo60.width,_animationInfo60.height],// Source size
[_destWidth80,_destHeight80],// Destination size
12,// Animation speed
_animationInfo60.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}// Add 90 degrees to align with the rotation of the bullet.
var _rotation16=rot+90*(Math.PI/180);var _alpha43=instance.render.status.getFade();var lastAnimTimeProp='lastAnimTime'+instance.layer;var _now29=getNow();var _dt28=instance[lastAnimTimeProp]?(_now29-instance[lastAnimTimeProp])/1000.0:0;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance[_spriteId3].update2(_dt28,x,y,0,0,_destWidth80,_destHeight80,_rotation16,_alpha43);instance[_spriteId3].render(ctx);instance[lastAnimTimeProp]=_now29;}// =======================================
// T-60 Scout Tank Bullet.
// =======================================
else if(instance.layer===952){var _animationInfo61=armataBulletSpriteInfo;var _destWidth81=scale*ratio*_animationInfo61.width*0.7;var _destHeight81=scale*ratio*_animationInfo61.height*0.7;var _spriteId4=instance.layer;if(!instance[_spriteId4]){instance[_spriteId4]=new Sprite(_animationInfo61.url,[0,0],// Position
[_animationInfo61.width,_animationInfo61.height],// Source size 
[_destWidth81,_destHeight81],// Destination size
1,// Animation speed
_animationInfo61.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}// Add 90 degrees to align with the rotation of the bullet.
var _rotation17=rot+90*(Math.PI/180);var _alpha44=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance[_spriteId4].update2(0,x,y,0,0,_destWidth81,_destHeight81,_rotation17,_alpha44);instance[_spriteId4].render(ctx);}// =======================================
// Hypnotizer Bullet.
// =======================================
else if(instance.layer===953){var radius=drawSize/m.size*m.realSize;drawPoly(context,xx,yy,radius,m.shape,rot);drawPoly(context,xx,yy,radius/2,m.shape,rot);drawPoly(context,xx,yy,radius/3,m.shape,rot);}// =======================================
// Rail Gun Bullet.
// =======================================
else if(instance.layer===941){var _animationInfo62=railGunBulletSpriteInfo;var _destWidth82=scale*ratio*_animationInfo62.width*0.75;var _destHeight82=scale*ratio*_animationInfo62.height*0.75;if(!instance.railGunBulletSprite){instance.railGunBulletSprite=new Sprite(_animationInfo62.url,[0,0],// Position
[_animationInfo62.width,_animationInfo62.height],// Source size 
[_destWidth82,_destHeight82],// Destination size
18,// Animation speed
_animationInfo62.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now30=getNow();var _dt29=instance.lastAnimationTime?(_now30-instance.lastAnimationTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
var _rotation18=rot+90*(Math.PI/180);var _alpha45=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.railGunBulletSprite.update2(_dt29,x,y,0,0,_destWidth82,_destHeight82,_rotation18,_alpha45);instance.railGunBulletSprite.render(ctx);instance.lastAnimationTime=_now30;}// =======================================
// Tower Drone Bullet.
// =======================================
else if(instance.layer===944){var _animationInfo63=towerDroneBulletSpriteInfo;var _destWidth83=scale*ratio*_animationInfo63.width*0.6;var _destHeight83=scale*ratio*_animationInfo63.height*0.6;if(!instance.towerDroneBulletSprite){instance.towerDroneBulletSprite=new Sprite(_animationInfo63.url,[0,0],// Position
[_animationInfo63.width,_animationInfo63.height],// Source size 
[_destWidth83,_destHeight83],// Destination size
1,// Animation speed
_animationInfo63.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha46=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight, rotation, alpha
instance.towerDroneBulletSprite.update2(0,x,y,0,0,_destWidth83,_destHeight83,rot,_alpha46);instance.towerDroneBulletSprite.render(ctx);}// =======================================
// Andromeda Bullet.
// =======================================
else if(instance.layer===945){var _animationInfo64=andromedaBulletSpriteInfo;var _destWidth84=scale*ratio*_animationInfo64.width*0.6;var _destHeight84=scale*ratio*_animationInfo64.height*0.6;if(!instance.andromedaBulletSprite){instance.andromedaBulletSprite=new Sprite(_animationInfo64.url,[0,0],// Position
[_animationInfo64.width,_animationInfo64.height],// Source size 
[_destWidth84,_destHeight84],// Destination size
1,// Animation speed
_animationInfo64.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha47=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight, rotation, alpha
instance.andromedaBulletSprite.update2(0,x,y,0,0,_destWidth84,_destHeight84,rot,_alpha47);instance.andromedaBulletSprite.render(ctx);}// =======================================
// Quinjet Bullet.
// =======================================
else if(instance.layer===946){var _animationInfo65=quinjetBulletSpriteInfo;var _destWidth85=scale*ratio*_animationInfo65.width*0.4;var _destHeight85=scale*ratio*_animationInfo65.height*0.4;if(!instance.quinjetBulletSprite){instance.quinjetBulletSprite=new Sprite(_animationInfo65.url,[0,0],// Position
[_animationInfo65.width,_animationInfo65.height],// Source size 
[_destWidth85,_destHeight85],// Destination size
1,// Animation speed
_animationInfo65.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha48=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight, rotation, alpha
instance.quinjetBulletSprite.update2(0,x,y,0,0,_destWidth85,_destHeight85,rot,_alpha48);instance.quinjetBulletSprite.render(ctx);}// =======================================
// Jupiter Bullet.
// =======================================
else if(instance.layer===947){var _animationInfo66=jupiterBulletSpriteInfo;var _destWidth86=scale*ratio*_animationInfo66.width*0.75;var _destHeight86=scale*ratio*_animationInfo66.height*0.75;if(!instance.jupiterBulletSprite){instance.jupiterBulletSprite=new Sprite(_animationInfo66.url,[0,0],// Position
[_animationInfo66.width,_animationInfo66.height],// Source size 
[_destWidth86,_destHeight86],// Destination size
1,// Animation speed
_animationInfo66.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha49=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight, rotation, alpha
instance.jupiterBulletSprite.update2(0,x,y,0,0,_destWidth86,_destHeight86,rot,_alpha49);instance.jupiterBulletSprite.render(ctx);}// =======================================
// Force FieldX Canon Bullet.
// =======================================
else if(instance.layer===948){var _animationInfo67=forceFieldXCanonSpriteInfo;var _destWidth87=scale*ratio*_animationInfo67.width*0.6;var _destHeight87=scale*ratio*_animationInfo67.height*0.6;if(!instance.forceFieldXCanonSprite){instance.forceFieldXCanonSprite=new Sprite(_animationInfo67.url,[0,0],// Position
[_animationInfo67.width,_animationInfo67.height],// Source size 
[_destWidth87,_destHeight87],// Destination size
1,// Animation speed
_animationInfo67.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha50=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight, rotation, alpha
instance.forceFieldXCanonSprite.update2(0,x,y,0,0,_destWidth87,_destHeight87,rot,_alpha50);instance.forceFieldXCanonSprite.render(ctx);}// =======================================
// Force FieldX Laser Bullet.
// =======================================
else if(instance.layer===949){var _animationInfo68=forceFieldXLaserSpriteInfo;var _destWidth88=scale*ratio*_animationInfo68.width*0.5;var _destHeight88=scale*ratio*_animationInfo68.height*0.5;if(!instance.forceFieldXLaserSprite){instance.forceFieldXLaserSprite=new Sprite(_animationInfo68.url,[0,0],// Position
[_animationInfo68.width,_animationInfo68.height],// Source size 
[_destWidth88,_destHeight88],// Destination size
1,// Animation speed
_animationInfo68.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha51=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight, rotation, alpha
instance.forceFieldXLaserSprite.update2(0,x,y,0,0,_destWidth88,_destHeight88,rot,_alpha51);instance.forceFieldXLaserSprite.render(ctx);}// =======================================
// Phaser Bullet.
// =======================================
else if(instance.layer===950){var _animationInfo69=phaserBulletSpriteInfo;var _destWidth89=scale*ratio*_animationInfo69.width*0.9;var _destHeight89=scale*ratio*_animationInfo69.height*0.9;if(!instance.phaserBulletSprite){instance.phaserBulletSprite=new Sprite(_animationInfo69.url,[0,0],// Position
[_animationInfo69.width,_animationInfo69.height],// Source size 
[_destWidth89,_destHeight89],// Destination size
1,// Animation speed
_animationInfo69.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha52=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight, rotation, alpha
instance.phaserBulletSprite.update2(0,x,y,0,0,_destWidth89,_destHeight89,rot,_alpha52);instance.phaserBulletSprite.render(ctx);}// =======================================
// MODIFIED: Electro Ring Bullet.
// =======================================
else if(instance.layer===919){var _animationInfo70=electroRingSpriteInfo;//let destWidth = scale * ratio * animationInfo.width;
//let destHeight = scale * ratio * animationInfo.height;
var _destWidth90=drawSize/m.size*m.realSize*2.2;var _destHeight90=drawSize/m.size*m.realSize*2.2;if(!instance.electroRingSprite){instance.electroRingSprite=new Sprite(_animationInfo70.url,[0,0],// Position
[_animationInfo70.width,_animationInfo70.height],// Source size 
[_destWidth90,_destHeight90],// Destination size
18,// Animation speed
_animationInfo70.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now31=getNow();var _dt30=instance.lastElectroRingTime?(_now31-instance.lastElectroRingTime)/1000.0:0;// Add 90 degrees to align with the rotation of the bullet.
//let rotation = rot + 90 * (Math.PI / 180);
var _alpha53=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
instance.electroRingSprite.update2(_dt30,x,y,0,0,_destWidth90,_destHeight90,rot,_alpha53);instance.electroRingSprite.render(ctx);instance.lastElectroRingTime=_now31;}// =======================================
// MODIFIED: Freeze Gun Bullet.
// =======================================
else if(instance.layer===930){var _animationInfo71=freezeGunBulletSpriteInfo;var _destWidth91=scale*ratio*_animationInfo71.width;var _destHeight91=scale*ratio*_animationInfo71.height;//let destWidth = (drawSize / m.size * m.realSize) * 2.2;
//let destHeight = (drawSize / m.size * m.realSize) * 2.2;
if(!instance.freezeGunBulletSprite){instance.freezeGunBulletSprite=new Sprite(_animationInfo71.url,[0,0],// Position
[_animationInfo71.width,_animationInfo71.height],// Source size 
[_destWidth91,_destHeight91],// Destination size
1,// Animation speed
_animationInfo71.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha54=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//instance.freezeGunBulletSprite.update(0, x, y, 0,0, rot, alpha);
instance.freezeGunBulletSprite.update2(0,x,y,0,0,_destWidth91,_destHeight91,rot,_alpha54);instance.freezeGunBulletSprite.render(ctx);}// =======================================
// MODIFIED: Phantom Zone Gun Bullet.
// =======================================
else if(instance.layer===938){var _animationInfo72=phantomBulletSpriteInfo;//let destWidth = scale * ratio * animationInfo.width;
//let destHeight = scale * ratio * animationInfo.height;
var _destWidth92=drawSize/m.size*m.realSize*2.2;var _destHeight92=drawSize/m.size*m.realSize*2.2;if(!instance.phantomBulletSprite){instance.phantomBulletSprite=new Sprite(_animationInfo72.url,[0,0],// Position
[_animationInfo72.width,_animationInfo72.height],// Source size 
[_destWidth92,_destHeight92],// Destination size
1,// Animation speed
_animationInfo72.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha55=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha            
instance.phantomBulletSprite.update2(0,x,y,0,0,_destWidth92,_destHeight92,rot,_alpha55);instance.phantomBulletSprite.render(ctx);}// =======================================
// MODIFIED: Nuker Bullet.
// =======================================
else if(instance.layer===931){var _animationInfo73=nukerBulletSpriteInfo;var _destWidth93=scale*ratio*_animationInfo73.width*0.75;var _destHeight93=scale*ratio*_animationInfo73.height*0.75;if(!instance.nukerBulletSprite){instance.nukerBulletSprite=new Sprite(_animationInfo73.url,[0,0],// Position
[_animationInfo73.width,_animationInfo73.height],// Source size 
[_destWidth93,_destHeight93],// Destination size
12,// Animation speed
_animationInfo73.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}//let shadowAnimationInfo = nukerBulletShadowSpriteInfo;                
var _shadowDestWidth=scale*ratio*nukerBulletShadowSpriteInfo.width*0.55;var _shadowDestHeight=scale*ratio*nukerBulletShadowSpriteInfo.height*0.55;if(!instance.nukerBulletShadowSprite){instance.nukerBulletShadowSprite=new Sprite(nukerBulletShadowSpriteInfo.url,[0,0],// Position
[nukerBulletShadowSpriteInfo.width,nukerBulletShadowSpriteInfo.height],// Source size 
[_shadowDestWidth,_shadowDestHeight],// Destination size
12,// Animation speed
nukerBulletShadowSpriteInfo.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now32=getNow();var _dt31=instance.lastNukerBulletTime?(_now32-instance.lastNukerBulletTime)/1000.0:0;var _rotation19=rot+90*(Math.PI/180);var _alpha56=instance.render.status.getFade();var _shadowDestXOffset=scale*ratio*nukerBulletShadowSpriteInfo.offsetX;var _shadowDestYOffset=scale*ratio*nukerBulletShadowSpriteInfo.offsetY;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                        
//instance.nukerBulletShadowSprite.update(dt, x, y, shadowDestXOffset, shadowDestYOffset, rotation, alpha);
instance.nukerBulletShadowSprite.update2(_dt31,x,y,_shadowDestXOffset,_shadowDestYOffset,_shadowDestWidth,_shadowDestHeight,_rotation19,_alpha56);instance.nukerBulletShadowSprite.render(ctx);//instance.nukerBulletSprite.update(dt, x, y, 0, 0, rotation, alpha);
instance.nukerBulletSprite.update2(_dt31,x,y,0,0,_destWidth93,_destHeight93,_rotation19,_alpha56);instance.nukerBulletSprite.render(ctx);instance.lastNukerBulletTime=_now32;// =====================================================                        
if(instance.render.status.getFade()<=0.8){var _animationInfo74=nukerExplosionInfo;var _destWidth94=scale*ratio*(_animationInfo74.width*1.5);var _destHeight94=scale*ratio*(_animationInfo74.height*1.5);if(!instance.nukerExplosionSprite){instance.nukerExplosionSprite=new Sprite(_animationInfo74.url,[0,0],// Position
[_animationInfo74.width,_animationInfo74.height],// Source size 
[_destWidth94,_destHeight94],// Destination size
10,// Animation speed
_animationInfo74.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}var _now33=getNow();var _dt32=instance.lastNukerExplosionTime?(_now33-instance.lastNukerExplosionTime)/1000.0:0;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                
var _destXOffset5=scale*ratio*_animationInfo74.offsetX;var _destYOffset5=scale*ratio*_animationInfo74.offsetY;instance.nukerExplosionSprite.update2(_dt32,x,y,_destXOffset5,_destYOffset5,_destWidth94,_destHeight94,0,1);instance.nukerExplosionSprite.render(ctx);instance.lastNukerExplosionTime=_now33;}}// =======================================
// MODIFIED: Firestone Bullet.
// =======================================
else if(instance.layer===932){var _animationInfo75=firestoneBulletSpriteInfo;var _destWidth95=scale*ratio*_animationInfo75.width*0.9;var _destHeight95=scale*ratio*_animationInfo75.height*0.9;if(!instance.firestoneBulletSprite){instance.firestoneBulletSprite=new Sprite(_animationInfo75.url,[0,0],// Position
[_animationInfo75.width,_animationInfo75.height],// Source size 
[_destWidth95,_destHeight95],// Destination size
1,// Animation speed
_animationInfo75.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha57=instance.render.status.getFade();instance.firestoneBulletSprite.update2(0,x,y,0,0,_destWidth95,_destHeight95,rot,_alpha57);instance.firestoneBulletSprite.render(ctx);}// =======================================
// MODIFIED: Imprisoner Bullet.
// =======================================
else if(instance.layer===942){var _animationInfo76=imprisonerBulletSpriteInfo;var _destWidth96=scale*ratio*_animationInfo76.width;var _destHeight96=scale*ratio*_animationInfo76.height;if(!instance.imprisonerBulletSprite){instance.imprisonerBulletSprite=new Sprite(_animationInfo76.url,[0,0],// Position
[_animationInfo76.width,_animationInfo76.height],// Source size 
[_destWidth96,_destHeight96],// Destination size
1,// Animation speed
_animationInfo76.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _alpha58=instance.render.status.getFade();instance.imprisonerBulletSprite.update2(0,x,y,0,0,_destWidth96,_destHeight96,0,_alpha58);instance.imprisonerBulletSprite.render(ctx);}// =======================================
// Hellgate Fire (bullet).
// =======================================
else if(instance.layer===958){var _animationInfo77=hellgateBulletSpriteInfo;var _destWidth97=scale*ratio*_animationInfo77.width;var _destHeight97=scale*ratio*_animationInfo77.height;if(!instance.hellgateBulletSprite){instance.hellgateBulletSprite=new Sprite(_animationInfo77.url,[0,0],// Position
[_animationInfo77.width,_animationInfo77.height],// Source size 
[_destWidth97,_destHeight97],// Destination size
10,// Animation speed
_animationInfo77.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now34=getNow();var _dt33=instance.lastHellgateBulletAnimTime?(_now34-instance.lastHellgateBulletAnimTime)/1000.0:0;var _alpha59=instance.render.status.getFade();instance.hellgateBulletSprite.update2(_dt33,x,y,0,0,_destWidth97,_destHeight97,0,_alpha59);instance.hellgateBulletSprite.render(ctx);instance.lastHellgateBulletAnimTime=_now34;}// =======================================
// MODIFIED: Detonator Bullet.
// =======================================
else if(instance.layer===933){if(instance.render.status.getFade()<=0.8){var _animationInfo78=nukerExplosionInfo;var _destWidth98=scale*_animationInfo78.width;var _destHeight98=scale*_animationInfo78.height;if(!instance.detonatorExplosionSprite){instance.detonatorExplosionSprite=new Sprite(_animationInfo78.url,[0,0],// Position
[_animationInfo78.width,_animationInfo78.height],// Source size 
[_destWidth98,_destHeight98],// Destination size
10,// Animation speed
_animationInfo78.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}var _now35=getNow();var _dt34=instance.lastDetonatorExplosionTime?(_now35-instance.lastDetonatorExplosionTime)/1000.0:0;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                
var _destXOffset6=scale*ratio*_animationInfo78.offsetX;var _destYOffset6=scale*ratio*_animationInfo78.offsetY;instance.detonatorExplosionSprite.update(_dt34,x,y,_destXOffset6,_destYOffset6,0,1);instance.detonatorExplosionSprite.render(ctx);instance.lastDetonatorExplosionTime=_now35;}}// =======================================
// MODIFIED: Time Bomb Bullet.
// =======================================
else if(instance.layer===934){var _animationInfo79=timeBombSpriteInfo;var _destWidth99=scale*ratio*_animationInfo79.width;var _destHeight99=scale*ratio*_animationInfo79.height;if(!instance.timeBombSprite){instance.timeBombSprite=new Sprite(_animationInfo79.url,[0,0],// Position
[_animationInfo79.width,_animationInfo79.height],// Source size 
[_destWidth99,_destHeight99],// Destination size
10,// Animation speed
_animationInfo79.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now36=getNow();var _dt35=instance.lastTimeBombTime?(_now36-instance.lastTimeBombTime)/1000.0:0;var _rotation20=rot;// + 90 * (Math.PI / 180);
var _alpha60=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                        
instance.timeBombSprite.update2(_dt35,x,y,0,0,_destWidth99,_destHeight99,_rotation20,_alpha60);instance.timeBombSprite.render(ctx);instance.lastTimeBombTime=_now36;if(instance.render.status.getFade()<=0.8){var explosionDestWidth=scale*nukerExplosionInfo.width;var explosionDestHeight=scale*nukerExplosionInfo.height;if(!instance.timeBombExplosionSprite){instance.timeBombExplosionSprite=new Sprite(nukerExplosionInfo.url,[0,0],// Position
[nukerExplosionInfo.width,nukerExplosionInfo.height],// Source size 
[explosionDestWidth,explosionDestHeight],// Destination size
10,// Animation speed
nukerExplosionInfo.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}var _now37=getNow();var _dt36=instance.lastTimeBombExplosionTime?(_now37-instance.lastTimeBombExplosionTime)/1000.0:0;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                
var _destXOffset7=scale*ratio*nukerExplosionInfo.offsetX;var _destYOffset7=scale*ratio*nukerExplosionInfo.offsetY;instance.timeBombExplosionSprite.update2(_dt36,x,y,_destXOffset7,_destYOffset7,explosionDestWidth,explosionDestHeight,0,1);instance.timeBombExplosionSprite.render(ctx);instance.lastTimeBombExplosionTime=_now37;}}// ======================================================
// MODIFIED: Remote Controlled Bomb (RC Bomb) Bullet.
// ======================================================
else if(instance.layer===935){var _animationInfo80=rcBombSpriteInfo;var _destWidth100=scale*ratio*_animationInfo80.width;var _destHeight100=scale*ratio*_animationInfo80.height;if(!instance.rcBombSprite){instance.rcBombSprite=new Sprite(_animationInfo80.url,[0,0],// Position
[_animationInfo80.width,_animationInfo80.height],// Source size 
[_destWidth100,_destHeight100],// Destination size
2,// Animation speed
_animationInfo80.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now38=getNow();var _dt37=instance.lastRCBombTime?(_now38-instance.lastRCBombTime)/1000.0:0;var _rotation21=rot;// + 90 * (Math.PI / 180);
var _alpha61=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                        
instance.rcBombSprite.update2(_dt37,x,y,0,0,_destWidth100,_destHeight100,_rotation21,_alpha61);instance.rcBombSprite.render(ctx);instance.lastRCBombTime=_now38;if(instance.render.status.getFade()<=0.8){var _explosionDestWidth=scale*nukerExplosionInfo.width;var _explosionDestHeight=scale*nukerExplosionInfo.height;if(!instance.rcBombExplosionSprite){instance.rcBombExplosionSprite=new Sprite(nukerExplosionInfo.url,[0,0],// Position
[nukerExplosionInfo.width,nukerExplosionInfo.height],// Source size 
[_explosionDestWidth,_explosionDestHeight],// Destination size
10,// Animation speed
nukerExplosionInfo.frames,// Frames
null,// Direction (default is horizontal)
true);// Play once   
}var _now39=getNow();var _dt38=instance.lastRCBombExplosionTime?(_now39-instance.lastRCBombExplosionTime)/1000.0:0;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                
var _destXOffset8=scale*ratio*nukerExplosionInfo.offsetX;var _destYOffset8=scale*ratio*nukerExplosionInfo.offsetY;instance.rcBombExplosionSprite.update2(_dt38,x,y,_destXOffset8,_destYOffset8,_explosionDestWidth,_explosionDestHeight,0,1);instance.rcBombExplosionSprite.render(ctx);instance.lastRCBombExplosionTime=_now39;}}// =======================================
// MODIFIED: Invisible Bullet. Laser Beam Bullet.
// =======================================
else if(instance.layer===1000||instance.layer===913){}// Don't draw anything.
// =======================================
// MODIFIED: Alien Drone.
// =======================================
else if(instance.layer===21){var _animationInfo81=alienDroneSpriteInfo;var _destWidth101=scale*ratio*_animationInfo81.width;var _destHeight101=scale*ratio*_animationInfo81.height;if(!instance.alienDroneSprite){instance.alienDroneSprite=new Sprite(_animationInfo81.url,[0,0],// Position
[_animationInfo81.width,_animationInfo81.height],// Source size 
[_destWidth101,_destHeight101],// Destination size
20,// Animation speed
_animationInfo81.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now40=getNow();var _dt39=instance.lastAlienDroneTime?(_now40-instance.lastAlienDroneTime)/1000.0:0;var _rotation22=rot+90*(Math.PI/180);var _alpha62=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                     
//instance.alienDroneSprite.update(dt, x, y, 0, 0, rotation, alpha);
instance.alienDroneSprite.update2(_dt39,x,y,0,0,_destWidth101,_destHeight101,_rotation22,_alpha62);instance.alienDroneSprite.render(ctx);instance.lastAlienDroneTime=_now40;}// ==============================
// Tower Drone.
// ==============================
else if(instance.layer===26){var _animationInfo82=towerDroneSpriteInfo;var _destWidth102=scale*ratio*_animationInfo82.width*0.7;var _destHeight102=scale*ratio*_animationInfo82.height*0.7;if(!instance.towerDroneSprite){instance.towerDroneSprite=new Sprite(_animationInfo82.url,[0,0],// Position
[_animationInfo82.width,_animationInfo82.height],// Source size 
[_destWidth102,_destHeight102],// Destination size
1,// Animation speed
_animationInfo82.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha63=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight,  rotation, alpha
instance.towerDroneSprite.update2(0,x,y,0,0,_destWidth102,_destHeight102,rot,_alpha63);instance.towerDroneSprite.render(ctx);}// ==============================
// Andromeda Drone.
// ==============================
else if(instance.layer===27){var _animationInfo83=andromedaDroneSpriteInfo;var _destWidth103=scale*ratio*_animationInfo83.width*0.8;var _destHeight103=scale*ratio*_animationInfo83.height*0.8;if(!instance.andromedaDroneSprite){instance.andromedaDroneSprite=new Sprite(_animationInfo83.url,[0,0],// Position
[_animationInfo83.width,_animationInfo83.height],// Source size 
[_destWidth103,_destHeight103],// Destination size
1,// Animation speed
_animationInfo83.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once   
}var _alpha64=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight,  rotation, alpha
instance.andromedaDroneSprite.update2(0,x,y,0,0,_destWidth103,_destHeight103,rot,_alpha64);instance.andromedaDroneSprite.render(ctx);}// ==============================
// Invader Drone.
// ==============================
else if(instance.layer===28){var _animationInfo84=invaderDroneSpriteInfo;var _destWidth104=scale*ratio*_animationInfo84.width*0.8;var _destHeight104=scale*ratio*_animationInfo84.height*0.8;if(!instance.invaderDroneSprite){instance.invaderDroneSprite=new Sprite(_animationInfo84.url,[0,0],// Position
[_animationInfo84.width,_animationInfo84.height],// Source size
[_destWidth104,_destHeight104],// Destination size
1,// Animation speed
_animationInfo84.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once
}var _alpha65=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight,  rotation, alpha
instance.invaderDroneSprite.update2(0,x,y,0,0,_destWidth104,_destHeight104,rot,_alpha65);instance.invaderDroneSprite.render(ctx);}// =======================================
// Fastlord Drone.
// =======================================
else if(instance.layer===25){var _animationInfo85=underlordDroneSpriteInfo;var _destWidth105=scale*ratio*(_animationInfo85.width*0.5);var _destHeight105=scale*ratio*(_animationInfo85.height*0.5);if(!instance.underlordDroneSprite){instance.underlordDroneSprite=new Sprite(_animationInfo85.url,[0,0],// Position
[_animationInfo85.width,_animationInfo85.height],// Source size 
[_destWidth105,_destHeight105],// Destination size
1,// Animation speed
_animationInfo85.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now41=getNow();var _dt40=instance.lastAnimationTime?(_now41-instance.lastAnimationTime)/1000.0:0;var _rotation23=rot+90*(Math.PI/180);var _alpha66=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                     
instance.underlordDroneSprite.update2(_dt40,x,y,0,0,_destWidth105,_destHeight105,_rotation23,_alpha66);instance.underlordDroneSprite.render(ctx);instance.lastAnimationTime=_now41;}// =======================================
// MODIFIED: Drone Bunker Drone.
// =======================================
else if(instance.layer===24){var _animationInfo86=droneBunkerDroneSpriteInfo;var _destWidth106=scale*ratio*(_animationInfo86.width*0.6);var _destHeight106=scale*ratio*(_animationInfo86.height*0.6);if(!instance.droneBunkerDroneSprite){instance.droneBunkerDroneSprite=new Sprite(_animationInfo86.url,[0,0],// Position
[_animationInfo86.width,_animationInfo86.height],// Source size 
[_destWidth106,_destHeight106],// Destination size
12,// Animation speed
_animationInfo86.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now42=getNow();var _dt41=instance.lastDroneBunkerDroneTime?(_now42-instance.lastDroneBunkerDroneTime)/1000.0:0;var _rotation24=rot;// + 90 * (Math.PI / 180);
var _alpha67=instance.render.status.getFade();// dt, destX, destY, destXOffset, destYOffset, destWidth, destHeight, rotation, alpha                     
instance.droneBunkerDroneSprite.update2(_dt41,x,y,0,0,_destWidth106,_destHeight106,_rotation24,_alpha67);instance.droneBunkerDroneSprite.render(ctx);instance.lastDroneBunkerDroneTime=_now42;}// =======================================
// MODIFIED: Portal.
// =======================================
// else if (instance.layer === 20)
// {           
//     let animationInfo = portalSpriteInfo;                            
//     let destWidth = (scale * ratio * animationInfo.width);
//     let destHeight = (scale * ratio * animationInfo.height);
//     if (!instance.portalSprite)
//     {               
//         instance.portalSprite = new Sprite(animationInfo.url, 
//                                     [0, 0], // Position
//                                     [animationInfo.width, animationInfo.height], // Source size 
//                                     [destWidth, destHeight], // Destination size
//                                     20, // Animation speed
//                                     animationInfo.frames, // Frames
//                                     null, // Direction (default is horizontal)
//                                     false); // Play once                   
//     }
//     let now = getNow();
//     let dt = instance.lastPortalTime ? (now - instance.lastPortalTime) / 1000.0 : 0;
//     // dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                     
//     instance.portalSprite.update2(dt, x, y, 0, 0, destWidth, destHeight, 0, 1);
//     instance.portalSprite.render(ctx);
//     instance.lastPortalTime = now;
// }
// =======================================
// Zerg Base.
// =======================================
else if(instance.layer===19){if(!instance.zergBaseSprite){var _animationInfo87=zergBaseSpriteInfo;var _destWidth107=scale*ratio*_animationInfo87.width;var _destHeight107=scale*ratio*_animationInfo87.height;instance.zergBaseSprite=new Sprite(_animationInfo87.url,[0,0],// Position
[_animationInfo87.width,_animationInfo87.height],// Source size 
[_destWidth107,_destHeight107],// Destination size
2,// Animation speed
_animationInfo87.frames,// Frames
null,// Direction (default is horizontal)
false);// Play once                   
}var _now43=getNow();var _dt42=instance.lastZergBaseTime?(_now43-instance.lastZergBaseTime)/1000.0:0;// dt, destX, destY, destXOffset, destYOffset,  rotation, alpha                     
instance.zergBaseSprite.update(_dt42,x,y,0,0,0,1);instance.zergBaseSprite.render(ctx);instance.lastZergBaseTime=_now43;}else{// Draw body.
// if (instance.underAttack){
//     // Warg attack.
//     if (instance.underAttackType === 99){                    
//         ctx.save();                       
//         ctx.globalCompositeOperation = "xor";                    
//         drawPoly(context, xx, yy, drawSize / m.size * m.realSize, m.shape, rot);
//         ctx.restore();                    
//     }
// }
// else 
{drawPoly(context,xx,yy,drawSize/m.size*m.realSize,m.shape,rot);}}// =======================================================================
// MODIFIED: Shockwave. Electro Gun.
// ========================================        
if(!(instance.layer===5&&(instance.tankType===6||instance.tankType===7||instance.tankType===8)))// ========================================
{// Draw turrets above us
if(source.turrets.length===m.turrets.length){for(var _i7=0;_i7<m.turrets.length;_i7++){var _t=m.turrets[_i7];if(_t.layer===1){var _ang=_t.direction+_t.angle+rot,_len4=_t.offset*drawSize;drawEntity(xx+_len4*Math.cos(_ang),yy+_len4*Math.sin(_ang),_t,ratio,drawSize/ratio/_t.size*_t.sizeFactor,source.turrets[_i7].facing+turretsObeyRot*rot,turretsObeyRot,context,source.turrets[_i7],render);}}}else{throw new Error("Mismatch turret number with mockup.");}}if(assignedContext==false&&context!=ctx){ctx.save();ctx.globalAlpha=fade;ctx.imageSmoothingEnabled=false;//ctx.globalCompositeOperation = "overlay";
// Commented out.
//ctx.filter = 'blur(' + Math.round(config.graphical.deathBlurAmount - config.graphical.deathBlurAmount * fade) + 'px)';
ctx.drawImage(context.canvas,x-xx,y-yy);ctx.restore();//ctx.globalCompositeOperation = "source-over";
}};}();function drawHealth(x,y,instance,ratio){// Don't draw health if under attack by Night Stalker.
//  if (instance.id != gui.playerid && instance.underAttackType === 2) {
//         return;
// }
// Draw health bar
ctx.globalAlpha=Math.pow(instance.render.status.getFade(),2);var size=instance.size*ratio;var m=mockups[instance.index];var realSize=size/m.size*m.realSize;// Draw health
if(instance.drawsHealth){// MODIFIED: Invisibility. Cloaking.
// =======================================
ctx.save();ctx.globalAlpha=instance.opacity;// =======================================
// Death explosion.
// =======================================        
if(instance.render.status.getFade()<=0){ctx.globalAlpha=0;}// =======================================
var health=instance.render.health.get();var shield=instance.render.shield.get();if(health<1||shield<1){var yy=y+1.1*realSize+15;drawBar(x-size,x+size,yy,3+config.graphical.barChunk,color.black);drawBar(x-size,x-size+2*size*health,yy,3,color.lgreen);if(shield){// MODIFIED: Invisibility. Cloaking.
// =======================================
if(instance.opacity>=1)// =======================================
{ctx.globalAlpha=0.3+shield*0.3;drawBar(x-size,x-size+2*size*shield,yy,3,color.teal);ctx.globalAlpha=1;}}}// MODIFIED: Invisibility. Cloaking.
// =======================================
ctx.restore();// =======================================
}// =================================================================
if(instance.id!==_gui.playerid){// Don't draw label if under attack by Night Stalker.
//if (instance.underAttackType !== 2)
{// if (Math.random() > 0.95){
//     console.log('instance.nameplate: ' + instance.nameplate);
// }            
if(instance.nameplate){if(instance.render.textobjs==null)instance.render.textobjs=[TextObj(),TextObj()];if(instance.name!=="\0"){// MODIFIED: Invisibility. Cloaking.
// =======================================
ctx.save();ctx.globalAlpha=instance.opacity;// =======================================
// Death explosion.
// =======================================        
if(instance.render.status.getFade()<=0){ctx.globalAlpha=0;}// =======================================            
var nameColor=color.guiwhite;var colorIndex=instance.roleColorIndex;// colorIndices[instance.role];
// Player team color name.
//console.log('instance.team=' + instance.team);
if(global.gameMode==='tdm'){// if (Math.random() > 0.95){
//     console.log('instance.team=' + instance.team);
// }
// If it is -1, -2, -3, etc, convert it to positive one.
var teamNumber=Math.abs(instance.team);if(!isNaN(teamNumber)&&teamNumber<=4){colorIndex=[10,11,12,15][teamNumber-1];}}if(colorIndex!==undefined&&colorIndex>=0){nameColor=getRoleColor(colorIndex);}var playerNameFontSize=16;var playerName=modifyOverlyLongName(instance.name,playerNameFontSize,600);// Draw other players' names.
instance.render.textobjs[0].draw(playerName,x,y-realSize-30,playerNameFontSize,nameColor,'center');instance.render.textobjs[1].draw(util.handleLargeNumber(instance.score,true),x,y-realSize-16,8,color.guiwhite,'center');// MODIFIED: Invisibility. Cloaking.
// =======================================
ctx.restore();// =======================================
}else{instance.render.textobjs[0].draw('a spoopy ??',x,y-realSize-30,16,color.lavender,'center');instance.render.textobjs[1].draw(util.handleLargeNumber(instance.score,true),x,y-realSize-16,8,color.lavender,'center');}}}}// =================================================================
}// Start animation
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){//window.setTimeout(callback, 1000 / 60);
};}();window.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.mozCancelAnimationFrame;}();// Drawing states
var gameDraw=function(){var statMenu=Smoothbar(0,0.7,1.5);var upgradeMenu=Smoothbar(0,2,3);// Define the graph constructor
function graph(){var data=[];return function(point,x,y,w,h,col){// Add point and push off old ones
data.push(point);while(data.length>w){data.splice(0,1);}// Get scale
var min=Math.min.apply(Math,data),max=Math.max.apply(Math,data),range=max-min;// Draw zero
if(max>0&&min<0){drawBar(x,x+w,y+h*max/range,2,color.guiwhite);}// Draw points
ctx.beginPath();var i=-1;data.forEach(function(p){if(!++i){ctx.moveTo(x,y+h*(max-p)/range);}else{ctx.lineTo(x+i,y+h*(max-p)/range);}});ctx.lineWidth=1;ctx.strokeStyle=col;ctx.stroke();};}// Lag compensation functions
var compensation=function(){// Protected functions
function interpolate(p1,p2,v1,v2,ts,tt){var k=Math.cos((1+tt)*Math.PI);return 0.5*(((1+tt)*v1+p1)*(k+1)+(-tt*v2+p2)*(1-k));}function extrapolate(p1,p2,v1,v2,ts,tt){return p2+(p2-p1)*tt;/*v2 + 0.5 * tt * (v2 - v1) * ts*/}// Useful thing
function angleDifference(sourceA,targetA){var mod=function mod(a,n){return(a%n+n)%n;};var a=targetA-sourceA;return mod(a+Math.PI,2*Math.PI)-Math.PI;}// Constructor
return function(){// Protected vars
var timediff=0,t=0,tt=0,ts=0;// Methods
return{set:function set(){var time=arguments.length>0&&arguments[0]!==undefined?arguments[0]:player.time;var interval=arguments.length>1&&arguments[1]!==undefined?arguments[1]:metrics.rendergap;t=Math.max(getNow()-time-80,-interval);if(t>150&&t<1000){t=150;}if(t>1000){t=1000*1000*Math.sin(t/1000-1)/t+1000;}tt=t/interval;ts=config.roomSpeed*30*t/1000;},predict:function predict(p1,p2,v1,v2){return t>=0?extrapolate(p1,p2,v1,v2,ts,tt):interpolate(p1,p2,v1,v2,ts,tt);},predictFacing:function predictFacing(f1,f2){return f1+(1+tt)*angleDifference(f1,f2);},getPrediction:function getPrediction(){return t;}};};}();// The skill bar dividers
var ska=function(){function make(x){return Math.log(4*x+1)/Math.log(5);}var a=[];for(var i=0;i<config.gui.expectedMaxSkillLevel*2;i++){a.push(make(i/config.gui.expectedMaxSkillLevel));}// The actual lookup function
return function(x){return a[x];};}();// Text objects
var text={skillNames:[TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj()],skillKeys:[TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj()],skillValues:[TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj()],skillPoints:TextObj(),score:TextObj(),name:TextObj(),class:TextObj(),debug:[TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj()],lbtitle:TextObj(),leaderboard:[TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj()],upgradeNames:[TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),// ========================
// More upgrade menus.
// ========================
// ================
// Upgrade menu.
TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj()],upgradeKeys:[TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj(),TextObj()],skipUpgrades:TextObj()};// The drawing loop
return function(ratio){// Prep stuff
renderTimes++;var px=void 0,py=void 0;{// Move the camera
var motion=compensation();motion.set();var smear={x:0,y:0};// moveCompensation.get();
// smear = moveCompensation.get();
// Don't move the camera if you're dead. This helps with jitter issues
player.renderx=motion.predict(player.lastx,player.x,player.lastvx,player.vx)+smear.x;player.rendery=motion.predict(player.lasty,player.y,player.lastvy,player.vy)+smear.y;px=ratio*player.renderx;py=ratio*player.rendery;}{// Clear the background + draw grid             
clearScreen(color.white,1);clearScreen(color.guiblack,0.1);var W=roomSetup[0].length,H=roomSetup.length,i=0;roomSetup.forEach(function(row){var j=0;row.forEach(function(cell){var left=Math.max(0,ratio*j*global.gameWidth/W-px+global.screenWidth/2),top=Math.max(0,ratio*i*global.gameHeight/H-py+global.screenHeight/2),right=Math.min(global.screenWidth,ratio*(j+1)*global.gameWidth/W-px+global.screenWidth/2),bottom=Math.min(global.screenHeight,ratio*(i+1)*global.gameHeight/H-py+global.screenHeight/2);ctx.globalAlpha=1;ctx.fillStyle=config.graphical.screenshotMode?color.guiwhite:color.white;ctx.fillRect(left,top,right-left,bottom-top);ctx.globalAlpha=0.3;ctx.fillStyle=config.graphical.screenshotMode?color.guiwhite:getZoneColor(cell,true);ctx.fillRect(left,top,right-left,bottom-top);j++;});i++;});ctx.lineWidth=1;ctx.strokeStyle=config.graphical.screenshotMode?color.guiwhite:color.guiblack;ctx.globalAlpha=0.04;ctx.beginPath();var gridsize=30*ratio;for(var x=(global.screenWidth/2-px)%gridsize;x<global.screenWidth;x+=gridsize){ctx.moveTo(x,0);ctx.lineTo(x,global.screenHeight);}for(var y=(global.screenHeight/2-py)%gridsize;y<global.screenHeight;y+=gridsize){ctx.moveTo(0,y);ctx.lineTo(global.screenWidth,y);}ctx.stroke();ctx.globalAlpha=1;}{// Draw things 
var drawOwnTankLast=false;entities.forEach(function entitydrawingloop(instance){if(instance.id===_gui.playerid&&instance.underAttackType===2){drawOwnTankLast=true;return 1;}// Don't draw drones or minions yet. Draw them later so that
// they appear on top of tanks.
if(instance.layer===12||instance.layer===13){return 1;}{if(!instance.render.draws){return 1;}var _motion=compensation();if(instance.render.status.getFade()===1){_motion.set();}else{_motion.set(instance.render.lastRender,instance.render.interval);}instance.render.x=_motion.predict(instance.render.lastx,instance.x,instance.render.lastvx,instance.vx);instance.render.y=_motion.predict(instance.render.lasty,instance.y,instance.render.lastvy,instance.vy);instance.render.f=instance.id===_gui.playerid&&!instance.twiggle?Math.atan2(target.y,target.x):_motion.predictFacing(instance.render.lastf,instance.facing);// ===================================================================
// Modified: Might need to refer to this for Lightning.
// ===================================================================
//const halfScreenWidth = global.screenWidth / 2;
var _x27=instance.id===_gui.playerid?0:ratio*instance.render.x-px;var _y=instance.id===_gui.playerid?0:ratio*instance.render.y-py;// ====================================
// Predator zoom experiment.
// ====================================
if(instance.canZoom===1&&instance.usingPower===1){_x27=ratio*instance.render.x-px;_y=ratio*instance.render.y-py;}// ====================================
_x27+=global.screenWidth/2;_y+=global.screenHeight/2;drawEntity(_x27,_y,instance,ratio,1.1,instance.render.f);}});// ================================================
// Draw drones or minions so that they appear on top of
// tanks (except when a tank is "night stalked").
// ================================================
entities.filter(function(instance){return instance.layer===12||instance.layer===13;}).forEach(function entitydrawingloop(instance){{if(!instance.render.draws){return 1;}var _motion2=compensation();if(instance.render.status.getFade()===1){_motion2.set();}else{_motion2.set(instance.render.lastRender,instance.render.interval);}instance.render.x=_motion2.predict(instance.render.lastx,instance.x,instance.render.lastvx,instance.vx);instance.render.y=_motion2.predict(instance.render.lasty,instance.y,instance.render.lastvy,instance.vy);instance.render.f=instance.id===_gui.playerid&&!instance.twiggle?Math.atan2(target.y,target.x):_motion2.predictFacing(instance.render.lastf,instance.facing);// ===================================================================
// Modified: Might need to refer to this for Lightning.
// ===================================================================
var _x28=instance.id===_gui.playerid?0:ratio*instance.render.x-px,_y2=instance.id===_gui.playerid?0:ratio*instance.render.y-py;_x28+=global.screenWidth/2;_y2+=global.screenHeight/2;drawEntity(_x28,_y2,instance,ratio,1.1,instance.render.f);}});// ================================================
// For Night Stalker feature. Draw own tank last.
// This has the side effect of drones displayed under a tank
// instead of over it.
// ================================================
if(drawOwnTankLast){entities.filter(function(instance){return instance.id==_gui.playerid;}).forEach(function entitydrawingloop(instance){if(instance.id===_gui.playerid){if(!instance.render.draws){return 1;}var _motion3=compensation();if(instance.render.status.getFade()===1){_motion3.set();}else{_motion3.set(instance.render.lastRender,instance.render.interval);}instance.render.x=_motion3.predict(instance.render.lastx,instance.x,instance.render.lastvx,instance.vx);instance.render.y=_motion3.predict(instance.render.lasty,instance.y,instance.render.lastvy,instance.vy);instance.render.f=instance.id===_gui.playerid&&!instance.twiggle?Math.atan2(target.y,target.x):_motion3.predictFacing(instance.render.lastf,instance.facing);// ===================================================================
// Modified: Might need to refer to this for Lightning.
// ===================================================================
var _x29=instance.id===_gui.playerid?0:ratio*instance.render.x-px,_y3=instance.id===_gui.playerid?0:ratio*instance.render.y-py;// ====================================
// Predator zoom experiment.
// ====================================
if(instance.canZoom===1&&instance.usingPower===1){_x29=ratio*instance.render.x-px;_y3=ratio*instance.render.y-py;}// ====================================
_x29+=global.screenWidth/2;_y3+=global.screenHeight/2;drawEntity(_x29,_y3,instance,ratio,1.1,instance.render.f);}});}// ===============================
if(!config.graphical.screenshotMode){entities.forEach(function entityhealthdrawingloop(instance){var x=instance.id===_gui.playerid?0:ratio*instance.render.x-px,y=instance.id===_gui.playerid?0:ratio*instance.render.y-py;// ====================================
// Predator zoom experiment.
// ====================================
if(instance.canZoom===1&&instance.usingPower===1){x=ratio*instance.render.x-px;y=ratio*instance.render.y-py;}// ====================================
x+=global.screenWidth/2;y+=global.screenHeight/2;drawHealth(x,y,instance,ratio);});}}// Draw GUI       
var alcoveSize=200/Math.max(global.screenWidth,global.screenHeight*16/9);var spacing=20;_gui.__s.update();var lb=_leaderboard.get();var max=lb.max;{// Draw messages. On top of screen.
var vspacing=4;var len=0;var height=20;//18;
var _x30=global.screenWidth/2;var _y4=spacing;// Draw each message
for(var _i8=messages.length-1;_i8>=0;_i8--){var msg=messages[_i8],txt=msg.text,_text=txt;//txt[0].toUpperCase() + txt.substring(1);  
// Give it a textobj if it doesn't have one
if(msg.textobj==null)msg.textobj=TextObj();if(msg.len==null)msg.len=measureText(_text,height-4);if(msg.len<1400){// Draw the background
ctx.globalAlpha=0.5*msg.alpha;drawBar(_x30-msg.len/2,_x30+msg.len/2,_y4+height/2,height,color.black);// Draw the text
ctx.globalAlpha=Math.min(1,msg.alpha);//msg.textobj.draw(text, x, y + height / 2, height - 4, color.guiwhite, 'center', true);                
// Modified:
var messageColor=getColor(msg.colorIndex);msg.textobj.draw(_text,_x30,_y4+height/2,height-4,messageColor,'center',true);// Iterate and move
_y4+=vspacing+height;if(msg.status>1){_y4-=(vspacing+height)*(1-Math.sqrt(msg.alpha));}if(msg.status>1){msg.status-=0.2;//0.05;
msg.alpha+=0.2;//0.05;
}else if(_i8===0&&(messages.length>=7||Date.now()-msg.time>8000)){msg.status-=0.2;//0.05;
msg.alpha-=0.2;//0.05;
// Remove
if(msg.alpha<=0){messages[0].textobj.remove();messages.splice(0,1);}}}}ctx.globalAlpha=1;}// =================================================
// Draw chat messages - flat backgrounds.
// =================================================
{// Draw chat messages
var _vspacing=4;var _height=22;var _x31=50;var _y5=global.screenHeight*1/3+spacing;ctx.save();ctx.lineCap='miter';ctx.lineJoin='miter';// Draw each message
for(var _i9=chatMessages.length-1;_i9>=0;_i9--){var chatMessageObj=chatMessages[_i9];var playerName=chatMessageObj.playerName;var message=chatMessageObj.text;var tmpPlayerName=playerName;var tmpMessage=message;// Give it a textobj if it doesn't have one
if(chatMessageObj.textobj==null){chatMessageObj.textobj=TextObj();}if(chatMessageObj.playerNameDrawWidth==null){chatMessageObj.playerNameDrawWidth=measureText(tmpPlayerName,_height-4);}if(chatMessageObj.messageDrawWidth==null){chatMessageObj.messageDrawWidth=measureText(tmpMessage,_height-4);}var totalDrawWidth=chatMessageObj.playerNameDrawWidth+chatMessageObj.messageDrawWidth;if(totalDrawWidth<1000){// ========================================================
// Player name.
// ========================================================
var playerNameX1=_x31-4;var playerNameX2=_x31+chatMessageObj.playerNameDrawWidth+4;//ctx.globalAlpha = 0.6;
// drawBar(playerNameX1, playerNameX2, y + height / 2, height, color.black);
// const playerNameColor = getColor(chatMessageObj.colorIndex);
// ctx.globalAlpha = 0.8;
// chatMessageObj.textobj.draw(tmpPlayerName, playerNameX1, y + (height / 2) + 1, height - 4, playerNameColor, 'left', true);
// ========================================================
// Chat message.
// ========================================================
var chatX1=playerNameX2;// + 10;
var chatX2=chatX1+chatMessageObj.messageDrawWidth+12;ctx.globalAlpha=1.0;drawBar(chatX1,chatX2,_y5+_height/2,_height,color.black);var _messageColor=getRoleColor(chatMessageObj.colorIndex);chatMessageObj.textobj.draw(tmpMessage,chatX1+2,_y5+_height/2+1,_height-4,_messageColor,'left',true);// Draw player name and background on top of the message.
ctx.globalAlpha=0.6;drawBar(playerNameX1,playerNameX2,_y5+_height/2,_height,color.black);var playerNameColor=getRoleColor(chatMessageObj.colorIndex);ctx.globalAlpha=0.8;chatMessageObj.textobj.draw(tmpPlayerName,playerNameX1,_y5+_height/2+1,_height-4,playerNameColor,'left',true);// Iterate and move
_y5+=_vspacing+_height;}}ctx.restore();ctx.globalAlpha=1;}// ======================================================        
{// Draw skill bars
global.canSkill=!!_gui.points;// ============================================================================
// Don't show skill bars when died.
// ============================================================================
//statMenu.set(0 + (global.canSkill || global.died || global.statHover));
statMenu.set(0+(global.canSkill||global.statHover));// ============================================================================
global.clickables.stat.hide();var _vspacing2=4;var _height2=15;var gap=35;var _len5=alcoveSize*global.screenWidth;// The 30 is for the value modifiers
var save=_len5;var _x32=-spacing-2*_len5+statMenu.get()*(2*spacing+2*_len5);var _y6=global.screenHeight-spacing-_height2;var ticker=11;var namedata=_gui.getStatNames(mockups[_gui.type].statnames||-1);_gui.skills.forEach(function drawASkillBar(skill){// Individual skill bars 
ticker--;var name=namedata[ticker-1],level=skill.amount,col=color[skill.color],cap=skill.softcap,maxLevel=skill.cap;if(cap){_len5=save;var _max=config.gui.expectedMaxSkillLevel,extension=cap>_max,blocking=cap<maxLevel;if(extension){_max=cap;}drawBar(_x32+_height2/2,_x32-_height2/2+_len5*ska(cap),_y6+_height2/2,_height2-3+config.graphical.barChunk,color.black);drawBar(_x32+_height2/2,_x32+_height2/2+(_len5-gap)*ska(cap),_y6+_height2/2,_height2-3,color.grey);drawBar(_x32+_height2/2,_x32+_height2/2+(_len5-gap)*ska(level),_y6+_height2/2,_height2-3.5,col);// Blocked-off area
if(blocking){ctx.lineWidth=1;ctx.strokeStyle=color.grey;for(var j=cap+1;j<_max;j++){drawGuiLine(_x32+(_len5-gap)*ska(j),_y6+1.5,_x32+(_len5-gap)*ska(j),_y6-3+_height2);}}// Vertical dividers
ctx.strokeStyle=color.black;ctx.lineWidth=1;for(var _j=1;_j<level+1;_j++){drawGuiLine(_x32+(_len5-gap)*ska(_j),_y6+1.5,_x32+(_len5-gap)*ska(_j),_y6-3+_height2);}// Skill name
_len5=save*ska(_max);var textcolor=level==maxLevel?col:!_gui.points||cap!==maxLevel&&level==cap?color.grey:color.guiwhite;text.skillNames[ticker-1].draw(name,Math.round(_x32+_len5/2)+0.5,_y6+_height2/2,_height2-5,textcolor,'center',true);// Skill key
text.skillKeys[ticker-1].draw('['+ticker%10+']',Math.round(_x32+_len5-_height2*0.25)-1.5,_y6+_height2/2,_height2-5,textcolor,'right',true);if(textcolor===color.guiwhite){// If it's active
global.clickables.stat.place(ticker-1,_x32,_y6,_len5,_height2);}// Skill value
if(level){text.skillValues[ticker-1].draw(textcolor===col?'MAX':'+'+level,Math.round(_x32+_len5+4)+0.5,_y6+_height2/2,_height2-5,col,'left',true);}// Move on 
_y6-=_height2+_vspacing2;}});global.clickables.hover.place(0,0,_y6,0.8*_len5,0.8*(global.screenHeight-_y6));if(_gui.points!==0){// Draw skillpoints to spend
text.skillPoints.draw('x'+_gui.points,Math.round(_x32+_len5-2)+0.5,Math.round(_y6+_height2-4)+0.5,20,color.guiwhite,'right');}}{// Draw name, exp and score bar
var _vspacing3=4;var _len6=1.65*alcoveSize*global.screenWidth;var _height3=25;var _x33=(global.screenWidth-_len6)/2;var _y7=global.screenHeight-spacing-_height3;ctx.lineWidth=1;// Handle exp
// Draw the exp bar
drawBar(_x33,_x33+_len6,_y7+_height3/2,_height3-3+config.graphical.barChunk,color.black);drawBar(_x33,_x33+_len6,_y7+_height3/2,_height3-3,color.grey);drawBar(_x33,_x33+_len6*_gui.__s.getProgress(),_y7+_height3/2,_height3-3.5,color.gold);// Draw the class type
text.class.draw('Level '+_gui.__s.getLevel()+' '+mockups[_gui.type].name,_x33+_len6/2,_y7+_height3/2,_height3-4,color.guiwhite,'center',true);_height3=14;_y7-=_height3+_vspacing3;// Draw the %-of-leader bar
drawBar(_x33+_len6*0.1,_x33+_len6*0.9,_y7+_height3/2,_height3-3+config.graphical.barChunk,color.black);drawBar(_x33+_len6*0.1,_x33+_len6*0.9,_y7+_height3/2,_height3-3,color.grey);drawBar(_x33+_len6*0.1,_x33+_len6*(0.1+0.8*(max?Math.min(1,_gui.__s.getScore()/max):1)),_y7+_height3/2,_height3-3.5,color.green);// Draw the score
text.score.draw('Score: '+util.handleLargeNumber(_gui.__s.getScore()),_x33+_len6/2,_y7+_height3/2,_height3-2,color.guiwhite,'center',true);// Draw the name            
var fontSize=32;var _playerName=modifyOverlyLongName(player.name,fontSize,500);ctx.lineWidth=4;text.name.draw(_playerName,Math.round(_x33+_len6/2)+0.5,Math.round(_y7-10-_vspacing3)+0.5,fontSize,color.guiwhite,'center');}{// Draw minimap and FPS monitors
// ============================================================
// Rectangular maze walls.
// ============================================================
var minimapWidth=alcoveSize*global.screenWidth;var minimapHeight=minimapWidth;var minimapX=global.screenWidth-minimapWidth-spacing;var minimapY=global.screenHeight-minimapHeight-spacing;// ============================================================
ctx.globalAlpha=0.5;var _W=roomSetup[0].length,_H=roomSetup.length,_i10=0;roomSetup.forEach(function(row){var j=0;row.forEach(function(cell){ctx.fillStyle=getZoneColor(cell,false);drawGuiRect(minimapX+j++*minimapWidth/_W,minimapY+_i10*minimapHeight/_H,minimapWidth/_W,minimapHeight/_H);});_i10++;});ctx.fillStyle=color.grey;drawGuiRect(minimapX,minimapY,minimapWidth,minimapHeight);// ============================================================
// Rectangular maze walls.
// ============================================================
// Minimap Maze Wall
// ==========================================================            
minimap.forEach(function(obj){// Maze wall
//if (o[2] === 16 || o[2] === 9) 
//if (obj[2] === 16) 
if(obj[6]==='mazewall'){// ================================
// obj[0] = x
// obj[1] = y
// obj[2] = color
// obj[3] = size
// obj[4] = sizeVert
// obj[5] = rotation
// obj[6] = entity type
// ================================
ctx.fillStyle=mixColors(getColor(obj[2]),color.black,0.5);ctx.globalAlpha=0.8;var wallWidth=obj[3]*2/global.gameWidth*minimapWidth;var wallHeight=obj[4]*2/global.gameHeight*minimapHeight;var wallX=minimapX+obj[0]/global.gameWidth*minimapWidth-wallWidth/2;var wallY=minimapY+obj[1]/global.gameHeight*minimapHeight-wallHeight/2;var rotation=obj[5];if(rotation>0){var halfWallWidth=wallWidth/2;var halfWallHeight=wallHeight/2;ctx.save();ctx.beginPath();// https://stackoverflow.com/questions/17125632/html5-canvas-rotate-object-without-moving-coordinates
// move the rotation point to the center of the rect
//ctx.translate(wallX, wallY);
ctx.translate(wallX+halfWallWidth,wallY+halfWallHeight);ctx.rotate(rotation);// draw the rect on the transformed context
// Note: after transforming [0,0] is visually [x,y]
//       so the rect needs to be offset accordingly when drawn
drawGuiRect(-halfWallWidth,-halfWallHeight,wallWidth,wallHeight);//context.restore();
ctx.closePath();ctx.stroke();ctx.fill();ctx.restore();}else{drawGuiRect(wallX,wallY,wallWidth,wallHeight);}}});// ==========================================================
ctx.globalAlpha=1;ctx.lineWidth=1;ctx.strokeStyle=color.black;// My position
/* Original
	            drawGuiRect( 
	                x + (player.x / global.gameWidth) * len - 1,
	                y + (player.y / global.gameWidth) * height - 1,
	                3, 3, true
	            );
	            */var myRadius=64;var myRadiusScaled=myRadius/global.gameWidth*minimapWidth;if(myRadiusScaled>8){myRadiusScaled=8;}// Modified.
ctx.fillStyle=color.blue;// ====================================
// Predator zoom experiment.
// ====================================
var playerX=player.x/global.gameWidth;var playerY=player.y/global.gameWidth;// if (global.player.id === gui.playerid){
//     //if (player.canZoom === 1 && player.usingPower === 1)
//     {
//         console.log('can zoom');
//         // x = ratio * instance.render.x - px;
//         // y = ratio * instance.render.y - py;
//         playerX = player.renderx;
//         playerY = player.rendery;
//     }
// }
// ====================================
drawGuiCircle(minimapX+playerX*minimapWidth-1,minimapY+playerY*minimapHeight-1,myRadiusScaled);// Leader Tracker
// ====================================================
// Sandbox.
// Display leader tracker if it is not in sandbox mode.
//if (global.player.sandboxId < 0)
if(global.gameMode!=='sandbox'){// Leader position  
if(global.leader.id!==_gui.playerid&&global.leader.x!==-1&&global.leader.y!==-1){var leaderRadius=64;var leaderRadiusScaled=leaderRadius/global.gameWidth*minimapWidth;if(leaderRadiusScaled>8){leaderRadiusScaled=8;}ctx.strokeStyle=color.black;ctx.fillStyle=color.red;drawGuiCircle(minimapX+global.leader.x/global.gameWidth*minimapWidth-1,minimapY+global.leader.y/global.gameWidth*minimapHeight-1,leaderRadiusScaled);}}// =============================================
ctx.lineWidth=3;ctx.fillStyle=color.black;drawGuiRect(minimapX,minimapY,minimapWidth,minimapHeight,true);// Border            
text.debug[3].draw('Latency: '+metrics.latency+'ms',minimapX+minimapWidth,minimapY-50-3*14,10,color.guiwhite,'right');text.debug[2].draw('Client FPS: '+metrics.rendertime,minimapX+minimapWidth,minimapY-50-2*14,10,color.guiwhite,'right');text.debug[1].draw('Server Speed: '+(100*_gui.fps).toFixed(2)+'%'+(_gui.fps===1?'':' OVERLOADED!'),minimapX+minimapWidth,minimapY-50-1*14,10,_gui.fps===1?color.guiwhite:color.orange,'right');text.debug[0].draw(serverName,minimapX+minimapWidth,minimapY-50,10,color.guiwhite,'right');}{// Draw leaderboard            
// MODIFIED: Sprite leaderboard.
// ========================================
//let vspacing = 4;
var _vspacing4=8;// ========================================
var _len7=alcoveSize*global.screenWidth;var _height4=14;var _x34=global.screenWidth-_len7-spacing;var _y8=spacing+_height4+7;// Sandbox.
// ==============================================
if(global.player.sandboxId>=0){var leaderboardTitle='Sandbox Id: '+global.player.sandboxId;text.lbtitle.draw(leaderboardTitle,Math.round(_x34+_len7/2)+0.5,Math.round(_y8-6)+0.5,_height4+4,color.red,'center');}else{text.lbtitle.draw('Leaderboard:',Math.round(_x34+_len7/2)+0.5,Math.round(_y8-6)+0.5,_height4+4,color.guiwhite,'center');}// ==============================================
// Sandbox.
// Display "normal" leaderboard if it is not in sandbox mode.
//if (global.player.sandboxId < 0)
if(global.gameMode!=='sandbox'){var _i11=0;lb.data.forEach(function(entry){drawBar(_x34,_x34+_len7,_y8+_height4/2,_height4-3+config.graphical.barChunk,color.black);drawBar(_x34,_x34+_len7,_y8+_height4/2,_height4-3,color.grey);var shift=Math.min(1,entry.score/max);drawBar(_x34,_x34+_len7*shift,_y8+_height4/2,_height4-3.5,entry.barcolor);var nameColor=color.guiwhite;var colorIndex=entry.roleColorIndex;if(colorIndex!==undefined&&colorIndex>=0){nameColor=getRoleColor(colorIndex);}// Leadboard name + score 
var leaderboardNameFontSize=_height4-5;var leaderboardName=modifyOverlyLongName(entry.label,leaderboardNameFontSize,200);text.leaderboard[_i11++].draw(leaderboardName+': '+util.handleLargeNumber(Math.round(entry.score)),_x34+_len7/2,_y8+_height4/2,_height4-5,nameColor,'center',true);// Mini-image
var scale=_height4/entry.position.axis,xx=_x34-1.5*_height4-scale*entry.position.middle.x*0.707,yy=_y8+0.5*_height4+scale*entry.position.middle.x*0.707;// =============================================
// Leaderboard sprite.
// =============================================
// let animationInfo = tankSpriteMockups[entry.image.name];   
// if (animationInfo)
// {                    
//     let destWidth = 22;
//     let destHeight = 22;
//     let sprite = new Sprite(animationInfo.url, 
//                                 [0, 0], // Position
//                                 [animationInfo.width, animationInfo.height], // Source size 
//                                 [destWidth, destHeight], // Destination size
//                                 1, // Animation speed
//                                 animationInfo.frames, // Frames
//                                 null, // Direction (default is horizontal)
//                                 false); // Play once  
//     // dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//     sprite.update(10, xx, yy, 0, 0, -Math.PI / 4, 1);
//     sprite.render(ctx);
// }    
// else 
// {
//     drawEntity(xx, yy, entry.image, 1 / scale, scale * scale / entry.image.size, -Math.PI / 4, true);
// }
drawEntity(xx,yy,entry.image,1/scale,scale*scale/entry.image.size,-Math.PI/4,true);// =============================================
// Move down
_y8+=_vspacing4+_height4;});}// Sandbox.
else{var _i12=0;lb.data.forEach(function(entry){if(entry.sandboxId===global.player.sandboxId){drawBar(_x34,_x34+_len7,_y8+_height4/2,_height4-3+config.graphical.barChunk,color.black);drawBar(_x34,_x34+_len7,_y8+_height4/2,_height4-3,color.grey);var shift=Math.min(1,entry.score/max);drawBar(_x34,_x34+_len7*shift,_y8+_height4/2,_height4-3.5,entry.barcolor);var nameColor=color.guiwhite;var colorIndex=entry.roleColorIndex;if(colorIndex!==undefined&&colorIndex>=0){nameColor=getRoleColor(colorIndex);}// Leadboard name + score 
var leaderboardNameFontSize=_height4-5;var leaderboardName=modifyOverlyLongName(entry.label,leaderboardNameFontSize,200);text.leaderboard[_i12++].draw(leaderboardName+': '+util.handleLargeNumber(Math.round(entry.score)),_x34+_len7/2,_y8+_height4/2,_height4-5,nameColor,'center',true);// Mini-image
var scale=_height4/entry.position.axis,xx=_x34-1.5*_height4-scale*entry.position.middle.x*0.707,yy=_y8+0.5*_height4+scale*entry.position.middle.x*0.707;// =============================================
// Leaderboard sprite.
// =============================================
// let animationInfo = tankSpriteMockups[entry.image.name];   
// if (animationInfo)
// {                    
//     let destWidth = 22;
//     let destHeight = 22;
//     let sprite = new Sprite(animationInfo.url, 
//                                 [0, 0], // Position
//                                 [animationInfo.width, animationInfo.height], // Source size 
//                                 [destWidth, destHeight], // Destination size
//                                 1, // Animation speed
//                                 animationInfo.frames, // Frames
//                                 null, // Direction (default is horizontal)
//                                 false); // Play once  
//     // dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//     sprite.update(10, xx, yy, 0, 0, -Math.PI / 4, 1);
//     sprite.render(ctx);
// }    
// else 
// {
//     drawEntity(xx, yy, entry.image, 1 / scale, scale * scale / entry.image.size, -Math.PI / 4, true);
// }
drawEntity(xx,yy,entry.image,1/scale,scale*scale/entry.image.size,-Math.PI/4,true);// =============================================
// Move down
_y8+=_vspacing4+_height4;}});}}// ===================================================================
// Experiment. More rows. This is just a hard-coded hack.
// ===================================================================
var row1=[0,3,6,9,12,15,18,21];var row2=[1,4,7,10,13,16,19,22];var row3=[2,5,8,11,14,17,20,23];// ===================================================================
{// Draw upgrade menu
upgradeMenu.set(0+(global.canUpgrade||global.upgradeHover));var glide=upgradeMenu.get();global.clickables.upgrade.hide();if(_gui.upgrades.length>0){global.canUpgrade=true;var internalSpacing=8;var _len8=alcoveSize*global.screenWidth/2*1;var _height5=_len8;var _x35=glide*2*spacing-spacing;var _y9=spacing;var xo=_x35;var xxx=0;var yo=_y9;var _ticker=0;upgradeSpin+=0.01;var colorIndex=10;var _i13=0;//console.log('len:' + len);
_gui.upgrades.forEach(function drawAnUpgrade(model){if(_y9>yo)yo=_y9;xxx=_x35;global.clickables.upgrade.place(_i13++,_x35,_y9,_len8,_height5);// Draw box
ctx.globalAlpha=0.5;ctx.fillStyle=getColor(colorIndex);drawGuiRect(_x35,_y9,_len8,_height5);ctx.globalAlpha=0.1;ctx.fillStyle=getColor(-10+colorIndex++);drawGuiRect(_x35,_y9,_len8,_height5*0.6);ctx.fillStyle=color.black;drawGuiRect(_x35,_y9+_height5*0.6,_len8,_height5*0.4);ctx.globalAlpha=1;// Find offset location with rotation
var picture=getEntityImageFromMockup(model,_gui.color),position=mockups[model].position,scale=0.6*_len8/position.axis,xx=_x35+0.5*_len8-scale*position.middle.x*Math.cos(upgradeSpin),yy=_y9+0.5*_height5-scale*position.middle.x*Math.sin(upgradeSpin);// MODIFIED: Commented out.
//drawEntity(xx, yy, picture, 1, scale / picture.size, upgradeSpin, true);
// =============================================
// Upgrade menu sprite.
// =============================================
// let animationInfo = tankSpriteMockups[picture.name];   
// if (animationInfo)
// {                    
//     let destWidth = len * 0.85;
//     let destHeight = height * 0.85;
//     let sprite = new Sprite(animationInfo.url, 
//                                 [0, 0], // Position
//                                 [animationInfo.width, animationInfo.height], // Source size 
//                                 [destWidth, destHeight], // Destination size
//                                 1, // Animation speed
//                                 animationInfo.frames, // Frames
//                                 null, // Direction (default is horizontal)
//                                 false); // Play once  
//     // dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//     sprite.update(8, xx, yy, 0, 0, upgradeSpin, 1);
//     sprite.render(ctx);
// }    
// else 
// {
//     drawEntity(xx, yy, picture, 1, scale / picture.size, upgradeSpin, true);
// }                                      
drawEntity(xx,yy,picture,1,scale/picture.size,upgradeSpin,true);// =============================================
// Tank name
text.upgradeNames[_i13-1].draw(picture.name,_x35+0.9*_len8/2,_y9+_height5-6,_height5/8-3,color.guiwhite,'center');ctx.strokeStyle=color.black;ctx.globalAlpha=1;ctx.lineWidth=3;drawGuiRect(_x35,_y9,_len8,_height5,true);// Border
// More upgrade menus. More rows.
// if (ticker++ % 2) {
//     // Even number. 0, 2, 4, 6, ...
//     //console.log('[A] ticker: ' + ticker);
//     y -= height + internalSpacing;
//     x += glide * (len + internalSpacing);
// } else {
//     // Odd number. 1, 3, 5, 7, ...
//     //console.log('[B] ticker: ' + ticker);
//     y += height + internalSpacing;
// }
_ticker++;// ===================================================================
// Experiment. More rows. This is just a hard-coded hack.
// ===================================================================
if(row1.includes(_ticker)){_y9-=_height5*2+internalSpacing*2;_x35+=glide*(_len8+internalSpacing);}else if(row2.includes(_ticker)){_y9+=_height5+internalSpacing;}else if(row3.includes(_ticker)){_y9+=_height5+internalSpacing;}// ===================================================================
});// Draw box
var h=14,_msg="Don't Upgrade",m=measureText(_msg,h-3)+10;var xx=xo+(xxx+_len8+internalSpacing-xo)/2,yy=yo+_height5+internalSpacing;drawBar(xx-m/2,xx+m/2,yy+h/2,h+config.graphical.barChunk,color.black);drawBar(xx-m/2,xx+m/2,yy+h/2,h,color.white);text.skipUpgrades.draw(_msg,xx,yy+h/2,h-2,color.guiwhite,'center',true);global.clickables.skipUpgrades.place(0,xx-m/2,yy,m,h);}else{global.canUpgrade=false;global.clickables.upgrade.hide();global.clickables.skipUpgrades.hide();}}metrics.lastrender=getNow();};}();var gameDrawDead=function(){var text={taunt:TextObj(),level:TextObj(),score:TextObj(),time:TextObj(),kills:TextObj(),death:TextObj(),playagain:TextObj()};var getKills=function getKills(){var finalKills=[Math.round(global.finalKills[0].get()),Math.round(global.finalKills[1].get()),Math.round(global.finalKills[2].get())];var b=finalKills[0]+0.5*finalKills[1]+3*finalKills[2];return(b===0?'??':b<4?'??':b<8?'??':b<15?'??':b<25?'??':b<50?'??':b<75?'??':b<100?'???':'??')+(finalKills[0]||finalKills[1]||finalKills[2]?' '+(finalKills[0]?finalKills[0]+' kills':'')+(finalKills[0]&&finalKills[1]?' and ':'')+(finalKills[1]?finalKills[1]+' assists':'')+((finalKills[0]||finalKills[1])&&finalKills[2]?' and ':'')+(finalKills[2]?finalKills[2]+' visitors defeated':''):' A true pacifist')+'.';};var getDeath=function getDeath(){var txt='';if(global.finalKillers.length){txt='?? Succumbed to';global.finalKillers.forEach(function(e){txt+=' '+util.addArticle(mockups[e].name)+' and';});txt=txt.slice(0,-4)+'.';}else{txt+=' Well that was kinda sad, huh?';}return txt;};return function(){clearScreen(color.black,0.25);var x=global.screenWidth/2,y=global.screenHeight/2-50;var picture=getEntityImageFromMockup(_gui.type,_gui.color),len=140,position=mockups[_gui.type].position,scale=len/position.axis,xx=global.screenWidth/2-scale*position.middle.x*0.707,yy=global.screenHeight/2-35+scale*position.middle.x*0.707;// MODIFIED: Commented out.
//drawEntity(xx - 190 - len / 2, yy - 10, picture, 1.5, 0.5 * scale / picture.realSize, -Math.PI / 4, true);
// =============================================
// Death screen menu sprite.
// =============================================
// let animationInfo = tankSpriteMockups[picture.name];   
// if (animationInfo)
// {                    
//     let destWidth = len * 0.85;
//     let destHeight = len * 0.85;
//     let sprite = new Sprite(animationInfo.url, 
//                                 [0, 0], // Position
//                                 [animationInfo.width, animationInfo.height], // Source size 
//                                 [destWidth, destHeight], // Destination size
//                                 1, // Animation speed
//                                 animationInfo.frames, // Frames
//                                 null, // Direction (default is horizontal)
//                                 false); // Play once  
//     // dt, destX, destY, destXOffset, destYOffset,  rotation, alpha
//     sprite.update(8, xx - 190 - len / 2, yy - 10, 0, 0, upgradeSpin, 1);
//     sprite.render(ctx);
// }    
// else 
// {
//     drawEntity(xx - 190 - len / 2, yy - 10, picture, 1.5, 0.5 * scale / picture.realSize, -Math.PI / 4, true);            
// }       
drawEntity(xx-190-len/2,yy-10,picture,1.5,0.5*scale/picture.realSize,-Math.PI/4,true);// =============================================
text.taunt.draw('You died',x,y-80,8,color.guiwhite,'center');// text.level.draw(
//     'Level ' + gui.__s.getLevel() + ' ' + mockups[gui.type].name + '.',
//     x - 170, y - 30, 24, color.guiwhite
// );
text.score.draw('Score: '+util.formatLargeNumber(Math.round(global.finalScore.get())),x-170,y+25,20,color.guiwhite);text.level.draw('Level '+_gui.__s.getLevel()+' '+mockups[_gui.type].name+'.',x-170,y-30,16,color.guiwhite);text.time.draw('? Time Alive: '+util.timeForHumans(Math.round(global.finalLifetime.get()))+'.',x-170,y+55,16,color.guiwhite);text.kills.draw(getKills(),x-170,y+77,16,color.guiwhite);text.death.draw(getDeath(),x-170,y+99,16,color.guiwhite);text.playagain.draw('Press enter to play again!',x,y+125,16,color.guiwhite,'center');};}();var gameDrawBeforeStart=function(){var text={connecting:TextObj(),message:TextObj()};return function(){clearScreen(color.white,0.5);text.connecting.draw('Connecting...',global.screenWidth/2,global.screenHeight/2,30,color.guiwhite,'center');text.message.draw(global.message,global.screenWidth/2,global.screenHeight/2+30,15,color.lgreen,'center');};}();var gameDrawDisconnected=function(){var text={disconnected:TextObj(),message:TextObj()};return function(){clearScreen(mixColors(color.red,color.guiblack,0.3),0.25);text.disconnected.draw('?? Disconnected. ??',global.screenWidth/2,global.screenHeight/2,30,color.guiwhite,'center');text.message.draw(global.message,global.screenWidth/2,global.screenHeight/2+30,15,color.orange,'center');};}();// ===============================================================
// Cleaning up chat messages.
// ===============================================================
setInterval(cleanUpChatMessages,9000);function cleanUpChatMessages(){try{if(chatMessages){if(chatMessages.length>=8){while(chatMessages.length>=8){chatMessages[0].textobj.remove();chatMessages.splice(0,1);//chatMessages.shift();
}}else{if(chatMessages.length>0){// Display chat for at most 8 seconds.
if(Date.now()-chatMessages[0].time>=8000){chatMessages[0].textobj.remove();chatMessages.splice(0,1);//chatMessages.shift();
}}}}}catch(error){console.log(error);}};// ===============================================================
// The main function
function animloop(){global.animLoopHandle=window.requestAnimFrame(animloop);player.renderv+=(player.view-player.renderv)/30;var ratio=config.graphical.screenshotMode?2:getRatio();// Set the drawing style
ctx.lineCap='round';ctx.lineJoin='round';ctx.filter='none';// Draw the game
if(global.gameStart&&!global.disconnected){global.time=getNow();if(global.time-lastPing>1000){// Latency
// Do ping.
global.socket.ping(global.time);lastPing=global.time;// Do rendering speed.
metrics.rendertime=renderTimes;renderTimes=0;// Do update rate.
//metrics.updatetime = updateTimes;
updateTimes=0;}metrics.lag=global.time-player.time;}if(global.gameStart){// =====================================
// Experiment: Flash Bomb.
// =====================================
//if (player.flashBombed === 1)
if(player.underAttackType===10){ctx.save();gameDraw(ratio);ctx.globalCompositeOperation="source-atop";//ctx.fillStyle = color.guiwhite;
//ctx.globalAlpha = 0.98;
ctx.fillStyle=color.guiblack;ctx.globalAlpha=0.8;ctx.fillRect(0,0,global.screenWidth,global.screenHeight);ctx.restore();}// =====================================
// Experiment: Earthshaker.
// =====================================
else if(player.underAttackType===9){ctx.save();// let moveX = Math.random() * 10 * ratio;
// let moveY = Math.random() * 10 * ratio;
var moveX=Math.random()*5*ratio;var moveY=Math.random()*5*ratio;ctx.translate(moveX,moveY);gameDraw(ratio);ctx.restore();}else{gameDraw(ratio);}}else if(!global.disconnected){gameDrawBeforeStart();}if(global.died){gameDrawDead();}if(global.disconnected){gameDrawDisconnected();}}/***/},/* 1 *//***/function(module,exports){/*jslint esversion: 6*//*global require, module, exports, console*//*jshint -W097*/"use strict";module.exports={// Keys and other mathematical constants
KEY_ESC:27,// Escape
KEY_ENTER:13,KEY_CHAT:13,KEY_FIREFOOD:119,// F8
KEY_SPLIT:32,// Space
KEY_LEFT:65,// A
KEY_UP:87,// W
KEY_RIGHT:68,// D
KEY_DOWN:83,// S
KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_AUTO_SPIN:67,// C
KEY_AUTO_FIRE:69,// E
KEY_OVER_RIDE:82,// R
KEY_UPGRADE_SHI:48,// 0
KEY_UPGRADE_ATK:49,// 1
KEY_UPGRADE_HTL:50,// 2
KEY_UPGRADE_SPD:51,// 3
KEY_UPGRADE_STR:52,// 4
KEY_UPGRADE_PEN:53,// 5
KEY_UPGRADE_DAM:54,// 6
KEY_UPGRADE_RLD:55,// 7
KEY_UPGRADE_MOB:56,// 8
KEY_UPGRADE_RGN:57,// 9
KEY_MOUSE_0:32,// Space
KEY_MOUSE_1:86,// V
KEY_MOUSE_2:16,// Shift
KEY_CHOOSE_1:89,// Y
KEY_CHOOSE_2:72,// H
KEY_CHOOSE_3:85,// U
KEY_CHOOSE_4:74,// J
KEY_CHOOSE_5:73,// I    
KEY_CHOOSE_6:75,// K
KEY_CHOOSE_7:79,// O
KEY_CHOOSE_8:76,// L
KEY_LEVEL_UP:78,// N
KEY_LEVEL_UP2:75,// K
KEY_TEST_BED:220,// \
//KEY_ZOOM_IN: 61,     // =
//KEY_ZOOM_OUT: 173, // -
KEY_ZOOM_IN:90,// Z
KEY_ZOOM_OUT:88,// X
// Canvas
screenWidth:window.innerWidth,screenHeight:window.innerHeight,gameWidth:0,gameHeight:0,xoffset:-0,yoffset:-0,gameStart:false,disconnected:false,died:false,kicked:false,continuity:false,startPingTime:0,toggleMassState:0,backgroundColor:'#f2fbff',lineColor:'#000000',// Chat system.
// =======================
isChatMode:false// =======================
};/***/},/* 2 *//***/function(module,exports){exports.submitToLocalStorage=function(name){localStorage.setItem(name+'Value',document.getElementById(name).value);localStorage.setItem(name+'Checked',document.getElementById(name).checked);return false;};exports.retrieveFromLocalStorage=function(name){document.getElementById(name).value=localStorage.getItem(name+'Value');document.getElementById(name).checked=localStorage.getItem(name+'Checked')==='true';return false;};exports.handleLargeNumber=function(a){var cullZeroes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(cullZeroes&&a==0){return'';}if(a<Math.pow(10,3)){return''+a.toFixed(0);}if(a<Math.pow(10,6)){return(a/Math.pow(10,3)).toFixed(2)+"k";}if(a<Math.pow(10,9)){return(a/Math.pow(10,6)).toFixed(2)+"m";}if(a<Math.pow(10,12)){return(a/Math.pow(10,9)).toFixed(2)+"b";}if(a<Math.pow(10,15)){return(a/Math.pow(10,12)).toFixed(2)+"t";}return(a/Math.pow(10,15)).toFixed(2)+"q";};exports.timeForHumans=function(x){// ought to be in seconds
var seconds=x%60;x/=60;x=Math.floor(x);var minutes=x%60;x/=60;x=Math.floor(x);var hours=x%24;x/=24;x=Math.floor(x);var days=x;var y='';function weh(z,text){if(z){y=y+(y===''?'':', ')+z+' '+text+(z>1?'s':'');}}weh(days,'day');weh(hours,'hour');weh(minutes,'minute');weh(seconds,'second');if(y===''){y='less than a second';}return y;};exports.addArticle=function(string){return /[aeiouAEIOU]/.test(string[0])?'an '+string:'a '+string;};exports.formatLargeNumber=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");};exports.pullJSON=function(filename){var request=new XMLHttpRequest();var url="/json/"+filename+".json";// Set up the request
console.log("Loading JSON from "+url);request.responseType='json';// Return a promise
return new Promise(function(resolve,reject){request.open('GET',url);request.onload=function(){resolve(request.response);console.log('JSON load complete.');};request.onerror=function(){reject(request.statusText);console.log('JSON load failed.');console.log(request.statusText);};request.send();});};/***/},/* 3 *//***/function(module,exports,__webpack_require__){var global=__webpack_require__(1);// https://stackoverflow.com/questions/5203407/how-to-detect-if-multiple-keys-are-pressed-at-once-using-javascript
var keys={};// You could also use an array
function testKey(selkey){var alias={"ctrl":17,"shift":16,"M":77/* ... */};return keys[selkey]||keys[alias[selkey]];}// =======================================================
// For "- All -" dropdown list background color.
function getRoleColor(colorNumber){if(colorNumber===0){return'#3ac760';}else if(colorNumber===15){return'#CC669C';}// =================================
// Bug Finder chat color.
// =================================
else if(colorNumber===101){return'#40c1db';}// Honorary chat color.
else if(colorNumber===102){return'#e3b766';}// =================================
return getColor(colorNumber);}function getColor(colorNumber){switch(colorNumber){case 0:return'#70D1CA';case 1:return'#B9E87E';case 2:return'#E7896D';case 3:return'#FDF380';case 4:return'#B58EFD';case 5:return'#EF99C3';case 6:return'#EAEAEA';case 7:return'#D8D6D6';case 8:return'#FFFFFF';case 9:return'#484848';case 10:return'#3CA4CB';case 11:return'#8ABC3F';case 12:return'#D83848';case 13:return'#EFC74B';case 14:return'#8D6ADF';case 15:return'#CC669C';case 16:return'#B5B5B9';case 17:return'#999797';case 18:return'#DDE6EB';case 19:return'#000000';default:return'#FF0000';}}// =======================================================
var Canvas=function(){function Canvas(params){_classCallCheck(this,Canvas);this.directionLock=false;this.target=global.target;this.reenviar=true;this.socket=global.socket;this.directions=[];var self=this;this.cv=document.getElementById('gameCanvas');this.cv.width=global.screenWidth;this.cv.height=global.screenHeight;this.cv.addEventListener('keydown',this.keyboardDown,false);this.cv.addEventListener('keyup',this.keyboardUp,false);this.cv.addEventListener('mousemove',this.gameInput,false);this.cv.addEventListener("mousedown",this.mouseDown,false);this.cv.addEventListener("mouseup",this.mouseUp,false);this.cv.parent=self;global.canvas=this;}_createClass(Canvas,[{key:"keyboardDown",value:function keyboardDown(event){if(!this.parent.socket){return;}// https://stackoverflow.com/questions/5203407/how-to-detect-if-multiple-keys-are-pressed-at-once-using-javascript
keys[event.keyCode]=event.type==='keydown';switch(event.keyCode){// Enter to respawn
case 13:if(global.died){this.parent.socket.talk('s',global.playerName,0);global.died=false;}break;// =======================================            
// ===========================================        
// Chat system.
// ===========================================
// H
case 72:if(!global.died){if(global.isChatMode===false){// Chat input textbox.
var chatInput=document.createElement('input');chatInput.id='chatInput';chatInput.tabindex=4;//chatInput.style.font = 'bold 18px Consolas';
chatInput.style.font='bold 18px Ubuntu';chatInput.maxlength='200';chatInput.placeholder='Enter to send.Esc to cancel.Ââåäèòå,÷òîáû îòïðàâèòü.Esc,÷òîáû îòìåíèòü.';// =============================================
// Players list drop down list.                 
// =============================================
var playersDropDownList=document.createElement("select");playersDropDownList.id="playersList";playersDropDownList.className='players-list';// Add default option.
var allOption=document.createElement("option");allOption.value='0';allOption.text='-- All --';playersDropDownList.appendChild(allOption);try{var players=global.playersList;//Create and append the options
for(var i=0;i<players.length;i+=3){var option=document.createElement("option");// View Id.
option.value=players[i];// Player name.
option.text='['+players[i]+'] - '+players[i+1];// Role color index.
var colorString=getRoleColor(players[i+2]);option.style='background-color: '+colorString;playersDropDownList.appendChild(option);}// Try to set the value to previously selected player id.
playersDropDownList.value=global.selectedPlayerId;// Player does not exist anymore?
// =============================================================
if(playersDropDownList.value!=global.selectedPlayerId){// Change to default index.
playersDropDownList.selectedIndex=0;}// =============================================================                            
}catch(error){console.log(error);}// =============================================
// Chat input wrapper div.
var chatInputWrapper=document.createElement('div');// ================================================
// For cancelling chat when ESC key is pressed on canvas.
chatInputWrapper.id='chatInputDdiv';// ================================================
chatInputWrapper.style.position='absolute';chatInputWrapper.style.width='720px';chatInputWrapper.style.left='50%';chatInputWrapper.style.bottom='100px';chatInputWrapper.style.transform='translate(-50%, -50%)';chatInputWrapper.style.margin='0 auto';chatInputWrapper.style.visibility='hidden';chatInputWrapper.appendChild(playersDropDownList);chatInputWrapper.appendChild(chatInput);document.body.appendChild(chatInputWrapper);// Got error "Node was not found".
//$("#playersList").msDropdown().data("dd");
// Sending chat.
chatInput.addEventListener('keydown',function(event){try{if(event.key==='Enter'||event.keyCode===13){// ============================================================                             
// Check again if the player died, otherwise, it hangs the client.
// There will be an error saying that "color is undefined" in app.js file.
// ============================================================
// Death chat experiment.
if(global.died){global.socket.talk('s',global.playerName,0);global.died=false;}else{var chatMessage=chatInput.value;if(chatMessage){var maxLen=100;var trimmedMessage=chatMessage.length>maxLen?chatMessage.substring(0,maxLen-3)+"...":chatMessage.substring(0,maxLen);var ddl=playersDropDownList;if(ddl){var selectedOption=ddl.options[ddl.selectedIndex];if(selectedOption){global.playersListIndex=ddl.selectedIndex;global.selectedPlayerId=selectedOption.value;}global.socket.talk('h',trimmedMessage,global.selectedPlayerId);chatInputWrapper.removeChild(playersDropDownList);chatInputWrapper.removeChild(chatInput);document.body.removeChild(chatInputWrapper);var gameCanvas=document.getElementById('gameCanvas');gameCanvas.focus();global.isChatMode=false;}}}}}catch(error){console.log('[chatInput.addEventListener(keydown)]');console.log(error);}});// =========================================================
// Cancelling chat - pressing ESC in players dropdown list.
// =========================================================
playersDropDownList.addEventListener('keydown',function(event){if(event.key==='Esc'||event.keyCode===27){chatInputWrapper.removeChild(playersDropDownList);chatInputWrapper.removeChild(chatInput);document.body.removeChild(chatInputWrapper);var gameCanvas=document.getElementById('gameCanvas');gameCanvas.focus();global.isChatMode=false;}});// =========================================================
// Cancelling chat.
// =========================================================
chatInput.addEventListener('keydown',function(event){if(event.key==='Esc'||event.keyCode===27){chatInputWrapper.removeChild(playersDropDownList);chatInputWrapper.removeChild(chatInput);document.body.removeChild(chatInputWrapper);var gameCanvas=document.getElementById('gameCanvas');gameCanvas.focus();global.isChatMode=false;}});global.isChatMode=true;// To remove initial "i" letter.                        
setTimeout(function(){chatInput.value='';chatInputWrapper.style.visibility='visible';chatInput.focus();},10);}else{// Already in chat mode, focus the chat input textbox.
var existingChatInput=document.getElementById('chatInput');if(existingChatInput){// Remove 'h' from the input.
var oldValue=existingChatInput.value;existingChatInput.value='';existingChatInput.focus();existingChatInput.value=oldValue;}}}break;// ===========================================
case global.KEY_UP_ARROW:case global.KEY_UP:this.parent.socket.cmd.set(0,true);break;case global.KEY_DOWN_ARROW:case global.KEY_DOWN:this.parent.socket.cmd.set(1,true);break;case global.KEY_LEFT_ARROW:case global.KEY_LEFT:this.parent.socket.cmd.set(2,true);break;case global.KEY_RIGHT_ARROW:case global.KEY_RIGHT:this.parent.socket.cmd.set(3,true);break;case global.KEY_MOUSE_0:this.parent.socket.cmd.set(4,true);break;case global.KEY_MOUSE_1:this.parent.socket.cmd.set(5,true);break;case global.KEY_MOUSE_2:this.parent.socket.cmd.set(6,true);break;case global.KEY_LEVEL_UP:case global.KEY_LEVEL_UP2:this.parent.socket.talk('L');break;//case global.KEY_TEST_BED: this.parent.socket.talk('0'); break;
// Spectator zoom in/out.
case global.KEY_ZOOM_IN:this.parent.socket.talk('z',1);break;case global.KEY_ZOOM_OUT:this.parent.socket.talk('z',0);break;}if(!event.repeat){switch(event.keyCode){case global.KEY_AUTO_SPIN:{this.parent.socket.talk('t',0);break;}case global.KEY_AUTO_FIRE:{this.parent.socket.talk('t',1);break;}case global.KEY_OVER_RIDE:{this.parent.socket.talk('t',2);break;}}/* MODIFIED: Commented out.
	            if (global.canSkill) 
	            {
	                switch (event.keyCode) 
	                {
	                    case global.KEY_UPGRADE_ATK:  this.parent.socket.talk('x', 0); break;
	                    case global.KEY_UPGRADE_HTL:  this.parent.socket.talk('x', 1); break;
	                    case global.KEY_UPGRADE_SPD:  this.parent.socket.talk('x', 2); break;
	                    case global.KEY_UPGRADE_STR:  this.parent.socket.talk('x', 3); break;
	                    case global.KEY_UPGRADE_PEN:  this.parent.socket.talk('x', 4); break;
	                    case global.KEY_UPGRADE_DAM:  this.parent.socket.talk('x', 5); break;
	                    case global.KEY_UPGRADE_RLD:  this.parent.socket.talk('x', 6); break;
	                    case global.KEY_UPGRADE_MOB:  this.parent.socket.talk('x', 7); break;
	                    case global.KEY_UPGRADE_RGN:  this.parent.socket.talk('x', 8); break;
	                    case global.KEY_UPGRADE_SHI:  this.parent.socket.talk('x', 9); break;
	                }
	            }
	            */}// ====================================
// MODIFIED: Upgrade stats continuously.
// ====================================
if(global.canSkill){var cmd='x';// https://stackoverflow.com/questions/5203407/how-to-detect-if-multiple-keys-are-pressed-at-once-using-javascript
// ====================================
if(testKey('M')){cmd='m';}// ====================================
switch(event.keyCode){case global.KEY_UPGRADE_ATK:this.parent.socket.talk(cmd,0);break;case global.KEY_UPGRADE_HTL:this.parent.socket.talk(cmd,1);break;case global.KEY_UPGRADE_SPD:this.parent.socket.talk(cmd,2);break;case global.KEY_UPGRADE_STR:this.parent.socket.talk(cmd,3);break;case global.KEY_UPGRADE_PEN:this.parent.socket.talk(cmd,4);break;case global.KEY_UPGRADE_DAM:this.parent.socket.talk(cmd,5);break;case global.KEY_UPGRADE_RLD:this.parent.socket.talk(cmd,6);break;case global.KEY_UPGRADE_MOB:this.parent.socket.talk(cmd,7);break;case global.KEY_UPGRADE_RGN:this.parent.socket.talk(cmd,8);break;case global.KEY_UPGRADE_SHI:this.parent.socket.talk(cmd,9);break;}}}},{key:"keyboardUp",value:function keyboardUp(event){if(!this.parent.socket){return;}// https://stackoverflow.com/questions/5203407/how-to-detect-if-multiple-keys-are-pressed-at-once-using-javascript
keys[event.keyCode]=event.type==='keydown';switch(event.keyCode){case global.KEY_UP_ARROW:case global.KEY_UP:this.parent.socket.cmd.set(0,false);break;case global.KEY_DOWN_ARROW:case global.KEY_DOWN:this.parent.socket.cmd.set(1,false);break;case global.KEY_LEFT_ARROW:case global.KEY_LEFT:this.parent.socket.cmd.set(2,false);break;case global.KEY_RIGHT_ARROW:case global.KEY_RIGHT:this.parent.socket.cmd.set(3,false);break;case global.KEY_MOUSE_0:this.parent.socket.cmd.set(4,false);break;case global.KEY_MOUSE_1:this.parent.socket.cmd.set(5,false);break;case global.KEY_MOUSE_2:this.parent.socket.cmd.set(6,false);break;// For cancelling chat when ESC key is pressed on canvas.
case 27:try{var chatInputWrapper=document.getElementById('chatInputDdiv');if(chatInputWrapper){var playersDropDownList=document.getElementById('playersList');if(playersList){chatInputWrapper.removeChild(playersDropDownList);}var chatInput=document.getElementById('chatInput');if(chatInput){chatInputWrapper.removeChild(chatInput);}document.body.removeChild(chatInputWrapper);var gameCanvas=document.getElementById('gameCanvas');gameCanvas.focus();global.isChatMode=false;}}catch(error){console.log(error);}break;// // =================================
// // G. Tank ability/power usage.
// // =================================
// case 71:
//     if (!global.died){
//         this.parent.socket.talk('g');   
//     }
//     break;
}}},{key:"mouseDown",value:function mouseDown(mouse){if(!this.parent.socket){return;}switch(mouse.button){case 0:// console.log('mouse down:' + 0);
var mpos={x:mouse.clientX,y:mouse.clientY};var statIndex=global.clickables.stat.check(mpos);if(statIndex!==-1){// Stats upgrade.
this.parent.socket.talk('x',statIndex);}else if(global.clickables.skipUpgrades.check(mpos)!==-1){global.clearUpgrades();}else{var upgradeIndex=global.clickables.upgrade.check(mpos);if(upgradeIndex!==-1)this.parent.socket.talk('U',upgradeIndex);else this.parent.socket.cmd.set(4,true);}break;case 1:// console.log('mouse down:' + 1);
this.parent.socket.cmd.set(5,true);break;case 2:// console.log('mouse down:' + 2);
this.parent.socket.cmd.set(6,true);break;}}},{key:"mouseUp",value:function mouseUp(mouse){if(!this.parent.socket){return;}switch(mouse.button){case 0:// console.log('mouse up:' + 0);
this.parent.socket.cmd.set(4,false);break;case 1:// console.log('mouse up:' + 1);
this.parent.socket.cmd.set(5,false);break;case 2:// console.log('mouse up:' + 2);
this.parent.socket.cmd.set(6,false);break;}}// Mouse location (we send target information in the heartbeat)
},{key:"gameInput",value:function gameInput(mouse){this.parent.target.x=mouse.clientX-this.width/2;this.parent.target.y=mouse.clientY-this.height/2;global.target=this.parent.target;global.statHover=global.clickables.hover.check({x:mouse.clientX,y:mouse.clientY})===0;}}]);return Canvas;}();module.exports=Canvas;/***/},/* 4 *//***/function(module,exports){/*jslint esversion: 6*//*global require, exports, console*//*jshint -W097*/"use strict";// Does not work.
//const myUtil = require('./util');
function checkEndian(){var arrayBuffer=new ArrayBuffer(2);var uint8Array=new Uint8Array(arrayBuffer);var uint16array=new Uint16Array(arrayBuffer);uint8Array[0]=0xAA;// set first byte
uint8Array[1]=0xBB;// set second byte
if(uint16array[0]===0xBBAA)return 0;if(uint16array[0]===0xAABB)return 1;else throw new Error("Something crazy just happened");}/*var isBigEndian = new Uint8Array(new Uint32Array([0x12345678]).buffer)[0] === 0x12;
	var isLittleEndian = new Uint8Array(new Uint32Array([0x12345678]).buffer)[0] === 0x78;*/exports.encode=function(){// unsigned 8-bit integer
var arrUint8=new Uint8Array(1);// unsigned 16-bit integer
var arrUint16=new Uint16Array(1);var charUint16=new Uint8Array(arrUint16.buffer);// unsigned 32-bit integer
var arrUint32=new Uint32Array(1);var charUint32=new Uint8Array(arrUint32.buffer);// 32-bit float
var arrFloat32=new Float32Array(1);var charFloat32=new Uint8Array(arrFloat32.buffer);// build some useful internal functions
var typeEncoder=function typeEncoder(type,number){var output='';switch(type){case'RawUint8':arrUint8[0]=number;return String.fromCharCode(arrUint8[0]);case'RawUint16':arrUint16[0]=number;return String.fromCharCode(charUint16[0],charUint16[1]);case'Uint8':arrUint8[0]=number;return'0'+String.fromCharCode(arrUint8[0]);case'Uint16':arrUint16[0]=number;return'1'+String.fromCharCode(charUint16[0],charUint16[1]);case'Uint32':arrUint32[0]=number;return'2'+String.fromCharCode(charUint32[0],charUint32[1],charUint32[2],charUint32[3]);case'Sint8':arrUint8[0]=-1-number;return'3'+String.fromCharCode(arrUint8[0]);case'Sint16':arrUint16[0]=-1-number;return'4'+String.fromCharCode(charUint16[0],charUint16[1]);case'Sint32':arrUint32[0]=-1-number;return'5'+String.fromCharCode(charUint32[0],charUint32[1],charUint32[2],charUint32[3]);case'Float32':arrFloat32[0]=number;return'6'+String.fromCharCode(charFloat32[0],charFloat32[1],charFloat32[2],charFloat32[3]);case'String8':return'7'+typeEncoder('RawUint16',number.length)+number;case'String16':for(var i=0,strLen=number.length;i<strLen;i++){output+=typeEncoder('RawUint16',number.charCodeAt(i));}return'8'+typeEncoder('RawUint16',output.length)+output;default:throw new Error('Unknown encoding type.');}};var findType=function findType(value){if(typeof value==='string'){for(var i=0;i<value.length;i++){if(value.charCodeAt(i)>255)return'String16';}return'String8';}if(typeof value==='boolean')return'Uint8';// Temporary fix.
if(typeof value!=='number'){throw new Error('Unencodable data type!');}// if (typeof value !== 'number') { 
//     //myUtil.error('**[fasttalk.findType] Unencodable data type**'); 
//     value = 0;
// }
if(value!=Math.round(value))return'Float32';if(value<0){if(value>=-256)return'Sint8';if(value>=-65535)return'Sint16';if(value>=-4294967295)return'Sint32';}else{if(value<256)return'Uint8';if(value<65535)return'Uint16';if(value<4294967295)return'Uint32';}return'Float32';};// build the function
return function(arr){var verbose=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var output=arr.splice(0,1)[0];if(typeof output!=='string')throw new Error('No identification code!');arr.forEach(function(value){output+=typeEncoder(findType(value),value);});var len=output.length;var buffer=new ArrayBuffer(len);var integerView=new Uint8Array(buffer);for(var i=0;i<len;i++){integerView[i]=output.charCodeAt(i);}if(verbose){console.log('OUTPUT: '+integerView);console.log('RAW OUTPUT: '+output);console.log('SIZE: '+len);}return buffer;};}();exports.decode=function(){// unsigned 8-bit integer (none needed)
// unsigned 16-bit integer
var arrUint16=new Uint16Array(1);var charUint16=new Uint8Array(arrUint16.buffer);// unsigned 32-bit integer
var arrUint32=new Uint32Array(1);var charUint32=new Uint8Array(arrUint32.buffer);// 32-bit float
var arrFloat32=new Float32Array(1);var charFloat32=new Uint8Array(arrFloat32.buffer);// build a useful internal function
var typeDecoder=function typeDecoder(str,type,offset){switch(type){case'Uint8':return str.charCodeAt(offset++);case'Uint16':for(var i=0;i<2;i++){charUint16[i]=str.charCodeAt(offset++);}return arrUint16[0];case'Uint32':for(var _i14=0;_i14<4;_i14++){charUint32[_i14]=str.charCodeAt(offset++);}return arrUint32[0];case'Sint8':return-1-str.charCodeAt(offset++);case'Sint16':for(var _i15=0;_i15<2;_i15++){charUint16[_i15]=str.charCodeAt(offset++);}return-1-arrUint16[0];case'Sint32':for(var _i16=0;_i16<4;_i16++){charUint32[_i16]=str.charCodeAt(offset++);}return-1-arrUint32[0];case'Float32':for(var _i17=0;_i17<4;_i17++){charFloat32[_i17]=str.charCodeAt(offset++);}return arrFloat32[0];default:throw new Error('Unknown decoding type.');}};// actually decode it 
return function(raw){try{var intView=new Uint8Array(raw);var str='';for(var i=0,len=intView.length;i<len;i++){str+=String.fromCharCode(intView[i]);}var offset=1;var output=[str.charAt(0)];while(offset<str.length){switch(str[offset++]){case'0':output.push(typeDecoder(str,'Uint8',offset));offset++;break;case'1':output.push(typeDecoder(str,'Uint16',offset));offset+=2;break;case'2':output.push(typeDecoder(str,'Uint32',offset));offset+=4;break;case'3':output.push(typeDecoder(str,'Sint8',offset));offset++;break;case'4':output.push(typeDecoder(str,'Sint16',offset));offset+=2;break;case'5':output.push(typeDecoder(str,'Sint32',offset));offset+=4;break;case'6':output.push(typeDecoder(str,'Float32',offset));offset+=4;break;case'7':{// String8
var _len9=typeDecoder(str,'Uint16',offset);offset+=2;output.push(str.slice(offset,offset+_len9));offset+=_len9;}break;case'8':{// String16
var _len10=typeDecoder(str,'Uint16',offset);offset+=2;var arr=str.slice(offset,offset+_len10);var buf=new Uint16Array(_len10/2);for(var _i18=0;_i18<_len10;_i18+=2){buf[_i18/2]=typeDecoder(arr,'Uint16',_i18);}output.push(String.fromCharCode.apply(null,buf));offset+=_len10;}break;default:offset=str.length;throw new Error('Unknown decoding command. Decoding exited.');}}return output;}catch(err){console.log(err);return-1;}};}();/***/}]/******/);